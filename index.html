<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>룬 정보</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 98%;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
        }
        .controls {
            margin-bottom: 15px;
        }
        .filter-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .filter-section strong {
            white-space: nowrap;
            font-size: 15px;
        }
        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .filter-btn {
            padding: 8px 12px;
            font-size: 14px;
            background-color: #e0e0e0;
            color: #333;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .filter-btn:hover {
            background-color: #ccc;
        }
        .filter-btn.active {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        #clearFilterBtn, #toggleDescBtn {
            padding: 8px 15px;
            font-size: 14px;
            color: white !important;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.4;
            text-align: center;
            white-space: nowrap;
            display: inline-block;
            vertical-align: middle;
            text-decoration: none;
            outline: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-weight: 500;
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            min-height: 44px;
            min-width: 44px;
        }
        #clearFilterBtn {
            background-color: #f44336;
        }
        #clearFilterBtn:hover {
            background-color: #d32f2f;
        }
        #toggleDescBtn {
            background-color: #2196F3;
            color: white !important;
            text-shadow: none;
        }
        #toggleDescBtn:hover {
            background-color: #1976D2;
            color: white !important;
        }
        #toggleDescBtn.inactive {
            background-color: #9E9E9E;
            color: white !important;
        }
        #toggleDescBtn.inactive:hover {
            background-color: #757575;
            color: white !important;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 14px;
        }
        th, td {
            padding: 8px 10px;
            border: 1px solid #ddd;
            text-align: left;
            vertical-align: middle;
        }
        th {
            background-color: #4CAF50;
            color: white;
            position: sticky;
            top: 0;
            z-index: 1;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }
        th:hover {
            background-color: #45a049;
        }
        .sort-indicator {
            display: inline-block;
            margin-left: 5px;
            opacity: 0.6;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #ddd;
        }
        
        /* 모바일 반응형 설정 */
        @media screen and (max-width: 768px) {
            .description-column:not(.force-show) {
                display: none !important;
            }
            table {
                font-size: 12px;
            }
            th, td {
                padding: 6px 8px;
            }
            .filter-section {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            .filter-section strong {
                font-size: 14px;
            }
            .filter-btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            #clearFilterBtn, #toggleDescBtn {
                font-size: 13px;
                padding: 10px 16px;
                -webkit-text-size-adjust: 100%;
                -webkit-font-smoothing: antialiased;
            }
        }
        
        .description-column.force-hide {
            display: none !important;
        }
        /* 자동완성 드롭다운 스타일 */
        .autocomplete-container {
            position: relative;
            display: inline-block;
        }
        .autocomplete-items {
            position: absolute;
            border: 1px solid #ddd;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            border-radius: 0 0 4px 4px;
            max-height: 150px;
            overflow-y: auto;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .autocomplete-items div {
            padding: 8px 10px;
            cursor: pointer;
        }
        .autocomplete-items div:hover {
            background-color: #e9e9e9;
        }
        .autocomplete-active {
            background-color: #e9e9e9 !important;
        }
        /* 룬 선택 관련 스타일 */
        .rune-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .rune-checkbox:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        .calculation-result {
            margin: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .calculation-result h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .effect-sum {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #4CAF50;
        }
        .rune-list {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        .selected-count {
            font-size: 0.9em;
            color: #666;
            margin-left: 10px;
        }

        /* 상단 고정 영역 스타일 */
        .controls-container {
            position: sticky;
            top: 0;
            background: white;
            z-index: 100;
            padding: 20px 0;
            border-bottom: 1px solid #eee;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* 테이블 상단 여백 조정 */
        table {
            margin-top: 20px;
        }

        /* 테이블 헤더 고정 위치 조정 */
        th {
            position: sticky;
            top: 185px;  /* 상단 필터 영역 높이에 맞춰 조정 */
            background-color: #4CAF50;
            z-index: 99;
        }

        /* 모바일 대응 */
        @media screen and (max-width: 768px) {
            .controls-container {
                padding: 10px 0;
            }
            th {
                top: 240px;  /* 모바일에서는 필터 영역이 더 높아짐 */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>룬 정보 데이터</h1>
        <div class="controls-container">
            <div class="controls">
                <div class="filter-section">
                    <strong>종류 :</strong>
                    <div id="type-filters" class="filter-group"></div>
                </div>
                <div class="filter-section">
                    <strong>등급 :</strong>
                    <div id="grade-filters" class="filter-group"></div>
                </div>
                <div class="filter-section">
                    <strong>검색 키워드 :</strong>
                    <div id="effect-filters" class="filter-group"></div>
                </div>
                <div class="filter-section">
                    <strong>이름 검색 :</strong>
                    <input type="text" id="name-search" placeholder="룬 이름을 입력하세요" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd; width: 200px;">
                </div>
                <div class="control-buttons">
                    <button id="clearFilterBtn" type="button" onclick="clearAllFilters(event)">필터 초기화</button>
                    <button id="toggleDescBtn" type="button" onclick="toggleDescription(event)">설명 활성화</button>
                </div>
            </div>
            <!-- 선택된 룬 수 표시 -->
            <div class="selected-count">
                선택된 룬: 무기 <span id="weapon-count">0</span>/1, 
                방어구 <span id="armor-count">0</span>/5, 
                앰블럼 <span id="emblem-count">0</span>/1
            </div>
        </div>
        <table>
            <thead>
                <tr>
                    <th>선택</th>
                    <th onclick="sortTable(1, 'str')">이름 <span class="sort-indicator"></span></th>
                    <th onclick="sortTable(2, 'str')">키워드 <span class="sort-indicator"></span></th>
                    <th onclick="sortTable(3, 'str')">효과 <span class="sort-indicator"></span></th>
                    <th onclick="sortTable(4, 'num')">수치 <span class="sort-indicator"></span></th>
                    <th onclick="sortTable(5, 'str')">조건부 효과 <span class="sort-indicator"></span></th>
                    <th class="description-column" onclick="sortTable(6, 'str')">설명 <span class="sort-indicator"></span></th>
                </tr>
            </thead>
            <tbody>
                <!-- 데이터는 스크립트에서 동적으로 생성됩니다 -->
            </tbody>
        </table>
        <!-- 계산 결과 표시 영역 -->
        <div id="calculation-result" class="calculation-result" style="display: none;">
            <h3>선택된 룬 효과 계산 결과</h3>
            <div id="effect-sums">
                <!-- 계산 결과는 스크립트에서 동적으로 생성됩니다 -->
            </div>
        </div>
    </div>

    <script>
        const runeData = [
            // 무기 전설
            { type: '무기', grade: '전설', name: '불길', keyword: '-', effects: [{ effect: '치명타 확률 증가', value: '18%' }, { effect: '지속피해', value: '공격력×n%', condition: '화상 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '결정', keyword: '-', effects: [{ effect: '추가타 확률 증가', value: '18%' }, { effect: '지속피해', value: '공격력×n%', condition: '빙결 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '뇌명', keyword: '-', effects: [{ effect: '강타 피해 증가', value: '20%' }, { effect: '지속피해', value: '공격력×n%', condition: '감전 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '독사+', keyword: '-', effects: [{ effect: '연타 피해 증가', value: '20%' }, { effect: '지속피해', value: '공격력×n%', condition: '중독 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '공포', keyword: '-', effects: [{ effect: '치명타 피해 증가', value: '18%' }, { effect: '지속피해', value: '공격력×n%', condition: '암흑 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '집행자', keyword: '-', effects: [{ effect: '적에게 주는 피해 증가', value: '10%' }, { effect: '치유량 증가', value: '20%' }, { effect: '지속피해', value: '공격력×n%', condition: '신성 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '야수+', keyword: '-', effects: [{ effect: '적에게 주는 피해 증가', value: '20%' }, { effect: '지속피해', value: '공격력×n%', condition: '출혈 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '밤+', keyword: '-', effects: [{ effect: '공격력 증가', value: '20%' }, { effect: '지속피해', value: '공격력×n%', condition: '정신 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '투사+', keyword: '[결함]', effects: [{ effect: '적에게 주는 피해 증가', value: '33%' }, { effect: '멀티히트 피해 감소', value: '-10%' }] },
            { type: '무기', grade: '전설', name: '은둔자+', keyword: '[결함]', effects: [{ effect: '공격력 증가', value: '33%' }, { effect: '재사용 대기 시간 회복 속도 감소', value: '-9%' }] },
            { type: '무기', grade: '전설', name: '망각+', keyword: '[조건부]', effects: [{ effect: '공격력 증가', value: '19%' }, { effect: '모든 스킬의 재사용 대기 시간 감소', value: '9%', condition: '기본 공격 적중 시' }] },
            { type: '무기', grade: '전설', name: '서리바람+', keyword: '-', effects: [{ effect: '공격력 증가', value: '20%' }, { effect: '캐스팅 및 차지 속도 증가', value: '25%' }] },
            { type: '무기', grade: '전설', name: '옛 마법사', keyword: '[결함]', effects: [{ effect: '재사용 대기 시간 회복 속도 증가', value: '29%' }, { effect: '적에게 주는 피해 감소', value: '-10%' }] },
            { type: '무기', grade: '전설', name: '물결치는 날', keyword: '[조건부]', effects: [{ effect: '다음 기본 공격 추가 피해', value: '공격력×n%' }, { effect: '다음 1회 기본 공격 속도 증가', value: '10%' }], condition: '스킬 사용 시' },
            { type: '무기', grade: '전설', name: '파괴자+', keyword: '-', effects: [{ effect: '공격력 증가', value: '18%' }, { effect: '무방비 피해 증가', value: '48%' }] },
            { type: '무기', grade: '전설', name: '검무+', keyword: '[누적]', effects: [{ effect: '공격력 증가', value: '2% (최대 20%)' }, { effect: '치명타 확률 증가', value: '1% (최대 10%)' }], condition: '공격 적중 시 (지속: 10초 / 최대 10회)' },
            { type: '무기', grade: '전설', name: '무수한 궤적', keyword: '-', effects: [{ effect: '공격력 증가', value: '10%' }, { effect: '기본 공격 속도 증가', value: '30%' }, { effect: '기본 공격 추가타 확률 증가', value: '30%' }] },
            { type: '무기', grade: '전설', name: '마지막 자비', keyword: '[조건부]', effects: [{ effect: '공격력 증가', value: '20%' }, { effect: '공격력 추가 증가', value: '20%' }], condition: '남은 체력 50% 이하 적 공격 시 (지속: 10초)' },
            { type: '무기', grade: '전설', name: '끝없는 순환', keyword: '[축적]', effects: [{ effect: '[공격] 마법진 암흑 피해', value: '공격력×n%' }, { effect: '[회복] 마법진 회복', value: '공격력×n%' }], condition: '공격/회복 20회 축적' },
            { type: '무기', grade: '전설', name: '종언+', keyword: '[누적]', effects: [{ effect: '공격력 증가', value: '2% (최대 20%)' }, { effect: '공격력 증가 (기본)', value: '24%' }], condition: '자신과 전투 중인 적 처치 시 (지속: 20초 / 최대 10회)' },
            { type: '무기', grade: '전설', name: '영웅', keyword: '-', effects: [{ effect: '공격력, 연타, 강타, 콤보, 스킬, 치명타, 멀티 히트 피해 증가', value: '각 4.3%' }] },
            
            // 방어구 전설
            { type: '방어구', grade: '전설', name: '여명+', keyword: '[누적]', effects: [{ effect: '공격력 증가', value: '3.5% (최대 21%)' }], condition: '스킬 사용 시 (지속: 10초 / 최대 6회)' },
            { type: '방어구', grade: '전설', name: '황혼', keyword: '[누적]', effects: [{ effect: '적에게 주는 피해 증가', value: '1.4% (최대 22.4%)' }], condition: '공격 적중 시 (지속: 8초 / 최대 16회)' },
            { type: '방어구', grade: '전설', name: '바위 감시자', keyword: '[축적]', effects: [{ effect: '공격력 증가', value: '22%' }], condition: '강타 7회 적중 시 (지속: 6초)' },
            { type: '방어구', grade: '전설', name: '쇄도+', keyword: '[조건부]', effects: [{ effect: '캐스팅 및 차지 속도 증가', value: '20%' }, { effect: '스킬 사용 속도 증가', value: '20%' }], condition: '스킬 사용 시 25% 확률 (지속: 5초)' },
            { type: '방어구', grade: '전설', name: '무도가+', keyword: '-', effects: [{ effect: '공격력 증가', value: '12%' }, { effect: '궁극기 게이지 획득량 증가', value: '20%' }] },
            { type: '방어구', grade: '전설', name: '해결사+', keyword: '-', effects: [{ effect: '공격 속도 증가', value: '30%' }, { effect: '기본 공격 추가타 확률 증가', value: '30%' }] },
            { type: '방어구', grade: '전설', name: '들불', keyword: '[조건부]', effects: [{ effect: '치명타 확률 증가', value: '14%' }], condition: '화상 보유 적 공격 시 (지속: 5초 / 쿨타임: 3초)' },
            { type: '방어구', grade: '전설', name: '설산', keyword: '[조건부]', effects: [{ effect: '추가타 확률 증가', value: '16%' }], condition: '빙결 보유 적 공격 시 (지속: 5초 / 쿨타임: 3초)' },
            { type: '방어구', grade: '전설', name: '절개+', keyword: '[조건부]', effects: [{ effect: '공격력 증가', value: '20%' }], condition: '출혈 보유 적 공격 시 (지속: 5초 / 쿨타임: 3초)' },
            { type: '방어구', grade: '전설', name: '환영+', keyword: '[조건부]', effects: [{ effect: '공격력 증가', value: '18%' }, { effect: '방어구 파괴 부여', value: '받는 피해 10% 증가', condition: '정신 보유 적 공격 시 (지속: 10초 / 쿨타임: 3초)' }] },
            { type: '방어구', grade: '전설', name: '황금 들판', keyword: '[조건부]', effects: [{ effect: '공격력 증가', value: '20%' }], condition: '체력 75% 이상일 경우' },
            { type: '방어구', grade: '전설', name: '모래 폭풍', keyword: '[조건부]', effects: [{ effect: '스킬 사용 속도 및 공격 속도 증가', value: '10%' }, { effect: '스킬 사용 속도 및 공격 속도 추가 증가', value: '24%', condition: '무방비 공격 적중 시 (지속: 10초)' }] },
            { type: '방어구', grade: '전설', name: '황폐+', keyword: '[조건부]', effects: [{ effect: '적에게 주는 피해 증가', value: '12%' }, { effect: '추가타 확률 증가', value: '7%' }], condition: '자원 50% 미만일 경우' },
            { type: '방어구', grade: '전설', name: '신성한 칙령', keyword: '[조건부]', effects: [{ effect: '공격력 증가', value: '15%' }, { effect: '회복량 증가', value: '9%' }], condition: '아군 회복 시 (지속: 5초)' },
            { type: '방어구', grade: '전설', name: '준비된 자', keyword: '-', effects: [{ effect: '적에게 주는 피해 증가', value: '20%', condition: '퀵슬롯 아이템 사용 시 (지속: 15초)' }, { effect: '포션 개수 증가', value: '+2' }, { effect: '붕대 개수 증가', value: '+2' }] },
            { type: '방어구', grade: '전설', name: '저무는 달', keyword: '[누적]', effects: [{ effect: '공격력과 방어력 증가', value: '6%' }, { effect: '공격력과 방어력 추가 증가', value: '2% (최대 20%)' }], condition: '전투 시작 후 30초마다 (최대 10회)' },
            { type: '방어구', grade: '전설', name: '땅울림', keyword: '-', effects: [{ effect: '공격력 증가', value: '8%' }, { effect: '공격력 증가', value: '30%', condition: '전투 시작 시, 3초마다 2%씩 감소' }] },
            { type: '방어구', grade: '전설', name: '신전 기사', keyword: '[결함]', effects: [{ effect: '공격력 증가', value: '23%' }, { effect: '치명타 확률 감소', value: '-8%' }] },
            { type: '방어구', grade: '전설', name: '근위병+', keyword: '[결함]', effects: [{ effect: '공격력 증가', value: '23%' }, { effect: '재사용 대기 시간 회복 속도 감소', value: '-7%' }] },
            { type: '방어구', grade: '전설', name: '침묵하는 산', keyword: '[조건부]', effects: [{ effect: '공격력 증가', value: '22%' }], condition: '5초 동안 이동하지 않을 경우' },
            { type: '방어구', grade: '전설', name: '필사+', keyword: '[조건부]', effects: [{ effect: '공격력 증가', value: '10%' }, { effect: '공격력 추가 증가', value: '20%', condition: '체력 50% 이하로 감소 시 (지속: 20초 / 쿨타임: 15초)' }] },
            { type: '방어구', grade: '전설', name: '파멸+', keyword: '[조건부]', effects: [{ effect: '공격력 증가', value: '25%' }], condition: '궁극기 사용 시 (지속: 20초)' },
            { type: '방어구', grade: '전설', name: '집정관', keyword: '[결함]', effects: [{ effect: '공격력 증가', value: '23%' }, { effect: '스킬 사용 속도와 캐스팅 및 차지 속도 감소', value: '-8%' }] },
            { type: '방어구', grade: '전설', name: '새벽별', keyword: '[누적]', effects: [{ effect: '스킬 재사용 대기 시간 회복 속도 증가', value: '3% (최대 18%)' }], condition: '스킬 사용 시 (지속: 8초 / 최대 6회)' },
            { type: '방어구', grade: '전설', name: '눈 먼 예언자', keyword: '-', effects: [{ effect: '각성의 재사용 대기 시간 감소', value: '38초' }] },
            { type: '방어구', grade: '전설', name: '압도적인 힘', keyword: '-', effects: [{ effect: '강타 피해 증가', value: '6%' }, { effect: '공격력 증가', value: '6%' }, { effect: '치명타 확률 증가', value: '4%' }], condition: '엠블럼 각성 시 20초간 능력치 2배' },
            { type: '방어구', grade: '전설', name: '섬세한 손놀림', keyword: '-', effects: [{ effect: '연타 피해 증가', value: '6%' }, { effect: '공격력 증가', value: '6%' }, { effect: '추가타 확률 증가', value: '4%' }], condition: '엠블럼 각성 시 20초간 능력치 2배' },
            { type: '방어구', grade: '전설', name: '성역+', keyword: '[조건부]', effects: [{ effect: '공격력 증가', value: '17%', condition: '보호막 유지 시' }, { effect: '보호막 생성', value: '(공격력×n%)', condition: '포션 사용 또는 30초마다' }] },
            { type: '방어구', grade: '전설', name: '불안정한 힘', keyword: '[조건부]', effects: [{ effect: '적에게 주는 피해 증가', value: '22%' }], condition: '전투 시작 시 (브레이크 시 효과 사라짐, 30초 후 재활성화)' },
            { type: '방어구', grade: '전설', name: '고대 수호자', keyword: '[결함]', effects: [{ effect: '공격력 증가', value: '23%' }, { effect: '이동 속도 감소', value: '-8%' }] },
            { type: '방어구', grade: '전설', name: '갈퀴발톱+', keyword: '-', effects: [{ effect: '브레이크 스킬로 주는 피해 증가', value: '24%' }, { effect: '브레이크 피해 증가', value: '24%' }, { effect: '무방비 피해 증가', value: '24%' }] },
            { type: '방어구', grade: '전설', name: '태양', keyword: '-', effects: [{ effect: '주기적인 광역 피해', value: '(공격력×n%)' }], condition: '3.5초마다 3m 범위 내' },
            { type: '방어구', grade: '전설', name: '싹쓸바람', keyword: '-', effects: [{ effect: '광역 피해 및 끌어당김', value: '(공격력×n%)' }], condition: '공격 적중 시 (쿨타임: 10초)' },
            { type: '방어구', grade: '전설', name: '혼돈', keyword: '[조건부]', effects: [{ effect: '추가 피해', value: '(공격력×n%)' }], condition: '지속 피해 3회 중첩 시 (대상마다 4초에 한 번)' },
            { type: '방어구', grade: '전설', name: '붕괴하는 별', keyword: '[조건부]', effects: [{ effect: '추가 피해', value: '(공격력×n%)', condition: '공격 3회 중첩 시 (대상마다 3초에 한 번)' }, { effect: '공격력 증가', value: '10%', condition: '공격 3회 중첩 시 (지속 10초)' }] },
            { type: '방어구', grade: '전설', name: '돌격대장+', keyword: '[조건부]', effects: [{ effect: '방어구 파괴 부여', value: '받는 피해 10% 증가' }, { effect: '공격력 증가', value: '20%' }], condition: '도발 시' },
            { type: '방어구', grade: '전설', name: '지휘관', keyword: '[누적]', effects: [{ effect: '공격력 증가', value: '4.5% (최대 22.5%)' }], condition: '특정 공격 시 (지속: 8초 / 최대 5회)' },
            { type: '방어구', grade: '전설', name: '응징+', keyword: '-', effects: [{ effect: '공격력 증가', value: '12%' }, { effect: '체력 회복', value: '(공격력×n%)', condition: '적 처치 시' }] },
            { type: '방어구', grade: '전설', name: '집념+', keyword: '-', effects: [{ effect: '캐스팅 및 차지 속도 증가', value: '25%' }, { effect: '적에게 주는 피해 증가', value: '10%' }] },
            { type: '방어구', grade: '전설', name: '분쇄+', keyword: '[조건부]', effects: [{ effect: '공격력 증가', value: '6%' }, { effect: '적에게 주는 피해 증가', value: '28%', condition: '무방비 공격 적중 시 (지속: 10초)' }] },
            { type: '방어구', grade: '전설', name: '쌍둥이 별', keyword: '-', effects: [{ effect: '누적 효과 추가 발생', value: '+1회' }, { effect: '캐스팅 및 차지 속도, 스킬 사용 속도 증가', value: '7%' }] },
            { type: '방어구', grade: '전설', name: '푸른 거목', keyword: '[축적]', effects: [{ effect: '스킬 피해량 증가', value: '2.2% (최대 22%)' }], condition: '스킬 5회 사용 시마다 (최대 10회)' },
            { type: '방어구', grade: '전설', name: '어두운 징조', keyword: '[누적]', effects: [{ effect: '공격력 증가', value: '0.6% (최대 18%)' }, { effect: '치명타 확률 증가', value: '0.6% (최대 18%)' }, { effect: '적에게 주는 피해 증가', value: '0.6% (최대 18%)' }], condition: '궁극기 사용 시 (최대 30회)' },
            { type: '방어구', grade: '전설', name: '요정 무리', keyword: '[축적]', effects: [{ effect: '모든 스킬 재사용 대기 시간 감소', value: '2.1초' }], condition: '스킬 7회 사용 시 (쿨타임: 3초)' },
            { type: '방어구', grade: '전설', name: '수정 꽃잎', keyword: '[축적]', effects: [{ effect: '추가 피해', value: '(공격력×n%)' }, { effect: '공격력 증가', value: '12%' }], condition: '치명타 6회 적중 시 (공증 10초 지속 / 쿨타임: 3초)' },
            { type: '방어구', grade: '전설', name: '나무 사슴', keyword: '[축적]', effects: [{ effect: '추가 피해', value: '(공격력×n%)' }, { effect: '공격력 증가', value: '12%' }], condition: '추가타 6회 적중 시 (공증 10초 지속 / 쿨타임: 4초)' },
            { type: '방어구', grade: '전설', name: '에메랄드 숲', keyword: '-', effects: [{ effect: '축적 횟수 추가', value: '+1회' }, { effect: '적에게 주는 피해 증가', value: '10%' }] },
            { type: '방어구', grade: '전설', name: '불사', keyword: '[조건부]', effects: [{ effect: '적에게 주는 피해 증가', value: '18%' }, { effect: '죽음 방지 및 회복', value: '1회' }, { effect: '받는 피해 감소', value: '80%' }], condition: '행동 불능 시 (지속: 3초 / 쿨타임: 180초)' },
            { type: '방어구', grade: '전설', name: '싸움꾼', keyword: '[조건부]', effects: [{ effect: '적에게 주는 피해 증가', value: '12% ~ 16%' }, { effect: '받는 피해 감소', value: '8% ~ 12%' }], condition: '주변 적 수에 따라 (최대 3명)' },
            { type: '방어구', grade: '전설', name: '약탈자', keyword: '-', effects: [{ effect: '체력 회복', value: '(공격력×n%)', condition: '추가타 적중 시 (쿨타임: 1초)' }, { effect: '추가타 확률 증가', value: '10%' }] },
            { type: '방어구', grade: '전설', name: '원소 조화', keyword: '-', effects: [{ effect: '추가 피해', value: '3가지 속성 (공격력×n%)' }], condition: '공격 적중 시 (쿨타임: 5초)' },
            { type: '방어구', grade: '전설', name: '다가오는 죽음', keyword: '-', effects: [{ effect: '추가 피해', value: '(공격력×n%) ~ (공격력×n%)' }], condition: '거리에 비례 (쿨타임: 10초)' },
            { type: '방어구', grade: '전설', name: '잊힌 성소', keyword: '[축적]', effects: [{ effect: '원소 화살 난사', value: '(공격력×n%)' }], condition: '스킬/기본 공격 60회 사용 시' },
            
            // 무기 신화
            { type: '무기', grade: '신화', name: '만 갈래 물길', keyword: '[누적]', effects: [{ effect: '공격력 증가', value: '15%' }, { effect: '공격력 추가 증가', value: '1% (최대 20%)', condition: '클래스 레벨 50 달성마다' }] },
            { type: '무기', grade: '신화', name: '흰 까마귀', keyword: '[조건부]', effects: [{ effect: '공격 속도 증가', value: '10%' }, { effect: '이동 속도 증가', value: '10%' },{ effect: '스킬 사용 속도 증가', value: '10%' }, { effect: '캐스팅 및 차지 속도 증가', value: '10%' }, { effect: '재사용 대기 시간 회복 속도 증가', value: '10%' }, { effect: '적에게 주는 피해 증가', value: '7%', condition: '+10 강화 시' }, { effect: '공격력 증가', value: '7%', condition: '+15 강화 시' }] },
            { type: '무기', grade: '신화', name: '메아리치는 진노', keyword: '[조건부]', effects: [{ effect: '공격력 증가', value: '5%' }, { effect: '공격력 추가 증가', value: '3%', condition: '+10 강화 시' }, { effect: '공격력 추가 증가', value: '3%', condition: '+15 강화 시' }, { effect: '추가 피해', value: '(공격력×n%)', condition: '연타 적중 시 (쿨타임: 8초)' }, { effect: '지속피해', value: '(공격력×n%)', condition: '빙결, 연타 적중 시 (쿨타임: 8초)' }, { effect: '추가 피해', value: '(공격력×n%)', condition: '강타 적중 시 (쿨타임: 8초)' }, { effect: '지속피해', value: '(공격력×n%)', condition: '화상, 강타 적중 시 (쿨타임: 8초)' }] },
            { type: '무기', grade: '신화', name: '무한', keyword: '-', effects: [{ effect: '공격력 증가', value: '20%' }, { effect: '모든 스킬의 재사용 대기 시간 감소', value: '9%', condition: '기본 공격 사용 시' }, { effect: '공격 속도 증가', value: '12%', condition: '스킬 사용 시 (지속: 5초)' }] },
            
             // 방어구 신화
            { type: '방어구', grade: '신화', name: '닫힌 운명', keyword: '[조건부]', effects: [{ effect: '추가 피해', value: '(공격력×n%)' }, { effect: '방어구 파괴 부여', value: '받는 피해 10% 증가' }], condition: '공격 적중 시 (재사용 대기 시간: 5초)' },
            { type: '방어구', grade: '신화', name: '검게 물든 후광', keyword: '[조건부]', effects: [{ effect: '받는 피해 증가', value: '15%' }, { effect: '적에게 주는 피해 증가', value: '15%' }, { effect: '적에게 주는 피해 증가', value: '6%', condition: '+10 강화 시' }, { effect: '적에게 주는 피해 증가', value: '6%', condition: '+15 강화 시' }], condition: '아군 회복/물약 사용 시 15초간 받는 피해 증가 무효화' },
            { type: '방어구', grade: '신화', name: '그림자로 엮은 회랑', keyword: '-', effects: [{ effect: '주기적인 광역 피해', value: '(공격력×n%)' }], condition: '2, 3, 4초마다 발사 (+15 강화 시 5초마다 추가)' },
            { type: '방어구', grade: '신화', name: '바스러지는 빛', keyword: '[누적]', effects: [{ effect: '공격력 증가', value: '5.5% (최대 27.5%)' }], condition: '스킬 사용 시 (지속: 8초 / 최대 5회, +15 강화 시 50% 확률로 추가 중첩)' },
            { type: '방어구', grade: '신화', name: '세상을 삼키는 악의', keyword: '[조건부]', effects: [{ effect: '원소 지속 피해를 보유한 적에게 주는 피해 증가', value: '16%' }, { effect: '적에게 주는 무방비 피해 증가', value: '16%' }, { effect: '적에게 주는 피해 추가 증가', value: '3%', condition: '+10 강화 시' }, { effect: '적에게 주는 피해 추가 증가', value: '3%', condition: '+15 강화 시' }] },
            { type: '방어구', grade: '신화', name: '이름 없는 혼돈', keyword: '[조건부]', effects: [{ effect: '공격력 증가', value: '10%~30% (+15 강화 시 최대 40%)' }], condition: '전투 중 5초마다 5초 동안' },
            { type: '방어구', grade: '신화', name: '영원', keyword: '-', effects: [{ effect: '모든 결함 효과 제거', value: '-' }, { effect: '공격력 증가', value: '10%' }] },
            { type: '방어구', grade: '신화', name: '쏟아지는 별', keyword: '-', effects: [{ effect: '주기적인 광역 피해', value: '(공격력×n%)' }], condition: '전투 중 15초마다 (궁극기 사용 시 모든 적 타격)' },

            // 앰블럼 전설
            { type: '앰블럼', grade: '전설', name: '무자비한 포식자', keyword: '[조건부]', effects: [ { effect: '적에게 주는 스킬 피해 증가', value: '55%', condition: '무방비 공격 시 각성 (20초 지속)' }, { effect: '모든 스킬 재사용 대기 시간 초기화', value: '-', condition: '무방비 공격 시 각성' }, { effect: '적에게 주는 피해 증가', value: '21%' } ], condition: '(재사용 대기 시간: 90초)'},
            { type: '앰블럼', grade: '전설', name: '순수한 힘', keyword: '[조건부]', effects: [ { effect: '적에게 주는 피해 증가', value: '27%', condition: '궁극기 사용 시 (30초 지속)' }, { effect: '궁극기 게이지 획득량 증가', value: '20%' } ]},
            { type: '앰블럼', grade: '전설', name: '부서진 하늘', keyword: '[조건부]', effects: [ { effect: '연타 피해 증가', value: '60%', condition: '공격 시 50% 확률로 각성 (20초 지속)' }, { effect: '추가 피해', value: '(공격력×n%)', condition: '각성 중 공격 적중 시 (0.5초마다)' }, { effect: '연타 피해 증가', value: '8%' }, { effect: '재사용 대기 시간 회복 속도 증가', value: '8%' } ], condition: '(재사용 대기 시간: 90초)'},
            { type: '앰블럼', grade: '전설', name: '인도하는 빛', keyword: '[조건부]', effects: [ { effect: '아군 공격력 증가', value: '8%', condition: '궁극기 사용 시 (15초 지속)' }, { effect: '공격력 증가', value: '20%', condition: '아군 회복 시 (15초 지속)' } ]},
            { type: '앰블럼', grade: '전설', name: '대마법사', keyword: '[조건부]', effects: [ { effect: '공격력 증가', value: '45%', condition: '공격 시 50% 확률로 각성 (20초 지속)' }, { effect: '스킬 캐스팅 및 사용 속도 증가', value: '25%', condition: '공격 시 50% 확률로 각성 (20초 지속)' }, { effect: '스킬 사용 속도, 캐스팅 및 차지 속도 증가', value: '14%' }, { effect: '차지 스킬의 피해량 증가', value: '14%' } ], condition: '(재사용 대기 시간: 90초)'},
            { type: '앰블럼', grade: '전설', name: '흩날리는 검', keyword: '[조건부]', effects: [ { effect: '공격력 증가', value: '35%', condition: '공격 시 50% 확률로 각성 (35초 지속)' }, { effect: '기본 공격 속도 증가', value: '20%', condition: '공격 시 50% 확률로 각성 (35초 지속)' }, { effect: '기본 공격 추가타 확률 증가', value: '20%', condition: '공격 시 50% 확률로 각성 (35초 지속)' }, { effect: '기본 공격 속도 증가', value: '24%' }, { effect: '기본 공격 추가타 확률 증가', value: '24%' } ], condition: '(재사용 대기 시간: 90초)'},
            { type: '앰블럼', grade: '전설', name: '산맥 군주', keyword: '[조건부]', effects: [ { effect: '강타 피해 증가', value: '60%', condition: '공격 시 50% 확률로 각성 (20초 지속)' }, { effect: '추가 피해', value: '(공격력×n%)', condition: '각성 중 공격 적중 시 (3초마다)' }, { effect: '강타 피해 증가', value: '8%' }, { effect: '스킬 사용 속도 증가', value: '8%' } ], condition: '(재사용 대기 시간: 90초)'},
            { type: '앰블럼', grade: '전설', name: '아득한 빛', keyword: '[조건부]', effects: [ { effect: '치명타 확률 증가', value: '20%', condition: '공격 시 50% 확률로 각성 (20초 지속)' }, { effect: '치명타 피해량 증가', value: '50%', condition: '공격 시 50% 확률로 각성 (20초 지속)' }, { effect: '치명타 확률 증가', value: '5%' }, { effect: '치명타 피해량 증가', value: '10%' }, { effect: '적에게 주는 피해 증가', value: '5%' } ], condition: '(재사용 대기 시간: 90초)'},
            { type: '앰블럼', grade: '전설', name: '갈라진 땅', keyword: '[조건부]', effects: [ { effect: '추가타 확률 증가', value: '30%', condition: '공격 시 50% 확률로 각성 (35초 지속)' }, { effect: '추가 공격 발생', value: '선행 타격의 18% 피해', condition: '각성 중 추가타 적중 시' }, { effect: '추가타 확률 증가', value: '12%' } ], condition: '(재사용 대기 시간: 90초)'}
        ];

        const effectCategories = {
            '공격력 증가': ['공격력 증가', '공격력 추가 증가', '공격력과 방어력 증가', '공격력과 방어력 추가 증가', '아군 공격력 증가'],
            '피해 증가': [
                '적에게 주는 피해 증가',
                '연타 피해 증가',
                '강타 피해 증가',
                '치명타 피해 증가',
                '무방비 피해 증가',
                '브레이크 스킬로 주는 피해 증가',
                '브레이크 피해 증가',
                '스킬 피해량 증가',
                '차지 스킬의 피해량 증가',
                '적에게 주는 스킬 피해 증가',
                '적에게 주는 무방비 피해 증가'
            ],
            '치명타 확률': ['치명타 확률 증가'],
            '추가타 확률': ['추가타 확률 증가', '기본 공격 추가타 확률 증가'],
            '유틸': ['캐스팅 및 차지 속도 증가', '재사용 대기 시간 회복 속도 증가', '모든 스킬의 재사용 대기 시간 감소', 
                   '치유량 증가', '기본 공격 속도 증가', '다음 1회 기본 공격 속도 증가', '궁극기 게이지 획득량 증가', 
                   '스킬 사용 속도 증가', '스킬 사용 속도 및 공격 속도 증가', '스킬 사용 속도 및 공격 속도 추가 증가', 
                   '회복량 증가', '스킬 재사용 대기 시간 회복 속도 증가', '각성의 재사용 대기 시간 감소', '체력 회복', 
                   '캐스팅 및 차지 속도, 스킬 사용 속도 증가', '이동 속도 증가', '공격 속도 증가', '모든 스킬의 재사용 대기 시간 초기화'],
            '기타': ['지속피해', '멀티히트 피해 감소', '재사용 대기 시간 회복 속도 감소', '적에게 주는 피해 감소', 
                   '[공격] 마법진 암흑 피해', '[회복] 마법진 회복', '방어구 파괴 부여', '포션 개수 증가', '붕대 개수 증가', 
                   '치명타 확률 감소', '스킬 사용 속도와 캐스팅 및 차지 속도 감소', '보호막 생성', '이동 속도 감소', 
                   '누적 효과 추가 발생', '축적 횟수 추가', '죽음 방지 및 회복', '받는 피해 감소', '원소 화살 난사', 
                   '추가 피해', '받는 피해 증가', '모든 결함 효과 제거', '추가 공격 발생', '주기적인 광역 피해', 
                   '광역 피해 및 끌어당김', '콤보', '멀티 히트']
        };
        
        const allDescriptions = {
            // 무기 전설
            '불길': '치명타 확률이 18% 증가한다. 공격 적중 시, (공격력×n%)의 지속 피해: 화상을 준다.(재사용 대기 시간: 10초)',
            '결정': '추가타 확률이 18% 증가한다. 공격 적중 시, (공격력×n%)의 지속 피해: 빙결을 준다.(재사용 대기 시간: 10초)',
            '뇌명': '강타 피해가 20% 증가한다. 공격 적중 시, (공격력×n%)의 지속 피해: 감전을 준다.(재사용 대기 시간: 10초)',
            '독사+': '연타 피해가 20% 증가한다. 공격 적중 시, (공격력×n%)의 지속 피해: 중독을 준다.(재사용 대기 시간: 10초)',
            '공포': '치명타 피해가 18% 증가한다. 공격 적중 시, (공격력×n%)의 지속 피해: 암흑을 준다.(재사용 대기 시간: 10초)',
            '집행자': '치유량이 20%, 적에게 주는 피해가 10% 증가한다. 공격 적중 시, (공격력×n%)의 지속 피해: 신성을 준다.(재사용 대기 시간: 10초)',
            '야수+': '적에게 주는 피해가 20% 증가한다. 공격 적중 시, (공격력×n%)의 지속 피해: 출혈을 준다.(재사용 대기 시간: 10초)',
            '밤+': '공격력이 20% 증가한다. 공격 적중 시, (공격력×n%)의 지속 피해: 정신을 준다.(재사용 대기 시간: 10초)',
            '투사+': '적에게 주는 피해가 33% 증가한다. 결함: 멀티히트 피해가 10% 감소한다.',
            '은둔자+': '공격력이 33% 증가한다. 결함: 재사용 대기 시간 회복 속도가 9% 감소한다.',
            '망각+': '공격력이 19% 증가한다. 기본 공격 적중 시, 모든 스킬의 재사용 대기 시간이 9% 감소한다.',
            '서리바람+': '공격력이 20% 증가하고, 캐스팅 및 차지 속도가 25% 증가한다.',
            '옛 마법사': '재사용 대기 시간 회복 속도가 29% 증가한다. 결함: 적에게 주는 피해가 10% 감소한다.',
            '물결치는 날': '스킬 사용 시, 다음 기본 공격 적중 시 대상에게 (공격력×n%)의 피해를 추가로 입히고, 다음 1회의 기본 공격 속도가 10% 증가한다.',
            '파괴자+': '공격력이 18% 증가하고, 무방비 피해가 48% 증가한다.',
            '검무+': '누적: 공격이 적중할 때마다 10초 동안 공격력이 2%, 치명타 확률이 1% 증가한다. 해당 효과는 최대 10회까지 중첩되며 지속 시간은 스택마다 개별로 가진다.',
            '무수한 궤적': '공격력이 10%, 기본 공격 속도가 30% 증가하며, 기본 공격 추가타 확률이 30% 증가한다.',
            '마지막 자비': '공격력이 20% 증가한다. 남은 체력이 50% 이하인 적을 공격했을 경우, 10초 동안 공격력이 추가로 20% 증가한다.',
            '끝없는 순환': '축적: 아군을 20회 회복시킨 이후, 다음 공격 적중 시 대상의 위치에 마법진을 펼쳐 9m 범위 내의 적들에게 0.5초마다 (공격력×n%)의 암흑 피해를 4.5초 동안 입힌다. 축적: 적을 20회 공격한 이후, 다음 아군 회복 시 대상의 위치에 마법진을 펼쳐 9m 범위 내의 아군의 체력을 0.5초마다 (공격력×n%)씩 4.5초 동안 회복한다. 축적 효과는 각각 0.5초에 한 번만 획득 할 수 있다.',
            '종언+': '누적: 자신과 전투 중인 적이 처치되었을 경우, 공격력이 20초 동안 2% 증가한다. 해당 효과는 최대 10회까지 중첩되며 지속 시간은 스택마다 개별로 가진다. 공격력이 24% 증가한다.',
            '영웅': '공격력, 연타, 강타, 콤보, 스킬, 치명타, 멀티 히트 피해가 각각 4.3% 증가한다.',
            
            // 방어구 전설
            '여명+': '누적: 스킬을 사용할 때마다 10초 동안 공격력이 3.5% 증가한다. 해당 효과는 최대 6회까지 중첩되며 지속 시간은 스택마다 개별로 가진다.',
            '황혼': '누적: 공격이 적중할 때마다 8초 동안 적에게 주는 피해가 1.4% 증가한다. 해당 효과는 최대 16회까지 중첩되며 지속 시간은 스택마다 개별로 가진다.',
            '바위 감시자': '축적: 강타 7회 적중 시, 6초 동안 공격력이 22% 증가한다.',
            '쇄도+': '스킬 사용 시, 25% 확률로 5초 동안 캐스팅 및 차지 속도와 스킬 사용 속도가 20% 증가한다.',
            '무도가+': '공격력이 12% 증가하며, 궁극기 게이지 획득량 증가',
            '해결사+': '공격 속도가 30% 증가하며, 기본 공격의 추가타 확률이 30% 증가한다.',
            '들불': '지속 피해: 화상을 보유한 적 공격 시, 5초 동안 치명타 확률이 14% 증가한다.(재사용 대기 시간: 3초)',
            '설산': '지속 피해: 빙결을 보유한 적 공격 시, 5초 동안 추가타 확률이 16% 증가한다.(재사용 대기 시간: 3초)',
            '절개+': '지속 피해: 출혈을 보유한 적 공격 시, 5초 동안 공격력이 20% 증가한다.(재사용 대기 시간: 3초)',
            '환영+': '공격력이 18% 증가한다.\n지속 피해: 정신을 보유한 적 공격 시, 약화 효과: 방어구 파괴를 부여해 10초 동안 받는 피해를 10% 증가시킨다.(재사용 대기 시간: 3초)\n방어구 파괴는 중복 적용되지 않는다.',
            '황금 들판': '체력이 75% 이상일 경우, 공격력이 20% 증가한다.',
            '모래 폭풍': '스킬 사용 속도 및 공격 속도가 10% 증가한다.\n무방비 공격 적중 시, 10초 동안 스킬 사용 속도 및 공격 속도가 24% 추가로 증가한다.',
            '황폐+': '보유한 자원이 50% 미만일 경우, 적에게 주는 피해가 12%, 추가타 확률이 7% 증가한다.',
            '신성한 칙령': '아군의 체력을 회복시키면 5초 동안 공격력이 15% 증가하며 회복량이 9% 증가한다.',
            '준비된 자': '퀵슬롯 아이템을 사용했을 경우 15초 동안 적에게 주는 피해가 20% 증가한다. 퀵슬롯의 포션 개수가 2개 증가하며, 붕대 개수가 2개 증가한다.',
            '저무는 달': '누적: 공격력과 방어력 증가, 전투 시작 시, 전투 종료까지 30초마다 공격력과 방어력이 추가로 2%씩 증가하며, 해당 효과는 최대 10회까지 중첩된다.',
            '땅울림': '공격력이 8% 증가한다. 전투 시작 시, 공격력이 30% 증가한다. 증가한 공격력은 매 3초마다 2%씩 감소한다.',
            '신전 기사': '공격력이 23% 증가한다.\n결함: 치명타 확률이 8% 감소한다.',
            '근위병+': '공격력이 23% 증가한다.\n결함: 재사용 대기 시간 회복 속도가 7% 감소한다.',
            '침묵하는 산': '5초 동안 이동하지 않을 경우, 공격력이 22% 증가한다.',
            '필사+': '공격력이 10% 증가한다. 체력이 50% 이하로 감소하면 20초 동안 공격력이 20% 추가로 증가한다.(재사용 대기 시간: 15초)',
            '파멸+': '궁극기 사용 시, 20초 동안 공격력이 25% 증가한다.',
            '집정관': '공격력이 23% 증가한다.\n결함: 스킬 사용 속도와 캐스팅 및 차지 속도 감소',
            '새벽별': '누적: 스킬을 사용할 때마다 8초 동안 스킬 재사용 대기 시간 회복 속도가 3% 빨라진다.\n해당 효과는 최대 6회까지 중첩되며 지속 시간은 스택마다 개별로 가진다.',
            '눈 먼 예언자': '각성의 재사용 대기 시간이 38초 감소한다.',
            '압도적인 힘': '강타 피해가 6%, 공격력이 6%, 치명타 확률이 4% 증가한다. 엠블럼의 각성 효과가 활성화될 때, 20초간 이 룬으로 증가한 능력치가 두배가 된다.',
            '섬세한 손놀림': '연타 피해가 6%, 공격력이 6%, 추가타 확률이 4% 증가한다. 엠블럼의 각성 효과가 활성화될 때, 20초간 이 룬으로 증가한 능력치가 두배가 된다.',
            '성역+': '보호막 계열 효과가 유지되는 동안 공격력이 17% 증가한다. 포션을 사용하거나 30초가 지날 때마다 (공격력×n%)의 피해를 흡수하는 보호막이 생성된다.',
            '불안정한 힘': '전투 시작 시, 적에게 주는 피해가 22% 증가한다. 브레이크 당할 경우 효과가 사라지며, 30초 후에 재활성화된다.',
            '고대 수호자': '공격력이 23% 증가한다.\n결함: 이동 속도가 8% 감소한다.',
            '갈퀴발톱+': '브레이크 스킬로 주는 피해가 24% 증가한다.\n추가로 적에게 주는 브레이크 피해가 24% 증가하며, 무방비 피해가 24% 증가한다.',
            '태양': '3.5초마다 자신 주위 3m 범위 내의 적에게 (공격력×n%)의 피해를 준다.',
            '싹쓸바람': '공격 적중 시, 대상 주위 5m 범위 내의 적들을 중앙으로 3초간 끌어당기며 매 0.5초마다 (공격력×n%)의 피해를 준다.(재사용 대기 시간: 10초)',
            '혼돈': '자신의 공격에 적중당한 대상이 자신으로부터 지속 피해: 화상, 지속 피해: 빙결, 지속 피해: 감전, 지속 피해: 출혈, 지속 피해: 중독, 지속 피해: 암흑, 지속 피해: 정신, 지속 피해: 신성 효과를 받을 때마다 중첩을 쌓는다. 중첩이 3회 쌓일 경우, 중첩을 전부 소모하여 (공격력×n%)의 피해를 준다. 이 효과는 각 대상마다 4초에 한 번만 발동한다.',
            '붕괴하는 별': '자신의 공격이 적에게 적중 할 때마다 중첩을 쌓는다. 중첩이 3회 쌓일 경우, 중첩을 전부 소모하여 (공격력×n%)의 피해를 주고, 자신의 공격력을 10초 동안 10% 증가시킨다. 이 효과는 각 대상마다 3초에 한 번만 발동한다.',
            '돌격대장+': '적을 도발할 경우, 약화 효과: 방어구 파괴를 부여해 10초 동안 받는 피해를 10% 증가시키며, 자신의 공격력을 15초 동안 20% 증가시킨다.\n방어구 파괴는 중복 적용되지 않는다.',
            '지휘관': '강타, 연타, 무방비, 치명타, 추가타 공격 시, 8초 동안 공격력이 4.5% 증가하며, 해당 효과는 최대 5회까지 중첩된다. 각 공격력 증가 효과는 별도의 지속 시간을 가진다.',
            '응징+': '공격력이 12% 증가한다. 자신과 전투 중인 적이 처치되었을 경우, 자신의 체력을 (공격력×n%)만큼 회복한다.',
            '집념+': '캐스팅 및 차지 속도가 25%, 적에게 주는 피해가 10% 증가한다.',
            '분쇄+': '공격력이 6% 증가한다. 무방비 공격 적중 시, 10초 동안 적에게 주는 피해가 28% 증가한다.',
            '쌍둥이 별': '누적 효과가 발생할 때, 추가로 한 번 더 발생한다.\n캐스팅 및 차지 속도, 스킬 사용 속도 증가',
            '푸른 거목': '축적: 스킬을 5회 사용 시, 전투 종료 시까지 스킬 피해량이 2.2% 증가한다. 이 효과는 최대 10회까지 중첩된다.',
            '어두운 징조': '누적: 궁극기 사용 시, 전투가 끝날 때까지 공격력이 0.6%, 치명타 확률이 0.6%, 적에게 주는 피해가 0.6% 증가한다. 이 효과는 최대 30회까지 중첩된다.',
            '요정 무리': '축적: 스킬을 7회 사용 시, 모든 스킬의 재사용 대기 시간이 2.1초 감소한다.(재사용 대기 시간: 3초)',
            '수정 꽃잎': '축적: 치명타 공격을 6회 적중시킬 경우, 다음 공격 적중 시 (공격력×n%)의 피해를 입히고, 자신의 공격력이 10초 동안 12% 증가한다.(재사용 대기 시간: 3초)',
            '나무 사슴': '축적: 추가타 공격을 6회 적중시킬 경우, 다음 공격 적중 시 (공격력×n%)의 피해를 입히고, 자신의 공격력이 10초 동안 12% 증가한다.(재사용 대기 시간: 4초)',
            '에메랄드 숲': '축적: 효과에 필요한 횟수를 누적시킬 때, 1회 추가로 누적시킨다.\n적에게 주는 피해가 10% 증가한다.',
            '불사': '적에게 주는 피해가 18% 증가한다. 행동 불능에 이르는 공격을 1회 막아주고 체력을 대량회복한다. 이 후 3초 동안 받는 피해가 80% 감소한다. 동일한 행동 불능에 저항하는 효과와 재사용 대기 시간을 공유한다.(재사용 대기 시간: 180초)',
            '싸움꾼': '자신 주변 6m 범위 내에 있는 적의 수가 많을수록, 적에게 입히는 피해가 최소 12%에서 최대 16%까지 증가한다. 적에게 받는 피해는 최소 8%에서 최대 12%까지 감소한다. 적이 3명일 때 최대 효과를 가진다.',
            '약탈자': '추가타 적중 시, 체력이 (공격력×n%) 회복된다.(재사용 대기 시간: 1초)\n추가타 확률이 10% 증가한다.',
            '원소 조화': '공격 적중 시, 전방 10m 범위 내의 적에게 3가지 속성의 투사체를 발사하여 각각 (공격력×n%)의 화염, 냉기, 번개 속성 피해를 입힌다.(재사용 대기 시간: 5초)',
            '다가오는 죽음': '적을 향해 느리게 날아가는 암흑 구체를 발사한다. 암흑 구체가 날아간 거리에 비례하여 최소 (공격력×n%) 피해를 입히고, 최대 18m 거리에서 (공격력×n%)의 피해를 입힌다.(재사용 대기 시간: 10초)',
            '잊힌 성소': '축적: 스킬 혹은 기본 공격을 60회 사용 시, 화염, 번개 혹은 얼음의 힘으로 스스로를 감싸 주위 2.5m 범위에 5초 동안 0.1초마다 1.5m 범위를 (공격력×n%)의 피해로 공격하는 원소 화살을 난사한다.',
            
            // 무기 신화
            '만 갈래 물길': '공격력이 15% 증가한다. 클래스 레벨 50을 달성할 때마다 추가로 공격력이 1%씩 증가하며 해당 효과는 최대 20회까지 중첩된다. (모든 클래스로 사용 가능하며, 캐릭터가 달성한 클래스 레벨 정보를 기준으로 효과 적용)',
            '흰 까마귀': '공격, 이동, 스킬 사용 속도, 캐스팅 및 차지 속도, 재사용 대기 시간 회복 속도가 10% 증가한다. 장비를 +10 강화 시, 적에게 주는 피해가 7% 증가한다. 장비를 +15 강화 시, 공격력 7%가 증가한다.',
            '메아리치는 진노': '연타 적중 시, 전방 넓은 범위의 적들에게 (공격력×n%)의 피해와 (공격력×n%)의 지속 피해: 빙결을 준다.\n강타 적중 시, 전방 넓은 범위의 적들에게 (공격력×n%)의 피해와 (공격력×n%)의 지속 피해: 화상을 준다.\n또한, 공격력이 5% 증가한다.\n장비를 +10, +15 강화 시 각각 공격력이 3% 추가로 증가한다.\n(재사용 대기 시간: 각 8초)',
            '무한': '기본 공격 사용 시, 모든 스킬의 재사용 대기 시간이 9% 감소한다.\n공격력이 20% 증가하며, 스킬 사용 시 5초 동안 공격 속도가 12% 증가한다.',
            
            // 방어구 신화
            '닫힌 운명': '공격 적중시, 결계를 생성하여 타겟과 그 주변에 (공격력×n%)의 피해를 입히고, 약화 효과: 방어구 파괴를 부여해 10초 동안 받는 피해를 10% 증가시킨다. 결계는 1, 2, 4겹으로 늘어나며 최대치까지 늘어난 이후에는 다시 1겹으로 돌아온다.(재사용 대기 시간: 5초)\n방어구 파괴는 중복 적용되지 않는다.',
            '검게 물든 후광': '받는 피해가 15%, 적에게 주는 피해가 15% 증가한다.\n아군을 회복시키거나 물약을 사용하면 15초 동안 받는 피해 증가 효과가 무효화된다.\n장비를 +10, +15 강화 시 각각 적에게 주는 피해가 6% 추가로 증가한다.',
            '그림자로 엮은 회랑': '전투 중 각각 2초, 3초, 4초마다 마력 사슬을 발사해 전방의 적들에게 (공격력×n%)의 피해를 준다.\n장비를 +15 강화 시, 5초마다 발사되는 마력 사슬이 추가된다.',
            '바스러지는 빛': '스킬을 사용할 때마다 8초 동안 공격력이 5.5% 증가한다. 해당 효과는 최대 5회까지 중첩되며 지속 시간은 스택마다 개별로 가진다.\n장비를 +15 강화 시, 50% 확률로 추가 중첩이 발생한다.',
            '세상을 삼키는 악의': '원소 지속 피해를 보유한 적에게 주는 피해가 16% 증가하고, 적에게 주는 무방비 피해가 16% 증가한다.\n장비를 +10, +15 강화 시 각각 적에게 주는 피해가 3% 추가로 증가한다.',
            '이름 없는 혼돈': '전투 중, 5초마다 5초 동안 공격력이 10%~30% 증가한다.\n장비를 +15 강화 시, 공격력 증가 최대치가 40%로 변경된다.',
            '영원': '모든 결함 효과를 제거한다.\n공격력이 10% 증가한다.',
            '쏟아지는 별': '전투 중 15초마다 자신 주위 15m 범위 내의 무작위 적을 섬광으로 타격하여 대상에게 (공격력×n%)의 피해를 입히고 대상 주위 2m 범위 내의 대상에게 (공격력×n%)의 피해를 입힌다.\n궁극기를 사용했을 경우, 자신 주위 15m 범위 내의 모든 적들을 섬광으로 타격한다.',
            
            // 앰블럼 전설
            '무자비한 포식자': '무방비 공격 시 각성하여 20초 동안 적에게 주는 스킬 피해가 55% 증가하며, 모든 스킬의 재사용 대기 시간이 초기화 된다.(재사용 대기 시간: 90초)\n상시 효과: 적에게 주는 피해가 21% 증가한다.',
            '순수한 힘': '궁극기 사용 시, 30초 동안 적에게 주는 피해가 27% 증가한다.\n궁극기 게이지 획득량이 20% 증가한다.',
            '부서진 하늘': '공격 시 50% 확률로 각성하여 20초 동안 연타 피해가 60% 증가한다. 또한, 지속 시간 동안 공격 적중 시 (공격력×n%)의 추가 피해를 입히며 이 효과는 0.5초마다 한 번만 적용된다.(재사용 대기 시간: 90초)\n상시 효과: 연타 피해가 8%, 재사용 대기 시간 회복 속도가 8% 증가한다.',
            '인도하는 빛': '궁극기 사용 시, 자신과 주위 15m 내의 아군에게 15초 동안 8%의 공격력 증가 효과를 부여한다.\n아군 회복 시, 15초 동안 자신의 공격력이 20% 증가한다.',
            '대마법사': '공격 시 50% 확률로 각성하여 20초 동안 공격력이 45%, 스킬 캐스팅 및 사용 속도가 25% 증가한다.(재사용 대기 시간: 90초)\n상시 효과: 스킬 사용 속도, 캐스팅 및 차지 속도가 14%, 차지 스킬의 피해량이 14% 증가한다.',
            '흩날리는 검': '공격 시 50% 확률로 각성하여 35초 동안 공격력이 35%, 기본 공격 속도가 20%, 기본 공격의 추가타 확률이 20% 증가한다.(재사용 대기 시간: 90초)\n상시 효과: 기본 공격 속도가 24%, 기본 공격 추가타 확률이 24% 증가한다.',
            '산맥 군주': '공격 시 50% 확률로 각성하여 20초 동안 강타 피해가 60% 증가한다. 또한 지속 시간 동안 공격 적중 시 (공격력×n%)의 추가 피해를 입히며 이 효과는 3초마다 한 번만 적용된다.(재사용 대기 시간: 90초)\n상시 효과: 강타 피해가 8%, 스킬 사용 속도가 8% 증가한다.',
            '아득한 빛': '공격 시 50% 확률로 각성하여 20초 동안 치명타 확률이 20%, 치명타 피해량이 50% 증가한다.(재사용 대기 시간: 90초)\n상시 효과: 치명타 확률이 5%, 치명타 피해량이 10%, 적에게 주는 피해가 5% 증가한다.',
            '갈라진 땅': '공격 시 50% 확률로 각성하여 35초 동안 추가타 확률이 30% 증가하며, 추가타 적중 시 다음 공격은 선행 타격의 18% 만큼의 피해를 주는 추가 공격이 발생한다.(재사용 대기 시간: 90초)\n상시 효과: 추가타 확률이 12% 증가한다.'
        };
        
        // Set 폴백 (구형 브라우저 지원)
        function createSet() {
            if (typeof Set !== 'undefined') {
                return new Set();
            } else {
                // Set이 지원되지 않는 경우 배열로 대체
                var arr = [];
                arr.has = function(value) { return this.indexOf(value) !== -1; };
                arr.add = function(value) { if (!this.has(value)) this.push(value); };
                arr.delete = function(value) { var index = this.indexOf(value); if (index !== -1) this.splice(index, 1); };
                arr.clear = function() { this.length = 0; };
                Object.defineProperty(arr, 'size', { get: function() { return this.length; } });
                return arr;
            }
        }

        var activeFilters = { type: createSet(), grade: createSet(), effect: createSet() };
        var sortState = { columnIndex: 0, direction: 'asc', dataType: 'str' };

        // 디버깅용 환경 정보 출력
        function logEnvironmentInfo() {
            console.log('=== 환경 정보 ===');
            console.log('User Agent:', navigator.userAgent);
            console.log('화면 크기:', window.innerWidth, 'x', window.innerHeight);
            console.log('Document Ready State:', document.readyState);
            console.log('JavaScript 지원:', typeof Array.from !== 'undefined');
            console.log('CSS Grid 지원:', typeof CSS !== 'undefined' && CSS.supports('display', 'grid'));
        }

        var isInitialized = false;  // 전역 스코프로 이동

        // 초성 추출 함수
        function getInitialConsonant(str) {
            const initialConsonants = ['ㄱ', 'ㄲ', 'ㄴ', 'ㄷ', 'ㄸ', 'ㄹ', 'ㅁ', 'ㅂ', 'ㅃ', 'ㅅ', 'ㅆ', 'ㅇ', 'ㅈ', 'ㅉ', 'ㅊ', 'ㅋ', 'ㅌ', 'ㅍ', 'ㅎ'];
            let result = '';
            for (let i = 0; i < str.length; i++) {
                const code = str.charCodeAt(i);
                if (code >= 0xAC00 && code <= 0xD7A3) {
                    const initialCode = Math.floor((code - 0xAC00) / 28 / 21);
                    result += initialConsonants[initialCode];
                } else {
                    result += str[i];
                }
            }
            return result;
        }

        // 자동완성 기능 추가
        function setupAutocomplete() {
            const searchInput = document.getElementById('name-search');
            const container = document.createElement('div');
            container.className = 'autocomplete-container';
            searchInput.parentNode.insertBefore(container, searchInput);
            container.appendChild(searchInput);
            
            const dropDown = document.createElement('div');
            dropDown.className = 'autocomplete-items';
            dropDown.style.display = 'none';
            container.appendChild(dropDown);

            searchInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const initialValue = getInitialConsonant(value);
                dropDown.innerHTML = '';
                
                if (!value) {
                    dropDown.style.display = 'none';
                    return;
                }

                const matches = runeData.filter(rune => {
                    const name = rune.name.toLowerCase();
                    const initial = getInitialConsonant(name);
                    return name.includes(value) || initial.includes(initialValue);
                }).slice(0, 5); // 최대 5개까지만 표시

                if (matches.length > 0) {
                    dropDown.style.display = 'block';
                    matches.forEach(rune => {
                        const div = document.createElement('div');
                        div.textContent = rune.name;
                        div.addEventListener('click', function() {
                            searchInput.value = rune.name;
                            dropDown.style.display = 'none';
                            applyFilters();
                        });
                        dropDown.appendChild(div);
                    });
                } else {
                    dropDown.style.display = 'none';
                }
            });

            // 클릭 이벤트로 드롭다운 닫기
            document.addEventListener('click', function(e) {
                if (!container.contains(e.target)) {
                    dropDown.style.display = 'none';
                }
            });
        }

        // 더 안전한 초기화
        function initializePage() {
            try {
                if (isInitialized) {
                    console.log('이미 초기화되어 있음, 중복 초기화 방지');
                    return;
                }
                isInitialized = true;
                
                logEnvironmentInfo();
                console.log('페이지 초기화 시작');
                
                // 기본 데이터 확인
                console.log('runeData 길이:', runeData.length);
                console.log('effectCategories 키 개수:', Object.keys(effectCategories).length);
                
                generateTable();
                console.log('테이블 생성 완료');
                
                generateFilterButtons();
                console.log('필터 버튼 생성 완료');
                
                sortTable(0, 'str'); // Default sort by name
                console.log('정렬 완료');
                
                initializeDescriptionToggle(); // 초기 상태 설정
                console.log('설명 토글 초기화 완료');
                
                setupButtonEvents();
                console.log('버튼 이벤트 설정 완료');

                setupAutocomplete();
                console.log('자동완성 설정 완료');
                
                console.log('페이지 초기화 완료');
            } catch (error) {
                console.error('페이지 초기화 오류:', error);
                console.error('오류 스택:', error.stack);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (!isInitialized) {
                initializePage();
            }
        });

        window.addEventListener('load', function() {
            if (!isInitialized) {
                setTimeout(initializePage, 100);
            }
        });

        function setupButtonEvents() {
            // 버튼 텍스트 업데이트만 수행 (onclick은 HTML에서 직접 처리)
            const toggleBtn = document.getElementById('toggleDescBtn');
            if (toggleBtn && toggleBtn.textContent === '설명 토글') {
                const isMobile = window.innerWidth <= 768;
                toggleBtn.textContent = isMobile ? '설명 활성화' : '설명 비활성화';
                if (!isMobile) {
                    toggleBtn.classList.add('inactive');
                }
            }
        }

        function initializeDescriptionToggle() {
            const toggleBtn = document.getElementById('toggleDescBtn');
            if (!toggleBtn) {
                console.error('toggleDescBtn을 찾을 수 없습니다');
                return;
            }
            
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                toggleBtn.textContent = '설명 활성화';
                toggleBtn.classList.remove('inactive');
            } else {
                toggleBtn.textContent = '설명 비활성화';
                toggleBtn.classList.add('inactive');
            }
            console.log('버튼 초기화 완료:', toggleBtn.textContent);
        }

        function toggleDescription(event) {
            // 터치 이벤트 중복 방지
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const descColumns = document.querySelectorAll('.description-column');
            const toggleBtn = document.getElementById('toggleDescBtn');
            
            if (!descColumns.length || !toggleBtn) return;
            
            // 현재 상태 확인
            const isHidden = descColumns[0].classList.contains('force-hide') || 
                           (window.innerWidth <= 768 && !descColumns[0].classList.contains('force-show'));
            
            if (isHidden) {
                // 설명 보이기
                descColumns.forEach(col => {
                    col.classList.remove('force-hide');
                    col.classList.add('force-show');
                });
                toggleBtn.textContent = '설명 비활성화';
                toggleBtn.classList.add('inactive');
            } else {
                // 설명 숨기기
                descColumns.forEach(col => {
                    col.classList.remove('force-show');
                    col.classList.add('force-hide');
                });
                toggleBtn.textContent = '설명 활성화';
                toggleBtn.classList.remove('inactive');
            }
        }

        // 화면 크기 변경 시 버튼 텍스트 및 색상 업데이트
        window.addEventListener('resize', function() {
            const toggleBtn = document.getElementById('toggleDescBtn');
            const descColumns = document.querySelectorAll('.description-column');
            
            if (descColumns.length > 0) {
                const isForceShow = descColumns[0].classList.contains('force-show');
                const isForceHide = descColumns[0].classList.contains('force-hide');
                
                if (!isForceShow && !isForceHide) {
                    // 자동 상태일 때만 버튼 상태 업데이트
                    const isMobile = window.innerWidth <= 768;
                    if (isMobile) {
                        toggleBtn.textContent = '설명 활성화';
                        toggleBtn.classList.remove('inactive');
                    } else {
                        toggleBtn.textContent = '설명 비활성화';
                        toggleBtn.classList.add('inactive');
                    }
                }
            }
        });

        function generateTable() {
            try {
                console.log('테이블 생성 시작');
                
                const tbody = document.querySelector('tbody');
                if (!tbody) {
                    console.error('tbody를 찾을 수 없습니다');
                    return;
                }
                
                tbody.innerHTML = '';
                
                for (var runeIndex = 0; runeIndex < runeData.length; runeIndex++) {
                    var rune = runeData[runeIndex];
                    var rowSpan = rune.effects.length || 1;
                    var mainRow = document.createElement('tr');
                    var firstEffect = rune.effects[0] || { effect: '-', value: '-' };
                    var description = allDescriptions[rune.name] || '설명 없음';

                    // 체크박스 셀 추가
                    var checkboxCell = document.createElement('td');
                    checkboxCell.rowSpan = rowSpan;
                    var checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'rune-checkbox';
                    checkbox.setAttribute('data-rune-type', rune.type);
                    checkbox.setAttribute('data-rune-name', rune.name);
                    checkbox.onclick = handleRuneSelection;
                    checkboxCell.appendChild(checkbox);

                    mainRow.appendChild(checkboxCell);

                    var nameCell = document.createElement('td');
                    nameCell.rowSpan = rowSpan;
                    nameCell.textContent = rune.name;
                    mainRow.appendChild(nameCell);

                    var keywordCell = document.createElement('td');
                    keywordCell.rowSpan = rowSpan;
                    keywordCell.textContent = rune.keyword;
                    mainRow.appendChild(keywordCell);

                    var effectCell = document.createElement('td');
                    effectCell.textContent = firstEffect.effect;
                    mainRow.appendChild(effectCell);

                    var valueCell = document.createElement('td');
                    valueCell.textContent = firstEffect.value;
                    mainRow.appendChild(valueCell);

                    var conditionCell = document.createElement('td');
                    conditionCell.textContent = firstEffect.condition || rune.condition || '-';
                    mainRow.appendChild(conditionCell);

                    var descCell = document.createElement('td');
                    descCell.className = 'description-column';
                    descCell.rowSpan = rowSpan;
                    descCell.textContent = description;
                    mainRow.appendChild(descCell);
                    
                    tbody.appendChild(mainRow);

                    for (var i = 1; i < rowSpan; i++) {
                        var subRow = document.createElement('tr');
                        var effect = rune.effects[i];
                        subRow.innerHTML = 
                            '<td>' + effect.effect + '</td>' +
                            '<td>' + effect.value + '</td>' +
                            '<td>' + (effect.condition || '-') + '</td>';
                        tbody.appendChild(subRow);
                    }
                }
                
                console.log('테이블 생성 완료. 총 룬 개수:', runeData.length);
                
            } catch (error) {
                console.error('테이블 생성 오류:', error);
            }
        }

        // 룬 선택 처리
        var selectedRunes = {
            무기: [],
            방어구: [],
            앰블럼: []
        };

        const maxSelections = {
            무기: 1,
            방어구: 5,
            앰블럼: 1
        };

        function handleRuneSelection(event) {
            const checkbox = event.target;
            const type = checkbox.getAttribute('data-rune-type');
            const name = checkbox.getAttribute('data-rune-name');

            if (checkbox.checked) {
                // 최대 선택 개수 체크
                if (selectedRunes[type].length >= maxSelections[type]) {
                    checkbox.checked = false;
                    alert(`${type} 룬은 최대 ${maxSelections[type]}개까지만 선택할 수 있습니다.`);
                    return;
                }
                selectedRunes[type].push(name);
            } else {
                selectedRunes[type] = selectedRunes[type].filter(n => n !== name);
            }

            updateSelectedCounts();
            updateCheckboxStates();
            calculateEffects();
        }

        function updateSelectedCounts() {
            document.getElementById('weapon-count').textContent = selectedRunes['무기'].length;
            document.getElementById('armor-count').textContent = selectedRunes['방어구'].length;
            document.getElementById('emblem-count').textContent = selectedRunes['앰블럼'].length;
        }

        function updateCheckboxStates() {
            const checkboxes = document.querySelectorAll('.rune-checkbox');
            checkboxes.forEach(checkbox => {
                const type = checkbox.getAttribute('data-rune-type');
                if (!checkbox.checked && selectedRunes[type].length >= maxSelections[type]) {
                    checkbox.disabled = true;
                } else {
                    checkbox.disabled = false;
                }
            });
        }

        function calculateEffects() {
            const effectSums = {};
            const effectSources = {};
            
            // 선택된 모든 룬의 효과 수집
            Object.keys(selectedRunes).forEach(type => {
                selectedRunes[type].forEach(runeName => {
                    const rune = runeData.find(r => r.name === runeName);
                    if (!rune) return;

                    rune.effects.forEach(effect => {
                        if (!effect.value) return;
                        const effectName = effect.effect;
                        const valueMatch = effect.value.match(/(\d+(?:\.\d+)?)/);
                        const value = valueMatch ? parseFloat(valueMatch[1]) : 0;
                        
                        if (!effectSums[effectName]) {
                            effectSums[effectName] = 0;
                            effectSources[effectName] = [];
                        }
                        effectSums[effectName] += value;
                        effectSources[effectName].push({
                            name: runeName,
                            value: effect.value
                        });
                    });
                });
            });

            // 결과 표시
            const resultDiv = document.getElementById('effect-sums');
            resultDiv.innerHTML = '';
            
            Object.keys(effectSums).forEach(effect => {
                if (effectSums[effect] > 0) {
                    const sources = effectSources[effect];
                    const total = effectSums[effect].toFixed(1) + '%';
                    const parts = sources.map(s => s.value).join(' + ');
                    const runes = sources.map(s => `[${s.name}]`).join(' + ');
                    
                    const effectDiv = document.createElement('div');
                    effectDiv.className = 'effect-sum';
                    effectDiv.innerHTML = `
                        <div><strong>${effect}:</strong> ${total} = ${parts}</div>
                        <div class="rune-list">${runes}</div>
                    `;
                    resultDiv.appendChild(effectDiv);
                }
            });

            document.getElementById('calculation-result').style.display = 
                Object.keys(effectSums).length > 0 ? 'block' : 'none';
        }

        function generateFilterButtons() {
            try {
                console.log('필터 버튼 생성 시작');
                
                const typeContainer = document.getElementById('type-filters');
                if (!typeContainer) {
                    console.error('type-filters 컨테이너를 찾을 수 없습니다');
                    return;
                }
                
                var typeItems = ['무기', '방어구', '앰블럼', '장신구'];
                for (var i = 0; i < typeItems.length; i++) {
                    var item = typeItems[i];
                    var button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.textContent = item;
                    button.setAttribute('data-filter-type', 'type');
                    button.setAttribute('data-filter-value', item);
                    button.onclick = function() {
                        toggleFilter(this.getAttribute('data-filter-type'), this.getAttribute('data-filter-value'), this);
                    };
                    typeContainer.appendChild(button);
                }
                console.log('종류 필터 버튼 생성 완료');

                const gradeContainer = document.getElementById('grade-filters');
                if (!gradeContainer) {
                    console.error('grade-filters 컨테이너를 찾을 수 없습니다');
                    return;
                }
                
                var gradeItems = ['전설', '신화'];
                for (var j = 0; j < gradeItems.length; j++) {
                    var item = gradeItems[j];
                    var button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.textContent = item;
                    button.setAttribute('data-filter-type', 'grade');
                    button.setAttribute('data-filter-value', item);
                    button.onclick = function() {
                        toggleFilter(this.getAttribute('data-filter-type'), this.getAttribute('data-filter-value'), this);
                    };
                    gradeContainer.appendChild(button);
                }
                console.log('등급 필터 버튼 생성 완료');
                
                const effectContainer = document.getElementById('effect-filters');
                if (!effectContainer) {
                    console.error('effect-filters 컨테이너를 찾을 수 없습니다');
                    return;
                }
                
                var categories = Object.keys(effectCategories);
                for (var k = 0; k < categories.length; k++) {
                    var category = categories[k];
                    var button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.textContent = category;
                    button.setAttribute('data-filter-type', 'effect');
                    button.setAttribute('data-filter-value', category);
                    button.onclick = function() {
                        toggleFilter(this.getAttribute('data-filter-type'), this.getAttribute('data-filter-value'), this);
                    };
                    effectContainer.appendChild(button);
                }
                console.log('효과 필터 버튼 생성 완료');
                
            } catch (error) {
                console.error('필터 버튼 생성 오류:', error);
            }
        }

        function toggleFilter(category, value, element) {
            const filterSet = activeFilters[category];
            if (filterSet.has(value)) {
                filterSet.delete(value);
                element.classList.remove('active');
            } else {
                filterSet.add(value);
                element.classList.add('active');
            }
            applyFilters();
            sortTable(sortState.columnIndex, sortState.dataType, true);
        }

        function applyFilters() {
            console.log('Active filters:', activeFilters);
            
            const runeGroups = getRuneGroups();
            runeGroups.forEach(group => {
                const rune = runeData.find(r => r.name === group.mainRow.cells[1].innerText);
                if (!rune) return;

                console.log('\nChecking rune:', rune.name);
                console.log('Rune effects:', rune.effects);

                const typeMatch = activeFilters.type.size === 0 || activeFilters.type.has(rune.type);
                const gradeMatch = activeFilters.grade.size === 0 || activeFilters.grade.has(rune.grade);
                
                // 효과 필터 체크
                const effectMatch = activeFilters.effect.size === 0 || Array.from(activeFilters.effect).every(category => {
                    const match = rune.effects.some(eff => checkEffectAgainstCategory(eff.effect, eff.value, category));
                    console.log(`Effect match for ${category}:`, match);
                    return match;
                });

                // 이름 검색 조건
                const nameSearch = document.getElementById('name-search').value.toLowerCase();
                const initialValue = getInitialConsonant(nameSearch);
                const nameMatch = !nameSearch || 
                    rune.name.toLowerCase().includes(nameSearch) || 
                    getInitialConsonant(rune.name.toLowerCase()).includes(initialValue);

                const shouldShow = typeMatch && gradeMatch && effectMatch && nameMatch;
                console.log('Final visibility:', shouldShow);

                group.rows.forEach(row => {
                    row.style.display = shouldShow ? '' : 'none';
                });
            });
        }

        function getRuneGroups() {
            const rows = Array.from(document.querySelector('tbody').rows);
            const runeGroups = [];
            let currentGroup = null;

            rows.forEach(row => {
                // 체크박스 열이 있는 행이 메인 행
                if (row.cells[0].hasAttribute('rowspan')) {
                    if (currentGroup) runeGroups.push(currentGroup);
                    currentGroup = { mainRow: row, rows: [row] };
                } else if (currentGroup) {
                    currentGroup.rows.push(row);
                }
            });
            if (currentGroup) runeGroups.push(currentGroup);
            return runeGroups;
        }

        function checkEffectAgainstCategory(effectText, effectValue, category) {
            console.log('Checking effect:', effectText, 'value:', effectValue, 'for category:', category);
            
            // 공격력 증가 카테고리 특별 처리
            if (category === '공격력 증가') {
                // 효과 이름에 '공격력'이 포함되어 있고, 값에 숫자가 있는지 확인
                const hasAttackPower = effectText.includes('공격력');
                const hasNumber = effectValue && /\d+/.test(effectValue);
                
                console.log('Effect check:', {
                    text: effectText,
                    value: effectValue,
                    hasAttackPower,
                    hasNumber
                });
                
                return hasAttackPower && hasNumber;
            }
            
            // 다른 카테고리들의 처리
            const normalizedEffect = effectText.toUpperCase().split(' (')[0].trim();
            const categoryKeywords = effectCategories[category].map(e => e.toUpperCase());
            
            // 쉼표로 구분된 여러 효과가 있는 경우 (예: '영웅' 룬)
            if (normalizedEffect.includes(',')) {
                return categoryKeywords.some(keyword => 
                    normalizedEffect.includes(keyword.replace(/ 증가| 피해/g, '').trim())
                );
            }
            
            return categoryKeywords.includes(normalizedEffect);
        }

        function clearAllFilters(event) {
            try {
                console.log('필터 초기화 시작');
                
                if (event) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                
                // 이름 검색 초기화
                document.getElementById('name-search').value = '';
                
                // 필터 초기화
                for (var key in activeFilters) {
                    if (activeFilters.hasOwnProperty(key)) {
                        activeFilters[key].clear();
                    }
                }
                
                // 버튼 스타일 초기화
                var activeButtons = document.querySelectorAll('.filter-btn.active');
                for (var i = 0; i < activeButtons.length; i++) {
                    activeButtons[i].classList.remove('active');
                }

                // 체크박스 초기화
                var checkboxes = document.querySelectorAll('.rune-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                    checkbox.disabled = false;
                });

                // 선택된 룬 초기화
                selectedRunes = {
                    무기: [],
                    방어구: [],
                    앰블럼: []
                };

                // 선택 개수 표시 초기화
                updateSelectedCounts();

                // 계산 결과 숨기기
                document.getElementById('calculation-result').style.display = 'none';
                
                applyFilters();
                sortTable(0, 'str', true);
                
                console.log('필터 초기화 완료');
                
            } catch (error) {
                console.error('필터 초기화 오류:', error);
            }
        }
        
        function parseNumericValue(text) {
            if (typeof text !== 'string' || text === '-') return -Infinity;
            var maxMatch = text.match(/최대 ([\d.]+)/);
            if (maxMatch) return parseFloat(maxMatch[1]);
            var numMatch = text.match(/([\d.]+)/);
            return numMatch ? parseFloat(numMatch[1]) : -Infinity;
        }
        
        function getGroupSortValue(group, columnIndex) {
            const runeName = group.mainRow.cells[1].innerText;  // 체크박스 열 고려
            const rune = runeData.find(r => r.name === runeName);
            if (!rune) return null;
            
            // 수치 열의 경우 숫자만 추출
            if (columnIndex === 4) {  // 수치 열
                // 활성화된 필터가 있는지 확인
                const activeEffectFilters = Array.from(activeFilters.effect);
                
                // 공격력 증가 필터가 활성화된 경우
                if (activeEffectFilters.includes('공격력 증가')) {
                    // 공격력 증가 효과만 찾아서 수치 반환
                    const attackPowerEffects = rune.effects.filter(effect => 
                        effect.effect.includes('공격력') && 
                        effect.effect.includes('증가') &&
                        !effect.effect.includes('추가') &&  // "추가 증가"는 제외
                        effect.value
                    );
                    
                    if (attackPowerEffects.length > 0) {
                        return Math.max(...attackPowerEffects.map(effect => getNumericValue(effect.value)));
                    }
                    return -Infinity;
                }

                // 피해 증가 필터가 활성화된 경우
                if (activeEffectFilters.includes('피해 증가')) {
                    // 적에게 주는 피해 증가 효과만 찾아서 수치 반환
                    const damageEffects = rune.effects.filter(effect => 
                        effectCategories['피해 증가'].some(keyword => 
                            effect.effect.toUpperCase() === keyword.toUpperCase()
                        ) &&
                        effect.value
                    );
                    
                    if (damageEffects.length > 0) {
                        return Math.max(...damageEffects.map(effect => getNumericValue(effect.value)));
                    }
                    return -Infinity;
                }
                
                // 다른 경우는 모든 효과의 수치 중 가장 큰 값을 찾음
                let maxValue = -Infinity;
                rune.effects.forEach(effect => {
                    if (effect.value) {
                        const value = getNumericValue(effect.value);
                        if (value > maxValue) maxValue = value;
                    }
                });
                return maxValue;
            }
            
            return group.mainRow.cells[columnIndex].innerText;
        }

        function sortTable(columnIndex, dataType, keepDirection = false) {
            if (!keepDirection) {
                if (sortState.columnIndex === columnIndex) {
                    sortState.direction = sortState.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    sortState.columnIndex = columnIndex;
                    sortState.direction = 'asc';
                }
            }
            sortState.dataType = dataType;
            const direction = sortState.direction === 'asc' ? 1 : -1;

            const runeGroups = getRuneGroups();
            runeGroups.sort((groupA, groupB) => {
                const valA = getGroupSortValue(groupA, sortState.columnIndex);
                const valB = getGroupSortValue(groupB, sortState.columnIndex);

                if (sortState.dataType === 'num') {
                    if (valA === -Infinity && valB !== -Infinity) return 1 * direction;
                    if (valB === -Infinity && valA !== -Infinity) return -1 * direction;
                    return (valB - valA) * direction;  // 내림차순으로 변경
                }
                return (valA || '').localeCompare(valB || '', 'ko') * direction;
            });
            
            const tbody = document.querySelector('tbody');
            tbody.innerHTML = '';
            runeGroups.forEach(group => {
                group.rows.forEach(row => {
                    row.style.display = group.mainRow.style.display; 
                    tbody.appendChild(row);
                });
            });
            
            updateSortIndicators();
        }
        
        function updateSortIndicators() {
            document.querySelectorAll('th .sort-indicator').forEach(span => span.textContent = '');
            const indicator = document.querySelector(`th:nth-child(${sortState.columnIndex + 1}) .sort-indicator`);
            if(indicator) indicator.textContent = sortState.direction === 'asc' ? '▲' : '▼';
        }

        // 이름 검색 이벤트 리스너 추가
        document.addEventListener('DOMContentLoaded', function() {
            const nameSearch = document.getElementById('name-search');
            if (nameSearch) {
                nameSearch.addEventListener('input', function() {
                    applyFilters();
                });
            }
        });

        function getNumericValue(text) {
            if (!text) return -Infinity;
            
            // "최대 X%" 형식 체크
            const maxMatch = text.match(/최대\s*(\d+(?:\.\d+)?)/);
            if (maxMatch) {
                return parseFloat(maxMatch[1]);
            }
            
            // "X% (최대 Y%)" 형식 체크
            const maxInParenMatch = text.match(/\d+(?:\.\d+)?%\s*\(최대\s*(\d+(?:\.\d+)?)/);
            if (maxInParenMatch) {
                return parseFloat(maxInParenMatch[1]);
            }

            // 일반 숫자 추출
            const matches = text.match(/(\d+(?:\.\d+)?)/g);
            if (!matches) return -Infinity;
            
            // 여러 숫자 중 가장 큰 값 반환
            return Math.max(...matches.map(m => parseFloat(m)));
        }
    </script>
</body>
</html> 