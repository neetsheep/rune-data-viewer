<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>룬 정보</title>
    <style>
        /* 네비게이션 바 스타일 */
        .main-nav {
            position: sticky;
            top: 0;
            background: #2c3e50;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            margin: 0;
        }
        
        .nav-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
            padding: 12px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .nav-item {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            white-space: nowrap;
        }
        
        .nav-item:hover {
            background: #4CAF50;
            transform: translateY(-2px);
        }
        
        .nav-item:active {
            transform: translateY(0);
        }
        
        /* 부드러운 스크롤 */
        html {
            scroll-behavior: smooth;
            scroll-padding-top: 80px;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 0 20px 20px 20px;
        }
        .container {
            max-width: 98%;
            margin: 0 auto;
            padding: 20px 0 0 0;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin: 0;
            padding: 20px 0;
            font-size: 24px;
        }
        h1 small {
            font-size: 16px;
            color: #666;
            margin-left: 10px;
        }

        .controls {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .filter-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .filter-section:last-child {
            border-bottom: none;
        }
        .filter-section strong {
            white-space: nowrap;
            font-size: 15px;
            min-width: 80px;
            font-weight: 600;
        }
        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .filter-btn {
            padding: 8px 16px;
            font-size: 14px;
            background-color: #f8f9fa;
            color: #333;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 60px;
            text-align: center;
            font-weight: 500;
        }
        .filter-btn:hover {
            background-color: #e9ecef;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .filter-btn.active {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
            border-color: #4CAF50;
        }
        .filter-btn:active {
            transform: scale(0.98);
        }
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        #clearFilterBtn {
            flex-grow: 1;
            min-width: 120px;
            padding: 12px 20px;
            font-size: 15px;
            color: white !important;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            transition: all 0.2s;
            text-align: center;
            background-color: #f44336;
        }
        #clearFilterBtn:hover {
            background-color: #d32f2f;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(244,67,54,0.3);
        }

        /* 유저 스테이터스 섹션 */
        .user-stats-section {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .user-stats-section h2 {
            margin: 0 0 15px 0;
            font-size: 18px;
            color: #2c3e50;
            font-weight: 600;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        
        .user-stats-section h3 {
            margin: 25px 0 15px 0;
            font-size: 16px;
            color: #2c3e50;
            font-weight: 600;
            border-bottom: 2px solid #2196F3;
            padding-bottom: 8px;
        }
        
        .stats-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .stats-column {
            flex: 1;
            min-width: 250px;
        }
        
        .stat-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            gap: 15px;
            position: relative;
        }
        
        .stat-row label {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            min-width: 100px;
        }
        
        .stat-row input[type="number"] {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            text-align: right;
            transition: all 0.2s;
            width: 120px;
        }
        
        .percent-symbol {
            font-size: 14px;
            font-weight: 500;
            color: #666;
            margin-left: 3px;
        }
        
        .stat-row input[type="number"]:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76,175,80,0.1);
        }
        
        .stat-row input[type="number"]:hover {
            border-color: #4CAF50;
        }
        
        /* 숫자 입력 화살표 스타일 */
        .stat-row input[type="number"]::-webkit-inner-spin-button,
        .stat-row input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
        }
        
        /* 강화류 토글 스타일 */
        .enhancement-toggles {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .toggle-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .toggle-item:hover {
            background: #e9ecef;
        }
        
        .toggle-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #4CAF50;
        }
        
        .toggle-item span {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }
        
        .toggle-item:has(input:checked) {
            background: #e8f5e9;
            border-color: #4CAF50;
        }

        .selected-count {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: clamp(25px, 5vw, 40px) var(--padding-xlarge);
            border-radius: clamp(8px, 2vw, 12px);
            margin: var(--padding-xlarge) 0;
            display: flex;
            justify-content: space-evenly;
            align-items: stretch; /* center에서 stretch로 변경 */
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
            width: 100%;
            box-sizing: border-box;
        }
        
        .count-item {
            text-align: center;
            padding: var(--padding-large);
            border-radius: clamp(6px, 1.5vw, 8px);
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            min-width: clamp(100px, 25vw, 140px);
            flex: 0 0 auto;
            max-width: clamp(120px, 30vw, 180px);
            transition: all 0.2s;
            margin: clamp(15px, 3vw, 25px) 0; /* 위아래 마진 추가 */
        }
        
        .count-label {
            font-size: clamp(14px, 3vw, 16px);
            color: #666;
            margin-bottom: clamp(12px, 3vw, 18px); /* 라벨과 값 사이의 간격도 더 크게 */
            font-weight: 500;
        }
        
        .count-value {
            font-size: clamp(18px, 4vw, 22px); /* 값 텍스트를 더 크게 */
            font-weight: bold;
            color: #4CAF50;
        }
        
        .count-value span {
            font-size: clamp(22px, 5vw, 28px); /* 숫자 텍스트를 더 크게 */
            color: #f44336;
            transition: color 0.3s;
        }
        
        .count-value span.completed {
            color: #2e7d32 !important; /* 완료 시 초록색 */
            font-weight: bold;
        }
        
        .count-value span.zero-count {
            color: #f44336 !important;
            font-weight: bold;
        }
        
        /* 모바일에서 세로 배치 제거하고 가로 유지 */
        @media screen and (max-width: 768px) {
            .selected-count {
                gap: clamp(15px, 4vw, 25px);
                padding: clamp(10px, 2.5vw, 15px); /* 모바일에서는 기존 패딩 유지 */
            }
            
            .count-item {
                min-width: clamp(80px, 20vw, 100px);
                padding: clamp(10px, 2.5vw, 15px);
                max-width: clamp(100px, 25vw, 120px);
            }
            
            .count-label {
                font-size: clamp(10px, 2.2vw, 12px);
                margin-bottom: clamp(6px, 1.5vw, 8px);
            }
            
            .count-value {
                font-size: clamp(14px, 3vw, 16px);
            }
            
            .count-value span {
                font-size: clamp(16px, 3.5vw, 20px);
            }
        }

        /* 매우 작은 화면 (480px 이하)에서 추가 조정 */
        @media screen and (max-width: 480px) {
            .selected-count {
                gap: clamp(12px, 3vw, 20px); /* 작은 화면에서도 적당한 간격 유지 */
                padding: clamp(8px, 2vw, 12px);
            }
            
            .count-item {
                min-width: clamp(70px, 18vw, 90px);
                padding: clamp(8px, 2vw, 12px);
                max-width: clamp(90px, 22vw, 110px);
            }
            
            .count-label {
                font-size: clamp(9px, 2vw, 11px);
                margin-bottom: clamp(5px, 1.2vw, 7px);
            }
            
            .count-value {
                font-size: clamp(12px, 2.5vw, 14px);
            }
            
            .count-value span {
                font-size: clamp(14px, 3vw, 18px);
            }
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 14px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            background: white;
            table-layout: fixed;
        }
        
        /* 컬럼 폭 설정 */
        table th:nth-child(1),
        table td:nth-child(1) {
            width: 5%;
            min-width: 5%;
        }
        
        table th:nth-child(2),
        table td:nth-child(2) {
            width: 15%;
            min-width: 15%;
        }
        
        table th:nth-child(3),
        table td:nth-child(3) {
            width: 10%;
            min-width: 10%;
        }
        
        table th:nth-child(4),
        table td:nth-child(4) {
            width: 70%;
            min-width: 70%;
        }
        
        /* 선택, 이름, 특징 열 가운데 정렬 */
        table th:nth-child(1),
        table td:nth-child(1),
        table th:nth-child(2),
        table td:nth-child(2),
        table th:nth-child(3),
        table td:nth-child(3) {
            text-align: center;
        }

        th, td {
            padding: clamp(6px, 1.5vw, 10px) clamp(8px, 2vw, 12px); /* 패딩을 더 작게 조정 */
            border: 1px solid #ddd;
            text-align: left; /* 원래대로 왼쪽 정렬 복원 */
            vertical-align: middle;
            transition: background-color 0.2s;
            font-size: clamp(10px, 2vw, 14px); /* 셀 텍스트 크기도 조정 */
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        th {
            background-color: #3a7e3d;
            color: white;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
            font-weight: 600;
            font-size: clamp(9px, 1.8vw, 12px); /* 헤더 텍스트를 더 작게 */
        }
        
        th:hover {
            background-color: #2e6b31;
        }
        
        .sort-indicator {
            display: inline-block;
            margin-left: 5px;
            opacity: 0.8;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e3f2fd;
        }
        
        /* 모바일 반응형 설정 */
        @media screen and (max-width: 768px) {
            body {
                padding: var(--padding-small);
            }
            .description-column:not(.force-show) {
                display: none !important;
            }
            .filter-section {
                flex-direction: column;
                align-items: flex-start;
                gap: clamp(6px, 1.5vw, 8px);
            }
            .filter-section strong {
                font-size: var(--small-font-size);
            }
            
            /* 모바일에서 테이블 텍스트 크기 추가 조정 */
            table {
                font-size: clamp(8px, 1.8vw, 12px);
            }
            th, td {
                padding: clamp(4px, 1vw, 8px) clamp(6px, 1.5vw, 10px);
                font-size: clamp(8px, 1.8vw, 12px);
            }
            th {
                font-size: clamp(7px, 1.5vw, 10px);
            }
        }
        
        /* 작은 화면 (400px 이하) 최적화 */
        @media screen and (max-width: 400px) {
            * {
                box-sizing: border-box;
            }
            
            /* 네비게이션 바 모바일 최적화 */
            .nav-container {
                padding: 6px 5px;
                gap: 3px;
            }
            
            .nav-item {
                padding: 6px 10px;
                font-size: 10px;
                border-radius: 4px;
            }
            
            html {
                scroll-padding-top: 60px;
            }
            
            body {
                padding: 0 3px 3px 3px;
                overflow-x: hidden;
            }
            
            .container {
                padding: 5px;
                width: 100%;
                max-width: 100%;
                overflow-x: hidden;
            }
            
            h1 {
                font-size: 16px;
                margin-bottom: 8px;
                word-break: keep-all;
            }
            
            h1 small {
                font-size: 11px;
                display: block;
                margin-top: 2px;
            }
            
            /* 필터 섹션 최적화 */
            .controls {
                padding: 5px;
                gap: 5px;
            }
            
            .filter-section {
                gap: 3px;
                width: 100%;
            }
            
            .filter-section strong {
                font-size: 10px;
            }
            
            .filter-group {
                gap: 3px;
                flex-wrap: wrap;
            }
            
            .filter-group button {
                padding: 3px 5px;
                font-size: 8px;
                white-space: nowrap;
                line-height: 1.2;
            }
            
            #clearFilterBtn {
                padding: 4px 8px;
                font-size: 9px;
            }
            
            #name-search {
                font-size: 11px;
                padding: 5px;
                width: 100% !important;
                max-width: 150px;
            }
            
            /* 테이블 컬럼 비율 재조정 */
            table th:nth-child(1),
            table td:nth-child(1) {
                width: 6%;
                min-width: 6%;
                padding: 2px 1px;
            }
            
            table th:nth-child(2),
            table td:nth-child(2) {
                width: 20%;
                min-width: 20%;
            }
            
            table th:nth-child(3),
            table td:nth-child(3) {
                width: 15%;
                min-width: 15%;
            }
            
            table th:nth-child(4),
            table td:nth-child(4) {
                width: 59%;
                min-width: 59%;
            }
            
            /* 테이블 텍스트 크기 */
            table {
                font-size: 9px;
            }
            
            th, td {
                padding: 2px 3px;
                font-size: 9px;
                line-height: 1.2;
            }
            
            th {
                font-size: 8px;
                padding: 3px 2px;
            }
            
            /* 체크박스 크기 조정 */
            .rune-checkbox {
                width: 15px !important;
                height: 15px !important;
                margin: 0 !important;
            }
            
            /* 선택된 룬 카운트 */
            .selected-count {
                gap: 8px;
                padding: 6px;
            }
            
            .count-item {
                min-width: 60px;
                padding: 6px;
                max-width: 80px;
            }
            
            .count-label {
                font-size: 9px;
            }
            
            .count-value {
                font-size: 12px;
            }
            
            .count-value span {
                font-size: 12px;
            }
            
            /* 스테이터스 섹션 */
            .user-stats-section {
                padding: 10px;
            }
            
            .user-stats-section h2,
            .user-stats-section h3 {
                font-size: 13px;
                margin: 8px 0 6px 0;
            }
            
            .stats-container {
                gap: 5px;
                flex-direction: column;
            }
            
            .stats-column {
                gap: 4px;
                width: 100%;
            }
            
            .stat-row {
                gap: 3px;
            }
            
            .stat-row label {
                font-size: 9px;
                min-width: 50px;
                flex-shrink: 0;
            }
            
            .stat-row input {
                font-size: 10px;
                padding: 4px;
                min-width: 0;
                flex: 1;
            }
            
            .percent-symbol {
                font-size: 9px;
            }
            
            /* 강화류 토글 */
            .enhancement-toggles {
                gap: 5px;
                flex-wrap: wrap;
            }
            
            .toggle-item {
                padding: 4px 6px;
                font-size: 8px;
            }
            
            .toggle-item input[type="checkbox"] {
                width: 12px;
                height: 12px;
            }
            
            /* 대미지 배율 계산 */
            .damage-calculation {
                padding: 10px;
            }
            
            .damage-calculation h3 {
                font-size: 13px;
                margin-bottom: 8px;
            }
            
            .damage-calculation h4 {
                font-size: 11px;
                margin-bottom: 6px;
            }
            
            .damage-details {
                gap: 10px;
            }
            
            .damage-section {
                padding: 8px;
            }
            
            .damage-final {
                padding: 8px;
                min-width: 0;
            }
            
            .final-row {
                flex-wrap: wrap;
            }
            
            .final-row .final-label {
                flex: 1;
                min-width: 0;
            }
            
            .final-row .final-value {
                flex-shrink: 0;
            }
            
            .calc-row,
            .final-row {
                padding: 5px 0;
            }
            
            .calc-label,
            .final-label {
                font-size: 8px;
                line-height: 1.3;
            }
            
            .calc-value {
                font-size: 9px;
            }
            
            .final-value {
                font-size: 11px;
                font-weight: 600;
            }
            
            /* 세팅 섹션 */
            .settings-section {
                padding: 10px;
            }
            
            .settings-section h3 {
                font-size: 14px;
            }
            
            .settings-buttons {
                gap: 4px;
                flex-wrap: wrap;
                justify-content: space-between;
            }
            
            .settings-buttons button {
                padding: 6px 8px;
                font-size: 9px;
                flex: 0 1 auto;
                min-width: auto;
                white-space: nowrap;
                writing-mode: horizontal-tb;
                text-orientation: mixed;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            /* 모달 */
            .modal-content {
                width: 95%;
                padding: 12px;
                margin: 5% auto;
            }
            
            .modal-header {
                padding-bottom: 10px;
                margin-bottom: 15px;
            }
            
            .modal-header h3 {
                font-size: 15px;
            }
            
            .modal-body {
                max-height: 70vh;
            }
            
            .modal-body input {
                font-size: 12px;
                padding: 6px;
            }
            
            .save-item {
                padding: 10px;
                margin: 8px 0;
            }
            
            .save-item-name {
                font-size: 13px;
            }
            
            .save-item-date {
                font-size: 10px;
            }
            
            .modal-footer {
                padding-top: 10px;
                margin-top: 15px;
            }
            
            .modal-footer button {
                padding: 7px 12px;
                font-size: 12px;
            }
            
            /* 비교 결과 */
            .compare-item h4 {
                font-size: 13px;
            }
            
            .compare-stat {
                font-size: 9px;
                padding: 5px;
            }
            
            .compare-difference {
                font-size: 10px;
                padding: 10px;
            }
        }
        
        .description-column {
            display: none !important;
        }
        
        .description-column.force-show {
            display: table-cell !important;
        }
        
        .description-column.force-hide {
            display: none !important;
        }
        
        /* 자동완성 드롭다운 스타일 */
        .autocomplete-container {
            position: relative;
            display: inline-block;
        }
        .autocomplete-items {
            position: absolute;
            border: 1px solid #ddd;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            border-radius: 0 0 8px 8px;
            max-height: 150px;
            overflow-y: auto;
            background: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .autocomplete-items div {
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .autocomplete-items div:hover {
            background-color: #e3f2fd;
        }
        .autocomplete-active {
            background-color: #e3f2fd !important;
        }
        
        /* 룬 선택 관련 스타일 */
        .rune-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #4CAF50;
        }
        .rune-checkbox:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        .calculation-result {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .calculation-result h3 {
            margin-top: 0;
            color: #2c3e50;
            font-size: 18px;
        }
        
        /* 대미지 배율 계산 스타일 */
        .damage-calculation {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        .damage-calculation h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 20px;
            font-weight: 600;
            border-bottom: 3px solid #FF9800;
            padding-bottom: 10px;
        }
        
        .damage-calculation h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 16px;
            font-weight: 600;
        }
        
        .damage-details {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .damage-section {
            flex: 1;
            min-width: 300px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        
        .calc-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .calc-row:last-child {
            border-bottom: none;
        }
        
        .calc-label {
            font-size: 14px;
            color: #555;
            font-weight: 500;
        }
        
        .calc-value {
            font-size: 16px;
            font-weight: 600;
            color: #2196F3;
        }
        
        .damage-final {
            flex: 1;
            min-width: 300px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 8px;
            color: white;
        }
        
        .damage-final h4 {
            color: white;
            margin-bottom: 20px;
        }
        
        .final-row {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .final-row:last-child {
            margin-bottom: 0;
        }
        
        .final-row.direct {
            border-left: 4px solid #4CAF50;
        }
        
        .final-row.indirect {
            border-left: 4px solid #FF5722;
        }
        
        .final-label {
            display: block;
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.9;
        }
        
        .final-value {
            display: block;
            font-size: 28px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .effect-sum {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
            transition: all 0.2s;
        }
        .effect-sum:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .rune-list {
            color: #666;
            font-size: 0.9em;
            margin-top: 8px;
        }

        /* 검색 입력창 개선 */
        #name-search {
            width: 100%;
            max-width: 300px;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
            transition: all 0.2s;
            background: white;
        }
        #name-search:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76,175,80,0.1);
        }
        
        /* 세팅 섹션 스타일 */
        .settings-section {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        .settings-section h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 20px;
            font-weight: 600;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        
        .settings-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .settings-buttons button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            white-space: nowrap;
            writing-mode: horizontal-tb;
        }
        
        .settings-buttons button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .settings-buttons button:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .settings-buttons button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #ccc !important;
        }
        
        .btn-save {
            background: #4CAF50;
            color: white;
        }
        
        .btn-save:hover:not(:disabled) {
            background: #45a049;
        }
        
        .btn-load {
            background: #2196F3;
            color: white;
        }
        
        .btn-load:hover:not(:disabled) {
            background: #0b7dda;
        }
        
        .btn-update {
            background: #FF9800;
            color: white;
        }
        
        .btn-update:hover:not(:disabled) {
            background: #e68900;
        }
        
        .btn-delete {
            background: #f44336;
            color: white;
        }
        
        .btn-delete:hover:not(:disabled) {
            background: #da190b;
        }
        
        .btn-compare {
            background: #9C27B0;
            color: white;
        }
        
        .btn-compare:hover:not(:disabled) {
            background: #7b1fa2;
        }
        
        /* 모달 스타일 */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 22px;
        }
        
        .modal-body {
            margin: 20px 0;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        /* 스크롤바 스타일 */
        .modal-body::-webkit-scrollbar {
            width: 8px;
        }
        
        .modal-body::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .modal-body::-webkit-scrollbar-thumb {
            background: #4CAF50;
            border-radius: 4px;
        }
        
        .modal-body::-webkit-scrollbar-thumb:hover {
            background: #45a049;
        }
        
        .modal-body input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .modal-body input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .save-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }
        
        /* save-list 스크롤바 스타일 */
        .save-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .save-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .save-list::-webkit-scrollbar-thumb {
            background: #4CAF50;
            border-radius: 4px;
        }
        
        .save-list::-webkit-scrollbar-thumb:hover {
            background: #45a049;
        }
        
        .save-item {
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        
        .save-item:hover {
            border-color: #4CAF50;
            background: #e8f5e9;
            transform: translateX(5px);
        }
        
        .save-item.selected {
            border-color: #4CAF50;
            background: #c8e6c9;
        }
        
        .save-item-name {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .save-item-date {
            font-size: 14px;
            color: #666;
        }
        
        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #e0e0e0;
        }
        
        .modal-footer button {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-btn-confirm {
            background: #4CAF50;
            color: white;
        }
        
        .modal-btn-confirm:hover {
            background: #45a049;
        }
        
        .modal-btn-cancel {
            background: #9e9e9e;
            color: white;
        }
        
        .modal-btn-cancel:hover {
            background: #757575;
        }
        
        /* 비교 결과 스타일 */
        .compare-result {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .compare-item {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            background: white;
        }
        
        .compare-item h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .compare-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .compare-stat {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: #f0f0f0;
            border-radius: 4px;
        }
        
        .compare-difference {
            margin-top: 15px;
            padding: 15px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
        }
        
        .compare-difference.positive {
            background: #d4edda;
            border-left-color: #28a745;
        }
        
        .compare-difference.negative {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        
        /* 내보내기 버튼 */
        .btn-export {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }
        
        .btn-export:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-export:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        /* 드롭 영역 */
        .drop-zone {
            margin-top: 20px;
            padding: 30px;
            border: 2px dashed #cbd5e0;
            border-radius: 12px;
            background: #f7fafc;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .drop-zone:hover {
            border-color: #667eea;
            background: #edf2f7;
        }
        
        .drop-zone.drag-over {
            border-color: #667eea;
            background: #e6f0ff;
            border-style: solid;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        
        .drop-zone-content {
            pointer-events: none;
        }
        
        .drop-icon {
            color: #a0aec0;
            margin-bottom: 10px;
        }
        
        .drop-zone:hover .drop-icon {
            color: #667eea;
        }
        
        .drop-text {
            margin: 10px 0 5px 0;
            color: #2d3748;
            font-size: 16px;
            font-weight: 600;
        }
        
        .drop-subtext {
            margin: 0;
            color: #718096;
            font-size: 14px;
        }
        
        /* 모바일 대응 */
        @media (max-width: 768px) {
            .drop-zone {
                padding: 20px;
            }
            
            .drop-icon {
                width: 36px;
                height: 36px;
            }
            
            .drop-text {
                font-size: 14px;
            }
            
            .drop-subtext {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- 네비게이션 바 -->
    <nav class="main-nav">
        <div class="nav-container">
            <a href="#top" class="nav-item">검색</a>
            <a href="#rune-table" class="nav-item">룬 테이블</a>
            <a href="#stats-section" class="nav-item">스테이터스</a>
            <a href="#skill-section" class="nav-item">스킬</a>
            <a href="#damage-section" class="nav-item">대미지 계산</a>
            <a href="#settings-section" class="nav-item">세팅</a>
        </div>
    </nav>
    
    <div id="top" class="container">
        <h1>룬 정보 데이터 <small>(Var.0.2.1)</small></h1>
        <div class="controls">
            <div class="filter-section">
                <strong>종류 :</strong>
                <div id="type-filters" class="filter-group"></div>
            </div>
            <div class="filter-section">
                <strong>등급 :</strong>
                <div id="grade-filters" class="filter-group"></div>
            </div>
            <div class="filter-section">
                <strong>검색 키워드 :</strong>
                <div id="keyword-filters" class="filter-group"></div>
            </div>
            <div class="filter-section">
                <strong>검색 특징 :</strong>
                <div id="feature-filters" class="filter-group"></div>
            </div>
            <div class="filter-section">
                <strong>이름 검색 :</strong>
                <input type="text" id="name-search" placeholder="룬 이름을 입력하세요" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd; width: 200px;">
            </div>
            <div class="control-buttons">
                <button id="clearFilterBtn" type="button" onclick="clearAllFilters(event)">필터 초기화</button>
            </div>
        </div>
        
        <!-- 선택된 룬 수 표시 -->
        <div id="rune-table" class="selected-count">
            <div class="count-item">
                <div class="count-label">무기</div>
                <div class="count-value">
                    <span id="weapon-count">0</span>/1
                </div>
            </div>
            <div class="count-item">
                <div class="count-label">방어구</div>
                <div class="count-value">
                    <span id="armor-count">0</span>/5
                </div>
            </div>
            <div class="count-item">
                <div class="count-label">앰블럼</div>
                <div class="count-value">
                    <span id="emblem-count">0</span>/1
                </div>
            </div>
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>선택</th>
                    <th onclick="sortTable(1, 'str')">이름 <span class="sort-indicator"></span></th>
                    <th onclick="sortTable(2, 'str')">특징 <span class="sort-indicator"></span></th>
                    <th onclick="sortTable(3, 'str')">설명 <span class="sort-indicator"></span></th>
                </tr>
            </thead>
            <tbody>
                <!-- 데이터는 스크립트에서 동적으로 생성됩니다 -->
            </tbody>
        </table>
        
        <!-- 유저 스테이터스 입력 섹션 -->
        <div id="stats-section" class="user-stats-section">
            <h2>스테이터스</h2>
            <div class="stats-container">
                <div class="stats-column">
                    <div class="stat-row">
                        <label>강타 강화</label>
                        <input type="number" id="stat-강타강화" placeholder="0" min="0">
                    </div>
                    <div class="stat-row">
                        <label>연타 강화</label>
                        <input type="number" id="stat-연타강화" placeholder="0" min="0">
                    </div>
                    <div class="stat-row">
                        <label>콤보 강화</label>
                        <input type="number" id="stat-콤보강화" placeholder="0" min="0">
                    </div>
                    <div class="stat-row">
                        <label>광역 강화</label>
                        <input type="number" id="stat-광역강화" placeholder="0" min="0">
                    </div>
                </div>
                <div class="stats-column">
                    <div class="stat-row">
                        <label>스킬 위력</label>
                        <input type="number" id="stat-스킬위력" placeholder="0" min="0">
                    </div>
                    <div class="stat-row">
                        <label>치명타</label>
                        <input type="number" id="stat-치명타" placeholder="0" min="0">
                    </div>
                    <div class="stat-row">
                        <label>추가타</label>
                        <input type="number" id="stat-추가타" placeholder="0" min="0">
                    </div>
                </div>
            </div>
            
            <!-- 캐릭터 스킬 관련 대미지율 -->
            <h3 id="skill-section">캐릭터 스킬 관련</h3>
            <div class="stats-container">
                <div class="stats-column">
                    <div class="stat-row">
                        <label>공격력</label>
                        <input type="number" id="skill-공격력" placeholder="0.0" min="0" step="0.1">
                        <span class="percent-symbol">%</span>
                    </div>
                    <div class="stat-row">
                        <label>연타 피해</label>
                        <input type="number" id="skill-연타피해" placeholder="0.0" min="0" step="0.1">
                        <span class="percent-symbol">%</span>
                    </div>
                    <div class="stat-row">
                        <label>강타 피해</label>
                        <input type="number" id="skill-강타피해" placeholder="0.0" min="0" step="0.1">
                        <span class="percent-symbol">%</span>
                    </div>
                    <div class="stat-row">
                        <label>광역 피해</label>
                        <input type="number" id="skill-광역피해" placeholder="0.0" min="0" step="0.1">
                        <span class="percent-symbol">%</span>
                    </div>
                    <div class="stat-row">
                        <label>콤보 피해</label>
                        <input type="number" id="skill-콤보피해" placeholder="0.0" min="0" step="0.1">
                        <span class="percent-symbol">%</span>
                    </div>
                </div>
                <div class="stats-column">
                    <div class="stat-row">
                        <label>추가 피해</label>
                        <input type="number" id="skill-추가피해" placeholder="0.0" min="0" step="0.1">
                        <span class="percent-symbol">%</span>
                    </div>
                    <div class="stat-row">
                        <label>치명타 피해</label>
                        <input type="number" id="skill-치명타피해" placeholder="0.0" min="0" step="0.1">
                        <span class="percent-symbol">%</span>
                    </div>
                    <div class="stat-row">
                        <label>치명타 확률</label>
                        <input type="number" id="skill-치명타확률" placeholder="0.0" min="0" step="0.1" max="100">
                        <span class="percent-symbol">%</span>
                    </div>
                    <div class="stat-row">
                        <label>추가타 확률</label>
                        <input type="number" id="skill-추가타확률" placeholder="0.0" min="0" step="0.1" max="100">
                        <span class="percent-symbol">%</span>
                    </div>
                </div>
            </div>
            
            <!-- 강화류 사용 유무 -->
            <h3 id="enhancement-section">강화류 사용 유무</h3>
            <div class="enhancement-toggles">
                <label class="toggle-item">
                    <input type="checkbox" id="use-강타" checked>
                    <span>강타</span>
                </label>
                <label class="toggle-item">
                    <input type="checkbox" id="use-연타" checked>
                    <span>연타</span>
                </label>
                <label class="toggle-item">
                    <input type="checkbox" id="use-광역" checked>
                    <span>광역</span>
                </label>
                <label class="toggle-item">
                    <input type="checkbox" id="use-콤보" checked>
                    <span>콤보</span>
                </label>
            </div>
            
            <!-- 시너지 대미지 -->
            <h3 id="synergy-section">시너지 대미지</h3>
            <div class="stats-container">
                <div class="stats-column">
                    <div class="stat-row">
                        <label>주는 피해 증가</label>
                        <input type="number" id="synergy-주는피해" placeholder="0.0" min="0" step="0.1">
                        <span class="percent-symbol">%</span>
                    </div>
                </div>
                <div class="stats-column">
                    <div class="stat-row">
                        <label>받는 피해 증가</label>
                        <input type="number" id="synergy-받는피해" placeholder="0.0" min="0" step="0.1">
                        <span class="percent-symbol">%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 계산 결과 표시 영역 -->
        <div id="calculation-result" class="calculation-result" style="display: none;">
            <h3>선택된 룬 효과 계산 결과</h3>
            <div id="effect-sums">
                <!-- 계산 결과는 스크립트에서 동적으로 생성됩니다 -->
            </div>
        </div>
        
        <!-- 대미지 배율 계산 결과 -->
        <div id="damage-section" class="damage-calculation">
            <h3>대미지 배율 계산</h3>
            <div class="damage-details">
                <div class="damage-section">
                    <h4>세부 계산</h4>
                    <div class="calc-row">
                        <span class="calc-label">1. 공격력</span>
                        <span class="calc-value" id="calc-attack">1.00</span>
                    </div>
                    <div class="calc-row">
                        <span class="calc-label">2. 강화류 (강타/연타/광역/콤보)</span>
                        <span class="calc-value" id="calc-enhancement">1.00</span>
                    </div>
                    <div class="calc-row">
                        <span class="calc-label">3. 피해증가 (주는 피해 × 받는 피해)</span>
                        <span class="calc-value" id="calc-damage-increase">1.00</span>
                    </div>
                    <div class="calc-row">
                        <span class="calc-label">4. 치명타</span>
                        <span class="calc-value" id="calc-critical">1.00</span>
                    </div>
                    <div class="calc-row">
                        <span class="calc-label">5. 추가타</span>
                        <span class="calc-value" id="calc-additional">1.00</span>
                    </div>
                    <div class="calc-row">
                        <span class="calc-label">6-1. 룬 피해 계수</span>
                        <span class="calc-value" id="calc-rune-damage">1.00</span>
                    </div>
                    <div class="calc-row">
                        <span class="calc-label">6-2. 룬 지속 피해 계수</span>
                        <span class="calc-value" id="calc-rune-dot">1.00</span>
                    </div>
                </div>
                <div class="damage-final">
                    <h4>최종 대미지 배율</h4>
                    <div class="final-row direct">
                        <span class="final-label">직접 피해</span>
                        <span class="final-value" id="final-direct">1.00배</span>
                    </div>
                    <div class="final-row indirect">
                        <span class="final-label">간접 피해 (지속 피해)</span>
                        <span class="final-value" id="final-indirect">1.00배</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 세팅 섹션 -->
        <div id="settings-section" class="settings-section">
            <h3>세팅</h3>
            <div class="settings-buttons">
                <button id="btn-save" class="btn-save">저장</button>
                <button id="btn-load" class="btn-load">불러오기</button>
                <button id="btn-update" class="btn-update">변경</button>
                <button id="btn-delete" class="btn-delete">삭제</button>
                <button id="btn-compare" class="btn-compare">비교</button>
                <button id="btn-export" class="btn-export">내보내기</button>
            </div>
            
            <!-- 드롭 영역 추가 -->
            <div id="drop-zone" class="drop-zone">
                <div class="drop-zone-content">
                    <svg class="drop-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    <p class="drop-text">JSON 파일을 여기에 드래그하여 세팅 가져오기</p>
                    <p class="drop-subtext">또는 클릭하여 파일 선택</p>
                </div>
                <input type="file" id="file-input" accept=".json" style="display: none;">
            </div>
        </div>
    </div>

    <!-- 저장 모달 -->
    <div id="saveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>세팅 저장</h3>
            </div>
            <div class="modal-body">
                <input type="text" id="saveNameInput" placeholder="세팅 이름을 입력하세요">
            </div>
            <div class="modal-footer">
                <button id="saveModalConfirm" class="modal-btn-confirm">저장</button>
                <button id="saveModalCancel" class="modal-btn-cancel">취소</button>
            </div>
        </div>
    </div>

    <!-- 불러오기 모달 -->
    <div id="loadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>세팅 불러오기</h3>
            </div>
            <div class="modal-body">
                <div id="loadList" class="save-list"></div>
            </div>
            <div class="modal-footer">
                <button id="loadModalConfirm" class="modal-btn-confirm">불러오기</button>
                <button id="loadModalCancel" class="modal-btn-cancel">취소</button>
            </div>
        </div>
    </div>

    <!-- 변경 모달 -->
    <div id="updateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>세팅 변경</h3>
            </div>
            <div class="modal-body">
                <div id="updateList" class="save-list"></div>
            </div>
            <div class="modal-footer">
                <button id="updateModalConfirm" class="modal-btn-confirm">변경</button>
                <button id="updateModalCancel" class="modal-btn-cancel">취소</button>
            </div>
        </div>
    </div>

    <!-- 삭제 모달 -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>세팅 삭제</h3>
            </div>
            <div class="modal-body">
                <div id="deleteList" class="save-list"></div>
            </div>
            <div class="modal-footer">
                <button id="deleteModalConfirm" class="modal-btn-confirm">삭제</button>
                <button id="deleteModalCancel" class="modal-btn-cancel">취소</button>
            </div>
        </div>
    </div>

    <!-- 비교 모달 -->
    <div id="compareModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>세팅 비교</h3>
            </div>
            <div class="modal-body">
                <h4 style="margin-bottom: 10px;">첫 번째 세팅 선택</h4>
                <div id="compareList1" class="save-list"></div>
                <h4 style="margin: 20px 0 10px 0;">두 번째 세팅 선택</h4>
                <div id="compareList2" class="save-list"></div>
                <div id="compareResult"></div>
            </div>
            <div class="modal-footer">
                <button id="compareModalConfirm" class="modal-btn-confirm">비교</button>
                <button id="compareModalCancel" class="modal-btn-cancel">닫기</button>
            </div>
        </div>
    </div>

    <!-- 내보내기 모달 -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>세팅 내보내기</h3>
            </div>
            <div class="modal-body">
                <div id="exportList" class="save-list"></div>
            </div>
            <div class="modal-footer">
                <button id="exportModalConfirm" class="modal-btn-confirm">내보내기</button>
                <button id="exportModalCancel" class="modal-btn-cancel">취소</button>
            </div>
        </div>
    </div>

    <script>
        const runeData = [
            // 무기 전설
            { type: '무기', grade: '전설', name: '불길', keyword: '', effects: [{ effect: '치명타 확률 증가', value: '18%' }, { effect: '지속피해', value: '공격력×n%', condition: '화상 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '결정', keyword: '', effects: [{ effect: '추가타 확률 증가', value: '18%' }, { effect: '지속피해', value: '공격력×n%', condition: '빙결 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '뇌명', keyword: '', effects: [{ effect: '강타 피해 증가', value: '20%' }, { effect: '지속피해', value: '공격력×n%', condition: '감전 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '독사+', keyword: '', effects: [{ effect: '연타 피해 증가', value: '20%' }, { effect: '지속피해', value: '공격력×n%', condition: '중독 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '공포', keyword: '', effects: [{ effect: '치명타 피해 증가', value: '18%' }, { effect: '지속피해', value: '공격력×n%', condition: '암흑 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '집행자', keyword: '', effects: [{ effect: '적에게 주는 피해 증가', value: '10%' }, { effect: '치유량 증가', value: '20%' }, { effect: '지속피해', value: '공격력×n%', condition: '신성 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '야수+', keyword: '', effects: [{ effect: '적에게 주는 피해 증가', value: '20%' }, { effect: '지속피해', value: '공격력×n%', condition: '출혈 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '밤+', keyword: '', effects: [{ effect: '공격력 증가', value: '20%' }, { effect: '지속피해', value: '공격력×n%', condition: '정신 (쿨타임: 10초)' }] },
            { type: '무기', grade: '전설', name: '투사+', keyword: '결함', effects: [{ effect: '적에게 주는 피해 증가', value: '33%' }, { effect: '멀티히트 피해 감소', value: '-10%' }] },
            { type: '무기', grade: '전설', name: '은둔자+', keyword: '결함', effects: [{ effect: '공격력 증가', value: '33%' }, { effect: '재사용 대기 시간 회복 속도 감소', value: '-9%' }] },
            { type: '무기', grade: '전설', name: '망각+', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '19%' }, { effect: '모든 스킬의 재사용 대기 시간 감소', value: '9%', condition: '기본 공격 적중 시' }] },
            { type: '무기', grade: '전설', name: '서리바람+', keyword: '', effects: [{ effect: '공격력 증가', value: '20%' }, { effect: '캐스팅 및 차지 속도 증가', value: '25%' }] },
            { type: '무기', grade: '전설', name: '옛 마법사', keyword: '결함', effects: [{ effect: '재사용 대기 시간 회복 속도 증가', value: '29%' }, { effect: '적에게 주는 피해 감소', value: '-10%' }] },
            { type: '무기', grade: '전설', name: '물결치는 날', keyword: '조건부', effects: [{ effect: '다음 기본 공격 추가 피해', value: '공격력×n%' }, { effect: '다음 1회 기본 공격 속도 증가', value: '10%' }], condition: '스킬 사용 시' },
            { type: '무기', grade: '전설', name: '파괴자+', keyword: '', effects: [{ effect: '공격력 증가', value: '18%' }, { effect: '무방비 피해 증가', value: '48%' }] },
            { type: '무기', grade: '전설', name: '검무+', keyword: '누적', effects: [{ effect: '공격력 증가', value: '2% (최대 20%)' }, { effect: '치명타 확률 증가', value: '1% (최대 10%)' }], condition: '공격 적중 시 (지속: 10초 / 최대 10회)' },
            { type: '무기', grade: '전설', name: '무수한 궤적', keyword: '', effects: [{ effect: '공격력 증가', value: '10%' }, { effect: '기본 공격 속도 증가', value: '30%' }, { effect: '기본 공격 추가타 확률 증가', value: '30%' }] },
            { type: '무기', grade: '전설', name: '마지막 자비', keyword: '', effects: [{ effect: '공격력 증가', value: '20%' }, { effect: '공격력 추가 증가', value: '20%' }], condition: '남은 체력 50% 이하 적 공격 시 (지속: 10초)' },
            { type: '무기', grade: '전설', name: '끝없는 순환', keyword: '축적', effects: [{ effect: '[공격] 마법진 암흑 피해', value: '공격력×n%' }, { effect: '[회복] 마법진 회복', value: '공격력×n%' }], condition: '공격/회복 20회 축적' },
            { type: '무기', grade: '전설', name: '종언+', keyword: '누적', effects: [{ effect: '공격력 증가', value: '2% (최대 20%)' }, { effect: '공격력 증가 (기본)', value: '24%' }], condition: '자신과 전투 중인 적 처치 시 (지속: 20초 / 최대 10회)' },
            { type: '무기', grade: '전설', name: '영웅', keyword: '', effects: [{ effect: '공격력, 연타, 강타, 콤보, 스킬, 치명타, 멀티 히트 피해 증가', value: '각 4.3%' }] },
            
            // 방어구 전설
            { type: '방어구', grade: '전설', name: '여명+', keyword: '누적', effects: [{ effect: '공격력 증가', value: '3.5% (최대 21%)' }], condition: '스킬 사용 시 (지속: 10초 / 최대 6회)' },
            { type: '방어구', grade: '전설', name: '황혼', keyword: '누적', effects: [{ effect: '적에게 주는 피해 증가', value: '1.4% (최대 22.4%)' }], condition: '공격 적중 시 (지속: 8초 / 최대 16회)' },
            { type: '방어구', grade: '전설', name: '바위 감시자', keyword: '축적', effects: [{ effect: '공격력 증가', value: '22%' }], condition: '강타 7회 적중 시 (지속: 6초)' },
            { type: '방어구', grade: '전설', name: '쇄도+', keyword: '조건부', effects: [{ effect: '캐스팅 및 차지 속도 증가', value: '20%' }, { effect: '스킬 사용 속도 증가', value: '20%' }], condition: '스킬 사용 시 25% 확률 (지속: 5초)' },
            { type: '방어구', grade: '전설', name: '무도가+', keyword: '', effects: [{ effect: '공격력 증가', value: '12%' }, { effect: '궁극기 게이지 획득량 증가', value: '20%' }] },
            { type: '방어구', grade: '전설', name: '해결사+', keyword: '', effects: [{ effect: '공격 속도 증가', value: '30%' }, { effect: '기본 공격 추가타 확률 증가', value: '30%' }] },
            { type: '방어구', grade: '전설', name: '들불', keyword: '조건부', effects: [{ effect: '치명타 확률 증가', value: '14%' }], condition: '화상 보유 적 공격 시 (지속: 5초 / 쿨타임: 3초)' },
            { type: '방어구', grade: '전설', name: '설산', keyword: '조건부', effects: [{ effect: '추가타 확률 증가', value: '16%' }], condition: '빙결 보유 적 공격 시 (지속: 5초 / 쿨타임: 3초)' },
            { type: '방어구', grade: '전설', name: '절개+', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '20%' }], condition: '출혈 보유 적 공격 시 (지속: 5초 / 쿨타임: 3초)' },
            { type: '방어구', grade: '전설', name: '환영+', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '18%' }, { effect: '방어구 파괴 부여', value: '받는 피해 10% 증가', condition: '정신 보유 적 공격 시 (지속: 10초 / 쿨타임: 3초)' }] },
            { type: '방어구', grade: '전설', name: '황금 들판', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '20%' }], condition: '체력 75% 이상일 경우' },
            { type: '방어구', grade: '전설', name: '모래 폭풍', keyword: '조건부', effects: [{ effect: '스킬 사용 속도 및 공격 속도 증가', value: '10%' }, { effect: '스킬 사용 속도 및 공격 속도 추가 증가', value: '24%', condition: '무방비 공격 적중 시 (지속: 10초)' }] },
            { type: '방어구', grade: '전설', name: '황폐+', keyword: '조건부', effects: [{ effect: '적에게 주는 피해 증가', value: '12%' }, { effect: '추가타 확률 증가', value: '7%' }], condition: '자원 50% 미만일 경우' },
            { type: '방어구', grade: '전설', name: '신성한 칙령', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '15%' }, { effect: '회복량 증가', value: '9%' }], condition: '아군 회복 시 (지속: 5초)' },
            { type: '방어구', grade: '전설', name: '준비된 자', keyword: '조건부', effects: [{ effect: '적에게 주는 피해 증가', value: '20%', condition: '퀵슬롯 아이템 사용 시 (지속: 15초)' }, { effect: '포션 개수 증가', value: '+2' }, { effect: '붕대 개수 증가', value: '+2' }] },
            { type: '방어구', grade: '전설', name: '저무는 달', keyword: '누적', effects: [{ effect: '공격력과 방어력 증가', value: '6%' }, { effect: '공격력과 방어력 추가 증가', value: '2% (최대 20%)' }], condition: '전투 시작 후 30초마다 (최대 10회)' },
            { type: '방어구', grade: '전설', name: '땅울림', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '8%' }, { effect: '공격력 증가', value: '30%', condition: '전투 시작 시, 3초마다 2%씩 감소' }] },
            { type: '방어구', grade: '전설', name: '신전 기사', keyword: '결함', effects: [{ effect: '공격력 증가', value: '23%' }, { effect: '치명타 확률 감소', value: '-8%' }] },
            { type: '방어구', grade: '전설', name: '근위병+', keyword: '결함', effects: [{ effect: '공격력 증가', value: '23%' }, { effect: '재사용 대기 시간 회복 속도 감소', value: '-7%' }] },
            { type: '방어구', grade: '전설', name: '침묵하는 산', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '22%' }], condition: '5초 동안 이동하지 않을 경우' },
            { type: '방어구', grade: '전설', name: '필사+', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '10%' }, { effect: '공격력 추가 증가', value: '20%', condition: '체력 50% 이하로 감소 시 (지속: 20초 / 쿨타임: 15초)' }] },
            { type: '방어구', grade: '전설', name: '파멸+', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '25%' }], condition: '궁극기 사용 시 (지속: 20초)' },
            { type: '방어구', grade: '전설', name: '집정관', keyword: '결함', effects: [{ effect: '공격력 증가', value: '23%' }, { effect: '스킬 사용 속도와 캐스팅 및 차지 속도 감소', value: '-8%' }] },
            { type: '방어구', grade: '전설', name: '새벽별', keyword: '누적', effects: [{ effect: '스킬 재사용 대기 시간 회복 속도 증가', value: '3% (최대 18%)' }], condition: '스킬 사용 시 (지속: 8초 / 최대 6회)' },
            { type: '방어구', grade: '전설', name: '눈 먼 예언자', keyword: '각성+', effects: [{ effect: '각성의 재사용 대기 시간 감소', value: '38초' }] },
            { type: '방어구', grade: '전설', name: '압도적인 힘', keyword: '각성', effects: [{ effect: '강타 피해 증가', value: '6%' }, { effect: '공격력 증가', value: '6%' }, { effect: '치명타 확률 증가', value: '4%' }], condition: '엠블럼 각성 시 20초간 능력치 2배' },
            { type: '방어구', grade: '전설', name: '섬세한 손놀림', keyword: '각성', effects: [{ effect: '연타 피해 증가', value: '6%' }, { effect: '공격력 증가', value: '6%' }, { effect: '추가타 확률 증가', value: '4%' }], condition: '엠블럼 각성 시 20초간 능력치 2배' },
            { type: '방어구', grade: '전설', name: '성역+', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '17%', condition: '보호막 유지 시' }, { effect: '보호막 생성', value: '(공격력×n%)', condition: '포션 사용 또는 30초마다' }] },
            { type: '방어구', grade: '전설', name: '불안정한 힘', keyword: '조건부', effects: [{ effect: '적에게 주는 피해 증가', value: '22%' }], condition: '전투 시작 시 (브레이크 시 효과 사라짐, 30초 후 재활성화)' },
            { type: '방어구', grade: '전설', name: '고대 수호자', keyword: '결함', effects: [{ effect: '공격력 증가', value: '23%' }, { effect: '이동 속도 감소', value: '-8%' }] },
            { type: '방어구', grade: '전설', name: '갈퀴발톱+', keyword: '', effects: [{ effect: '브레이크 스킬로 주는 피해 증가', value: '24%' }, { effect: '브레이크 피해 증가', value: '24%' }, { effect: '무방비 피해 증가', value: '24%' }] },
            { type: '방어구', grade: '전설', name: '태양', keyword: '', effects: [{ effect: '주기적인 광역 피해', value: '(공격력×n%)' }], condition: '3.5초마다 3m 범위 내' },
            { type: '방어구', grade: '전설', name: '싹쓸바람', keyword: '', effects: [{ effect: '광역 피해 및 끌어당김', value: '(공격력×n%)' }], condition: '공격 적중 시 (쿨타임: 10초)' },
            { type: '방어구', grade: '전설', name: '혼돈', keyword: '중첩', effects: [{ effect: '추가 피해', value: '(공격력×n%)' }], condition: '지속 피해 3회 중첩 시 (대상마다 4초에 한 번)' },
            { type: '방어구', grade: '전설', name: '붕괴하는 별', keyword: '중첩', effects: [{ effect: '추가 피해', value: '(공격력×n%)', condition: '공격 3회 중첩 시 (대상마다 3초에 한 번)' }, { effect: '공격력 증가', value: '10%', condition: '공격 3회 중첩 시 (지속 10초)' }] },
            { type: '방어구', grade: '전설', name: '돌격대장+', keyword: '조건부', effects: [{ effect: '방어구 파괴 부여', value: '받는 피해 10% 증가' }, { effect: '공격력 증가', value: '20%' }], condition: '도발 시' },
            { type: '방어구', grade: '전설', name: '지휘관', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '4.5% (최대 22.5%)' }], condition: '특정 공격 시 (지속: 8초 / 최대 5회)' },
            { type: '방어구', grade: '전설', name: '응징+', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '12%' }, { effect: '체력 회복', value: '(공격력×n%)', condition: '적 처치 시' }] },
            { type: '방어구', grade: '전설', name: '집념+', keyword: '', effects: [{ effect: '캐스팅 및 차지 속도 증가', value: '25%' }, { effect: '적에게 주는 피해 증가', value: '10%' }] },
            { type: '방어구', grade: '전설', name: '분쇄+', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '6%' }, { effect: '적에게 주는 피해 증가', value: '28%', condition: '무방비 공격 적중 시 (지속: 10초)' }] },
            { type: '방어구', grade: '전설', name: '쌍둥이 별', keyword: '누적+', effects: [{ effect: '누적 효과 추가 발생', value: '+1회' }, { effect: '캐스팅 및 차지 속도, 스킬 사용 속도 증가', value: '7%' }] },
            { type: '방어구', grade: '전설', name: '푸른 거목', keyword: '축적', effects: [{ effect: '스킬 피해량 증가', value: '2.2% (최대 22%)' }], condition: '스킬 5회 사용 시마다 (최대 10회)' },
            { type: '방어구', grade: '전설', name: '어두운 징조', keyword: '누적', effects: [{ effect: '공격력 증가', value: '0.6% (최대 18%)' }, { effect: '치명타 확률 증가', value: '0.6% (최대 18%)' }, { effect: '적에게 주는 피해 증가', value: '0.6% (최대 18%)' }], condition: '궁극기 사용 시 (최대 30회)' },
            { type: '방어구', grade: '전설', name: '요정 무리', keyword: '축적', effects: [{ effect: '모든 스킬 재사용 대기 시간 감소', value: '2.1초' }], condition: '스킬 7회 사용 시 (쿨타임: 3초)' },
            { type: '방어구', grade: '전설', name: '수정 꽃잎', keyword: '축적', effects: [{ effect: '추가 피해', value: '(공격력×n%)' }, { effect: '공격력 증가', value: '12%' }], condition: '치명타 6회 적중 시 (공증 10초 지속 / 쿨타임: 3초)' },
            { type: '방어구', grade: '전설', name: '나무 사슴', keyword: '축적', effects: [{ effect: '추가 피해', value: '(공격력×n%)' }, { effect: '공격력 증가', value: '12%' }], condition: '추가타 6회 적중 시 (공증 10초 지속 / 쿨타임: 4초)' },
            { type: '방어구', grade: '전설', name: '에메랄드 숲', keyword: '축적+', effects: [{ effect: '축적 횟수 추가', value: '+1회' }, { effect: '적에게 주는 피해 증가', value: '10%' }] },
            { type: '방어구', grade: '전설', name: '불사', keyword: '조건부', effects: [{ effect: '적에게 주는 피해 증가', value: '18%' }, { effect: '죽음 방지 및 회복', value: '1회' }, { effect: '받는 피해 감소', value: '80%' }], condition: '행동 불능 시 (지속: 3초 / 쿨타임: 180초)' },
            { type: '방어구', grade: '전설', name: '싸움꾼', keyword: '조건부', effects: [{ effect: '적에게 주는 피해 증가', value: '12% ~ 16%' }, { effect: '받는 피해 감소', value: '8% ~ 12%' }], condition: '주변 적 수에 따라 (최대 3명)' },
            { type: '방어구', grade: '전설', name: '약탈자', keyword: '조건부', effects: [{ effect: '체력 회복', value: '(공격력×n%)', condition: '추가타 적중 시 (쿨타임: 1초)' }, { effect: '추가타 확률 증가', value: '10%' }] },
            { type: '방어구', grade: '전설', name: '원소 조화', keyword: '', effects: [{ effect: '추가 피해', value: '3가지 속성 (공격력×n%)' }], condition: '공격 적중 시 (쿨타임: 5초)' },
            { type: '방어구', grade: '전설', name: '다가오는 죽음', keyword: '', effects: [{ effect: '추가 피해', value: '(공격력×n%) ~ (공격력×n%)' }], condition: '거리에 비례 (쿨타임: 10초)' },
            { type: '방어구', grade: '전설', name: '잊힌 성소', keyword: '축적', effects: [{ effect: '원소 화살 난사', value: '(공격력×n%)' }], condition: '스킬/기본 공격 60회 사용 시' },
            
            // 무기 신화
            { type: '무기', grade: '신화', name: '만 갈래 물길', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '15%' }, { effect: '공격력 추가 증가', value: '1% (최대 20%)', condition: '클래스 레벨 50 달성마다' }] },
            { type: '무기', grade: '신화', name: '흰 까마귀', keyword: '조건부', effects: [{ effect: '공격 속도 증가', value: '10%' }, { effect: '이동 속도 증가', value: '10%' },{ effect: '스킬 사용 속도 증가', value: '10%' }, { effect: '캐스팅 및 차지 속도 증가', value: '10%' }, { effect: '재사용 대기 시간 회복 속도 증가', value: '10%' }, { effect: '적에게 주는 피해 증가', value: '7%', condition: '+10 강화 시' }, { effect: '공격력 증가', value: '7%', condition: '+15 강화 시' }] },
            { type: '무기', grade: '신화', name: '메아리치는 진노', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '5%' }, { effect: '공격력 추가 증가', value: '3%', condition: '+10 강화 시' }, { effect: '공격력 추가 증가', value: '3%', condition: '+15 강화 시' }, { effect: '추가 피해', value: '(공격력×n%)', condition: '연타 적중 시 (쿨타임: 8초)' }, { effect: '지속피해', value: '(공격력×n%)', condition: '빙결, 연타 적중 시 (쿨타임: 8초)' }, { effect: '추가 피해', value: '(공격력×n%)', condition: '강타 적중 시 (쿨타임: 8초)' }, { effect: '지속피해', value: '(공격력×n%)', condition: '화상, 강타 적중 시 (쿨타임: 8초)' }] },
            { type: '무기', grade: '신화', name: '무한', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '20%' }, { effect: '모든 스킬의 재사용 대기 시간 감소', value: '9%', condition: '기본 공격 사용 시' }, { effect: '공격 속도 증가', value: '12%', condition: '스킬 사용 시 (지속: 5초)' }] },
            
             // 방어구 신화
            { type: '방어구', grade: '신화', name: '닫힌 운명', keyword: '조건부', effects: [{ effect: '추가 피해', value: '(공격력×n%)' }, { effect: '방어구 파괴 부여', value: '받는 피해 10% 증가' }], condition: '공격 적중 시 (재사용 대기 시간: 5초)' },
            { type: '방어구', grade: '신화', name: '검게 물든 후광', keyword: '조건부', effects: [{ effect: '받는 피해 증가', value: '15%' }, { effect: '적에게 주는 피해 증가', value: '15%' }, { effect: '적에게 주는 피해 증가', value: '6%', condition: '+10 강화 시' }, { effect: '적에게 주는 피해 증가', value: '6%', condition: '+15 강화 시' }], condition: '아군 회복/물약 사용 시 15초간 받는 피해 증가 무효화' },
            { type: '방어구', grade: '신화', name: '그림자로 엮은 회랑', keyword: '조건부', effects: [{ effect: '주기적인 광역 피해', value: '(공격력×n%)' }], condition: '2, 3, 4초마다 발사 (+15 강화 시 5초마다 추가)' },
            { type: '방어구', grade: '신화', name: '바스러지는 빛', keyword: '중첩', effects: [{ effect: '공격력 증가', value: '5.5% (최대 27.5%)' }], condition: '스킬 사용 시 (지속: 8초 / 최대 5회, +15 강화 시 50% 확률로 추가 중첩)' },
            { type: '방어구', grade: '신화', name: '세상을 삼키는 악의', keyword: '조건부', effects: [{ effect: '원소 지속 피해를 보유한 적에게 주는 피해 증가', value: '16%' }, { effect: '적에게 주는 무방비 피해 증가', value: '16%' }, { effect: '적에게 주는 피해 추가 증가', value: '3%', condition: '+10 강화 시' }, { effect: '적에게 주는 피해 추가 증가', value: '3%', condition: '+15 강화 시' }] },
            { type: '방어구', grade: '신화', name: '이름 없는 혼돈', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '10%~30% (+15 강화 시 최대 40%)' }], condition: '전투 중 5초마다 5초 동안' },
            { type: '방어구', grade: '신화', name: '영원', keyword: '결함+', effects: [{ effect: '모든 결함 효과 제거', value: '-' }, { effect: '공격력 증가', value: '10%' }] },
            { type: '방어구', grade: '신화', name: '쏟아지는 별', keyword: '조건부', effects: [{ effect: '주기적인 광역 피해', value: '(공격력×n%)' }], condition: '전투 중 15초마다 (궁극기 사용 시 모든 적 타격)' },
            
            // 앰블럼 전설
            { type: '앰블럼', grade: '전설', name: '무자비한 포식자', keyword: '각성', effects: [ { effect: '적에게 주는 스킬 피해 증가', value: '55%', condition: '무방비 공격 시 각성 (20초 지속)' }, { effect: '모든 스킬 재사용 대기 시간 초기화', value: '-', condition: '무방비 공격 시 각성' }, { effect: '적에게 주는 피해 증가', value: '21%' } ], condition: '(재사용 대기 시간: 90초)'},
            { type: '앰블럼', grade: '전설', name: '순수한 힘', keyword: '조건부', effects: [ { effect: '적에게 주는 피해 증가', value: '27%', condition: '궁극기 사용 시 (30초 지속)' }, { effect: '궁극기 게이지 획득량 증가', value: '20%' } ]},
            { type: '앰블럼', grade: '전설', name: '부서진 하늘', keyword: '각성', effects: [ { effect: '연타 피해 증가', value: '60%', condition: '공격 시 50% 확률로 각성 (20초 지속)' }, { effect: '추가 피해', value: '(공격력×n%)', condition: '각성 중 공격 적중 시 (0.5초마다)' }, { effect: '연타 피해 증가', value: '8%' }, { effect: '재사용 대기 시간 회복 속도 증가', value: '8%' } ], condition: '(재사용 대기 시간: 90초)'},
            { type: '앰블럼', grade: '전설', name: '인도하는 빛', keyword: '조건부', effects: [ { effect: '아군 공격력 증가', value: '8%', condition: '궁극기 사용 시 (15초 지속)' }, { effect: '공격력 증가', value: '20%', condition: '아군 회복 시 (15초 지속)' } ]},
            { type: '앰블럼', grade: '전설', name: '대마법사', keyword: '각성', effects: [ { effect: '공격력 증가', value: '45%', condition: '공격 시 50% 확률로 각성 (20초 지속)' }, { effect: '스킬 캐스팅 및 사용 속도 증가', value: '25%', condition: '공격 시 50% 확률로 각성 (20초 지속)' }, { effect: '스킬 사용 속도, 캐스팅 및 차지 속도 증가', value: '14%' }, { effect: '차지 스킬의 피해량 증가', value: '14%' } ], condition: '(재사용 대기 시간: 90초)'},
            { type: '앰블럼', grade: '전설', name: '흩날리는 검', keyword: '각성', effects: [ { effect: '공격력 증가', value: '35%', condition: '공격 시 50% 확률로 각성 (35초 지속)' }, { effect: '기본 공격 속도 증가', value: '20%', condition: '공격 시 50% 확률로 각성 (35초 지속)' }, { effect: '기본 공격 추가타 확률 증가', value: '20%', condition: '공격 시 50% 확률로 각성 (35초 지속)' }, { effect: '기본 공격 속도 증가', value: '24%' }, { effect: '기본 공격 추가타 확률 증가', value: '24%' } ], condition: '(재사용 대기 시간: 90초)'},
            { type: '앰블럼', grade: '전설', name: '산맥 군주', keyword: '각성', effects: [ { effect: '강타 피해 증가', value: '60%', condition: '공격 시 50% 확률로 각성 (20초 지속)' }, { effect: '추가 피해', value: '(공격력×n%)', condition: '각성 중 공격 적중 시 (3초마다)' }, { effect: '강타 피해 증가', value: '8%' }, { effect: '스킬 사용 속도 증가', value: '8%' } ], condition: '(재사용 대기 시간: 90초)'},
            { type: '앰블럼', grade: '전설', name: '아득한 빛', keyword: '각성', effects: [ { effect: '치명타 확률 증가', value: '20%', condition: '공격 시 50% 확률로 각성 (20초 지속)' }, { effect: '치명타 피해량 증가', value: '50%', condition: '공격 시 50% 확률로 각성 (20초 지속)' }, { effect: '치명타 확률 증가', value: '5%' }, { effect: '치명타 피해량 증가', value: '10%' }, { effect: '적에게 주는 피해 증가', value: '5%' } ], condition: '(재사용 대기 시간: 90초)'},
            { type: '앰블럼', grade: '전설', name: '갈라진 땅', keyword: '각성', effects: [ { effect: '추가타 확률 증가', value: '30%', condition: '공격 시 50% 확률로 각성 (35초 지속)' }, { effect: '추가 공격 발생', value: '선행 타격의 18% 피해', condition: '각성 중 추가타 적중 시' }, { effect: '추가타 확률 증가', value: '12%' } ], condition: '(재사용 대기 시간: 90초)'},
            
            // 6성 전설 무기
            { type: '무기', grade: '6성 전설', name: '천자루의 검', keyword: '', effects: [{ effect: '공격력 증가', value: '24%' }], condition: '검 클래스 레벨 40 달성마다 4% (최대 6회)' },
            
            // 6성 전설 방어구
            { type: '방어구', grade: '6성 전설', name: '횃불', keyword: '조건부', effects: [{ effect: '치명타 확률 증가', value: '10%', condition: '화상 보유 적 공격 시 (5초 지속)' }], condition: '(재사용 대기 시간: 3초)' },
            { type: '방어구', grade: '6성 전설', name: '마나 격류', keyword: '중첩', effects: [{ effect: '공격력 증가', value: '3.5%' }], condition: '스킬 사용마다 (5초 지속 / 최대 4회)' },
            { type: '방어구', grade: '6성 전설', name: '바위 거인', keyword: '조건부', effects: [{ effect: '공격력 증가', value: '3%' }, { effect: '공격력 증가', value: '20%', condition: '3중첩 도달 시 (5초 지속)' }], condition: '강타 적중 시 (최대 3회)' },
            { type: '방어구', grade: '6성 전설', name: '평원 방랑자', keyword: '조건부', effects: [{ effect: '적에게 주는 피해 증가', value: '12%' }, { effect: '이동 속도 증가', value: '30%' }], condition: '이동 스킬 사용 시 (10초 지속)' },
            { type: '방어구', grade: '6성 전설', name: '파멸의 낙인', keyword: '중첩', effects: [{ effect: '지속피해', value: '공격력×9%', condition: '파멸의 낙인 (8초 지속 / 1초마다)' }, { effect: '낙인 피해량 증가', value: '10%' }], condition: '만료마다 (최대 10회 / 공명 보유 시 초기 5중첩)' },
            { type: '방어구', grade: '6성 전설', name: '공명하는 수정', keyword: '중첩', effects: [{ effect: '적에게 주는 피해 증가', value: '2%' }, { effect: '추가 피해 증가', value: '0.6%', condition: '파멸의 낙인 보유 적' }], condition: '1초마다 (최대 12회 / 감소 후 재증가)' },
            
            // 6성 전설 앰블럼
            { type: '앰블럼', grade: '6성 전설', name: '현란함', keyword: '', effects: [{ effect: '치명타 확률 증가', value: '10%' }, { effect: '치명타 피해 증가', value: '30%' }] }
        ];

        // 대미지 계산 공식 기준으로 재구성된 키워드 카테고리
        const keywordCategories = {
            '공격력': ['공격력'],
            '강화류': ['연타 피해', '강타 피해', '광역 피해', '콤보 피해'],
            '피해증가': ['주는 피해', '스킬 피해', '방어구 파괴'],
            '치명타': ['치명타 확률', '치명타 피해'],
            '추가타': ['추가타 확률', '평타 추가타'],
            '룬 피해': ['룬 피해'],
            '지속 피해': ['지속 피해'],
            '기타': ['쿨타임', '빠른 공격', '빠른 스킬', '캐스팅 속도', '차지 속도', '회복량', 
                   '이동 속도', '궁극기 게이지', '보호막', '무방비 피해', '브레이크 스킬 피해', 
                   '브레이크 피해', '차지 스킬 피해', '룬 회복', '받는 피해', '누적 횟수', 
                   '축적 횟수', '각성 쿨타임', '결함 제거', '추가 공격']
        };
        
        // 특징 카테고리
        const featureCategories = ['누적', '중첩', '각성', '축적', '조건부', '결함', '기타'];
        
        // 누적 룬 평균 스택 계산 함수
        // 트리거: 공격=0.5초, 스킬=1초
        // 쌍둥이별 효과: 누적 횟수 2배
        function calculate누적평균스택(트리거간격, 지속시간, 최대스택, has쌍둥이별) {
            const 트리거배율 = has쌍둥이별 ? 2 : 1;
            const 실제트리거간격 = 트리거간격 / 트리거배율;
            
            // 150초 시뮬레이션
            let 스택들 = []; // [{획득시각, 만료시각}]
            let 총스택합 = 0;
            
            for (let t = 0; t < 150; t += 0.1) {
                // 트리거 발동
                if (t % 실제트리거간격 < 0.1) {
                    if (스택들.length < 최대스택) {
                        스택들.push({ 획득: t, 만료: t + 지속시간 });
                    }
                }
                
                // 만료된 스택 제거
                스택들 = 스택들.filter(s => s.만료 > t);
                
                // 현재 스택 수 기록
                총스택합 += 스택들.length * 0.1; // 0.1초 단위
            }
            
            return 총스택합 / 150;
        }
        
        // 축적 룬 가동률 계산 함수
        // 트리거 간격: 공격=0.5초, 강타=0.3초, 스킬=1초, 치명타=0.8초, 추가타=1초, 회복=0.5초
        // 에메랄드 숲: 필요 횟수 절반
        function calculate축적가동률(트리거간격, 필요횟수, 지속시간, 재사용대기, has에메랄드숲) {
            const 실제필요횟수 = has에메랄드숲 ? Math.ceil(필요횟수 / 2) : 필요횟수;
            
            // 축적 완료 시간
            const 축적완료시간 = 트리거간격 * 실제필요횟수;
            
            // 한 사이클 = 축적시간 + 재사용대기
            const 사이클시간 = 축적완료시간 + 재사용대기;
            
            // 150초 동안 발동 가능 횟수
            const 발동횟수 = Math.floor(150 / 사이클시간) + 1;
            
            // 총 가동 시간 계산
            let 총가동시간 = 0;
            for (let i = 0; i < 발동횟수; i++) {
                const 발동시각 = i * 사이클시간;
                if (발동시각 >= 150) break;
                
                // 이번 발동의 가동 시간 (150초를 넘지 않도록)
                const 이번가동 = Math.min(지속시간, 150 - 발동시각 - 축적완료시간);
                if (이번가동 > 0) {
                    총가동시간 += 이번가동;
                }
            }
            
            return 총가동시간 / 150;
        }
        
        // 특수 룬 150초 평균 계산 함수
        function calculate150sAverage(has쌍둥이별, has에메랄드숲, has파멸의낙인, has공명하는수정) {
            has에메랄드숲 = has에메랄드숲 || false;
            has파멸의낙인 = has파멸의낙인 || false;
            has공명하는수정 = has공명하는수정 || false;
            const averages = {};
            
            // === 누적 룬들 ===
            // 검무+: 공격(0.5초), 10초 지속, 최대 10스택
            const 검무평균스택 = calculate누적평균스택(0.5, 10, 10, has쌍둥이별);
            averages['검무+_공격력'] = 2.0 * 검무평균스택;
            averages['검무+_치명타확률'] = 1.0 * 검무평균스택;
            
            // 여명+: 스킬(1초), 10초 지속, 최대 6스택
            const 여명평균스택 = calculate누적평균스택(1.0, 10, 6, has쌍둥이별);
            averages['여명+'] = 3.5 * 여명평균스택;
            
            // 황혼: 공격(0.5초), 8초 지속, 최대 16스택
            const 황혼평균스택 = calculate누적평균스택(0.5, 8, 16, has쌍둥이별);
            averages['황혼'] = 1.4 * 황혼평균스택;
            
            // 종언+: 적 처치(거의 없음), 20초 지속, 최대 10스택
            // 보스전에서는 처치할 쫄몹 거의 없지만, 있다면 쌍둥이별 효과 적용
            const 종언누적배율 = has쌍둥이별 ? 2 : 1;
            averages['종언+_누적'] = 0 * 종언누적배율; // 보스전에서는 0
            averages['종언+_기본'] = 24.0;
            
            // 저무는 달: 기본 6% + 30초마다 2% 영구 누적, 최대 10스택
            // 쌍둥이별: 30초마다 2%→4%
            // 일반: 0-30초: 6%, 30-60초: 8%, 60-90초: 10%, 90-120초: 12%, 120-150초: 14%
            // 쌍둥이별: 0-30초: 6%, 30-60초: 10%, 60-90초: 14%, 90-120초: 18%, 120-150초: 22%
            const 저무는달발동횟수 = Math.floor(150 / 30); // 5회 발동 (30초, 60초, 90초, 120초, 150초)
            const 저무는달누적배율 = has쌍둥이별 ? 2 : 1;
            let 저무는달총합 = 0;
            for (let i = 0; i < 5; i++) {
                // 각 구간의 공격력 증가량: 6% + 2% * i * 누적배율
                const 구간공격력 = 6.0 + (2.0 * i * 저무는달누적배율);
                저무는달총합 += 구간공격력 * 30; // 30초 동안
            }
            averages['저무는달_총합'] = 저무는달총합 / 150;
            
            // 새벽별: 스킬(1초), 8초 지속, 최대 6스택
            const 새벽별평균스택 = calculate누적평균스택(1.0, 8, 6, has쌍둥이별);
            averages['새벽별'] = 3.0 * 새벽별평균스택;
            
            // 어두운 징조: 궁극기(20초마다), 영구, 최대 30스택
            // 150초 동안 궁극기 사용 횟수: 150 / 20 = 7.5회 → 7회
            const 궁극기발동횟수 = Math.floor(150 / 20);
            const 누적배율 = has쌍둥이별 ? 2 : 1;
            const 어두운징조스택 = Math.min(궁극기발동횟수 * 누적배율, 30); // 최대 30스택
            averages['어두운징조_공격력'] = 0.6 * 어두운징조스택;
            averages['어두운징조_치명타확률'] = 0.6 * 어두운징조스택;
            averages['어두운징조_주는피해'] = 0.6 * 어두운징조스택;
            
            // 바스러지는 빛: 스킬(1초), 8초 지속, 최대 5스택, +15강화 시 50% 추가
            // 중첩이라 쌍둥이별 효과 없음
            const 바스러지는빛평균스택 = calculate누적평균스택(1.0, 8, 5, false) * 1.5; // +15 강화 50% 추가
            averages['바스러지는 빛'] = 5.5 * 바스러지는빛평균스택;
            
            // === 중첩 룬들 ===
            // 파멸의 낙인: 8초마다 10% 증가, 최대 10중첩
            // 공명하는 수정 보유 시: 초기 중첩 5회
            const 파멸초기중첩 = has공명하는수정 ? 5 : 0;
            let total = 0;
            for (let t = 0; t < 150; t++) {
                // 8초마다 중첩 증가, 초기 중첩 적용
                const 경과중첩 = Math.floor(t / 8);
                const 현재중첩 = Math.min(10, 파멸초기중첩 + 경과중첩);
                const multiplier = 1 + (현재중첩 * 0.1);
                total += 9 * multiplier;
            }
            averages['파멸의 낙인'] = total / 150;
            
            // 공명하는 수정: 1초마다 증가, 12중첩 후 감소 (삼각파)
            // 파멸의 낙인 보유 시: 중첩 당 0.6% 추가 증가 (2% → 2.6%)
            const 공명기본피해 = 2.0;
            const 공명추가피해 = has파멸의낙인 ? 0.6 : 0;
            const 공명중첩피해 = 공명기본피해 + 공명추가피해;
            total = 0;
            for (let t = 0; t < 150; t++) {
                const cyclePos = t % 24;
                const stack = cyclePos < 12 ? cyclePos : (24 - cyclePos);
                total += 공명중첩피해 * (1 + stack);
            }
            averages['공명하는 수정'] = total / 150;
            
            // === 기타 특수 룬들 ===
            // 땅울림: 기본 8% + 전투 시작 시 30%, 3초마다 2% 감소 (최소 8%)
            // 0-3초: 38%, 3-6초: 36%, ..., 45초: 8% (그 이후 8% 유지)
            // 평균 계산: 8% + 30% 감소분 평균
            let 땅울림총합 = 0;
            for (let t = 0; t < 150; t++) {
                const 감소횟수 = Math.floor(t / 3);
                const 감소량 = Math.min(감소횟수 * 2, 30); // 최대 30%까지 감소
                땅울림총합 += 8 + (30 - 감소량);
            }
            averages['땅울림'] = 땅울림총합 / 150;
            
            // 마나 격류: 스킬마다 3.5%, 5초 지속, 최대 4중첩
            const 마나격류평균스택 = calculate누적평균스택(1.0, 5, 4, false); // 6성이라 쌍둥이별 영향 없음
            averages['마나 격류'] = 3.5 * 마나격류평균스택;
            
            // 바위 거인: 강타로 3% 3중첩, 3중첩 도달 시 소모하고 20% 5초
            averages['바위 거인'] = 19.0;
            
            // === 축적 룬들 ===
            // 바위 감시자: 강타 7회, 6초 지속, 재사용 없음 (중첩 안됨)
            // [계산 로직]
            // - 강타 0.3초, 7회 축적 = 2.1초
            // - 에메랄드 숲: 7회 → 4회 축적 = 1.2초
            // - 발동 후: 공격력 22% 버프 6초
            // - 재사용 없음 (지속 종료 후 바로 축적 가능)
            // - 사이클: 2.1초(축적) + 6초(지속) = 8.1초
            // - 에메랄드: 1.2초(축적) + 6초(지속) = 7.2초
            // - 150초 / 8.1초 = 18.5회 → 18회 발동
            // - 에메랄드: 150초 / 7.2초 = 20.8회 → 20회 발동
            // - 가동률 = 6초 × 18회 / 150초 = 72%
            // - 에메랄드 가동률 = 6초 × 20회 / 150초 = 80%
            // - 공격력 = 22% × 72% = 15.8%
            // - 에메랄드 공격력 = 22% × 80% = 17.6%
            const 바위감시자필요횟수 = has에메랄드숲 ? Math.ceil(7 / 2) : 7;
            const 바위감시자사이클 = 0.3 * 바위감시자필요횟수 + 6; // 축적 + 지속
            const 바위감시자발동 = Math.floor(150 / 바위감시자사이클) + 1;
            let 바위감시자총가동 = 0;
            for (let i = 0; i < 바위감시자발동; i++) {
                const 발동시각 = i * 바위감시자사이클;
                if (발동시각 >= 150) break;
                const 축적시각 = 발동시각 + (0.3 * 바위감시자필요횟수);
                const 가동 = Math.min(6, 150 - 축적시각);
                if (가동 > 0) 바위감시자총가동 += 가동;
            }
            averages['바위 감시자'] = 22.0 * (바위감시자총가동 / 150);
            
            // 요정 무리: 스킬 7회, 재사용 3초 (2.1초 감소 효과, 중첩 안됨)
            // [계산 로직]
            // - 스킬 1초, 7회 축적 = 7초
            // - 에메랄드 숲: 7회 → 4회 축적 = 4초
            // - 발동 후: 즉시 모든 스킬 쿨타임 2.1초 감소 (1회 효과)
            // - 재사용 대기: 3초
            // - 사이클: 7초(축적) + 3초(재사용) = 10초
            // - 에메랄드: 4초(축적) + 3초(재사용) = 7초
            // - 150초 / 10초 = 15회 발동
            // - 에메랄드: 150초 / 7초 = 21회 발동
            // - 효과 = 2.1초 × 15회 = 31.5초
            // - 에메랄드 효과 = 2.1초 × 21회 = 44.1초
            const 요정무리필요횟수 = has에메랄드숲 ? Math.ceil(7 / 2) : 7;
            const 요정무리사이클 = (1.0 * 요정무리필요횟수) + 3; // 축적 + 재사용
            const 요정무리발동 = Math.floor(150 / 요정무리사이클);
            averages['요정 무리'] = 2.1 * 요정무리발동; // 초 단위 효과
            
            // 수정 꽃잎: 치명타 6회, 룬피해 45% + 공격력 12% 10초, 재사용 3초 (중첩 안됨)
            // [계산 로직]
            // - 치명타 0.8초, 6회 축적 = 4.8초
            // - 에메랄드 숲: 6회 → 3회 축적 = 2.4초
            // - 발동 후: 즉시 45% 피해 + 공격력 12% 버프 10초
            // - 재사용 대기: 3초 (축적 시작 가능)
            // - 사이클: 4.8초(축적) + 3초(재사용) = 7.8초
            // - 에메랄드: 2.4초(축적) + 3초(재사용) = 5.4초
            // - 150초 / 7.8초 = 19.2회 → 19회 발동
            // - 에메랄드: 150초 / 5.4초 = 27.8회 → 27회 발동
            // - 룬 피해 DPS: 45% × 19회 / 150초 = 5.7%
            // - 에메랄드: 45% × 27회 / 150초 = 8.1%
            const 수정꽃잎필요횟수 = has에메랄드숲 ? Math.ceil(6 / 2) : 6;
            const 수정꽃잎축적 = 0.8 * 수정꽃잎필요횟수;
            const 수정꽃잎사이클 = 수정꽃잎축적 + 3; // 축적 + 재사용
            const 수정꽃잎발동 = Math.floor(150 / 수정꽃잎사이클);
            // 룬 피해: 1회 발동당 45% (즉시)
            averages['수정꽃잎_룬피해'] = 45.0 * 수정꽃잎발동 / 150;
            // 공격력: 10초 지속, 중첩 안되지만 사이클이 짧아서 계속 유지
            let 수정꽃잎총가동 = 0;
            for (let i = 0; i < 수정꽃잎발동; i++) {
                const 발동시각 = i * 수정꽃잎사이클 + 수정꽃잎축적 + 3;
                if (발동시각 >= 150) break;
                const 가동 = Math.min(10, 150 - 발동시각);
                if (가동 > 0) 수정꽃잎총가동 += 가동;
            }
            averages['수정꽃잎_공격력'] = 12.0 * (수정꽃잎총가동 / 150);
            
            // 나무 사슴: 추가타 6회, 룬피해 56% + 공격력 12% 10초, 재사용 4초 (중첩 안됨)
            // [계산 로직]
            // - 추가타 1초, 6회 축적 = 6초
            // - 에메랄드 숲: 6회 → 3회 축적 = 3초
            // - 발동 후: 즉시 56% 피해 + 공격력 12% 버프 10초
            // - 재사용 대기: 4초 (축적 시작 가능)
            // - 사이클: 6초(축적) + 4초(재사용) = 10초
            // - 에메랄드: 3초(축적) + 4초(재사용) = 7초
            // - 150초 / 10초 = 15회 발동
            // - 에메랄드: 150초 / 7초 = 21회 발동
            // - 룬 피해 DPS: 56% × 15회 / 150초 = 5.6%
            // - 에메랄드: 56% × 21회 / 150초 = 7.8%
            const 나무사슴필요횟수 = has에메랄드숲 ? Math.ceil(6 / 2) : 6;
            const 나무사슴축적 = 1.0 * 나무사슴필요횟수;
            const 나무사슴사이클 = 나무사슴축적 + 4; // 축적 + 재사용
            const 나무사슴발동 = Math.floor(150 / 나무사슴사이클);
            // 룬 피해: 1회 발동당 56% (즉시)
            averages['나무사슴_룬피해'] = 56.0 * 나무사슴발동 / 150;
            // 공격력: 10초 지속, 중첩 안되지만 사이클이 10초라 거의 100% 유지
            let 나무사슴총가동 = 0;
            for (let i = 0; i < 나무사슴발동; i++) {
                const 발동시각 = i * 나무사슴사이클 + 나무사슴축적 + 4;
                if (발동시각 >= 150) break;
                const 가동 = Math.min(10, 150 - 발동시각);
                if (가동 > 0) 나무사슴총가동 += 가동;
            }
            averages['나무사슴_공격력'] = 12.0 * (나무사슴총가동 / 150);
            
            // 푸른 거목: 스킬 5회마다 2.2% 영구 증가, 최대 10중첩
            // [계산 로직]
            // - 스킬 1초, 5회마다 스택 +1
            // - 에메랄드 숲: 5회 → 3회마다 스택 +1
            // - 영구 증가이므로 최대 10스택까지 누적
            // - 일반: 5초, 10초, 15초... → 50초에 10스택 도달 → 이후 22% 유지
            // - 에메랄드: 3초, 6초, 9초... → 30초에 10스택 도달 → 이후 22% 유지
            // - 평균 계산: 150초 시뮬레이션
            const 푸른거목발동간격 = has에메랄드숲 ? Math.ceil(5 / 2) : 5; // 스킬 횟수
            let 푸른거목총합 = 0;
            let 푸른거목스택 = 0;
            for (let t = 0; t < 150; t++) {
                // 발동간격마다 스택 증가
                if (t > 0 && t % 푸른거목발동간격 === 0 && 푸른거목스택 < 10) {
                    푸른거목스택++;
                }
                푸른거목총합 += 2.2 * 푸른거목스택;
            }
            averages['푸른 거목'] = 푸른거목총합 / 150;
            
            // 잊힌 성소: 스킬/기본공격 60회, 5초 지속 피해, 재사용 없음 (중첩 안됨)
            // [계산 로직]
            // - 기본 공격 0.5초 기준, 60회 축적 = 30초
            // - 에메랄드 숲: 60회 → 30회 축적 = 15초
            // - 발동 후 5초 동안 0.1초마다 15% 피해 (총 50회 = 750%)
            // - 사이클: 30초(축적) + 5초(지속) = 35초
            // - 에메랄드: 15초(축적) + 5초(지속) = 20초
            // - 150초 / 35초 = 4.28회 → 4회 발동
            // - 에메랄드: 150초 / 20초 = 7.5회 → 7회 발동
            // - DPS = 750% × 4회 / 150초 = 20%
            // - 에메랄드 DPS = 750% × 7회 / 150초 = 35%
            const 잊힌성소필요횟수 = has에메랄드숲 ? Math.ceil(60 / 2) : 60;
            const 잊힌성소축적시간 = 0.5 * 잊힌성소필요횟수;
            const 잊힌성소지속시간 = 5;
            const 잊힌성소사이클 = 잊힌성소축적시간 + 잊힌성소지속시간;
            const 잊힌성소발동 = Math.floor(150 / 잊힌성소사이클);
            // 5초 동안 0.1초마다 15% = 50회 × 15% = 750%
            const 잊힌성소총피해 = 15.0 * 50;
            averages['잊힌 성소'] = 잊힌성소총피해 * 잊힌성소발동 / 150;
            
            // === 조건부 룬들 (가동률 재계산 필요) ===
            // 필사+: 기본 10% + 체력 50% 이하 시 20% (20초 지속)
            // 클래스마다 다름, 평균 5% 가동률로 가정
            const 필사가동률 = 0.05; // 150초 중 7.5초
            averages['필사+_기본'] = 10.0;
            averages['필사+_추가'] = 20.0 * 필사가동률;
            
            // 성역+: 보호막 유지 시 공격력 17%
            // 포션 5개 + 30초마다 자동 (최대 5회)
            // 보호막이 겹치므로 거의 100% 유지 가정
            averages['성역+_공격력'] = 17.0 * 0.9; // 90% 가동
            averages['성역+_보호막'] = 13.9; // 보호막 자체는 10회 생성
            
            // 만 갈래 물길: 클래스 레벨 50마다 1% (최대 20회)
            // 모든 클래스 20개 레벨 50 달성 가정
            averages['만갈래물길_기본'] = 15.0;
            averages['만갈래물길_추가'] = 1.0 * 20; // 20클래스 최대
            
            // 무한: 기본 공격 시 쿨타임 9% 감소
            // 기본 공격 0.5초마다, 스킬 위주 빌드는 적게 사용
            // 평균 50%만 기본 공격 사용으로 가정 (150회)
            averages['무한_쿨타임'] = 9.0 * 0.5; // 50% 가동
            
            // 이름 없는 혼돈: 5초마다 5초 동안 10~30%
            // "5초마다 5초 동안" = 5초 발동 종료 후 즉시 다음 5초 발동
            // 가동률: 100% (항상 발동 중)
            // +15 강화: 10~40% (평균 25%)
            // +15 가정
            averages['이름없는혼돈'] = 25.0; // 평균 25%, 가동률 100%
            
            // 끝없는 순환: 공격 20회 or 회복 20회 (중첩 안됨)
            // [계산 로직]
            // - 공격 0.5초, 20회 축적 = 10초
            // - 에메랄드 숲: 20회 → 10회 축적 = 5초
            // - 발동 후 4.5초 동안 0.5초마다 21% 피해 (총 9회 = 189%)
            // - 사이클: 10초(축적) + 4.5초(지속) = 14.5초
            // - 에메랄드: 5초(축적) + 4.5초(지속) = 9.5초
            // - 150초 / 14.5초 = 10.3회 → 10회 발동
            // - 에메랄드: 150초 / 9.5초 = 15.8회 → 15회 발동
            // - DPS = 189% × 10회 / 150초 = 12.6%
            // - 에메랄드 DPS = 189% × 15회 / 150초 = 18.9%
            const 끝없는순환필요횟수 = has에메랄드숲 ? Math.ceil(20 / 2) : 20;
            const 끝없는순환축적시간 = 0.5 * 끝없는순환필요횟수;
            const 끝없는순환지속시간 = 4.5;
            const 끝없는순환사이클 = 끝없는순환축적시간 + 끝없는순환지속시간;
            const 끝없는순환발동 = Math.floor(150 / 끝없는순환사이클);
            // 4.5초 동안 0.5초마다 21% = 9회 × 21% = 189%
            const 끝없는순환총피해 = 21.0 * 9;
            const 끝없는순환총회복 = 0.5 * 9;
            averages['끝없는순환_공격'] = 끝없는순환총피해 * 끝없는순환발동 / 150;
            averages['끝없는순환_회복'] = 끝없는순환총회복 * 끝없는순환발동 / 150;
            
            return averages;
        }
        
        // runeSpecialAverages는 calculateEffects 내에서 동적으로 계산됨
        
        // 룬 효율 계산을 위한 상세 데이터
        const runeEfficiencyData = {
            '불길': { keywords: ['치명타 확률', '지속 피해'], values: [18.0, 356.0], counts: [150, 15], efficiencies: [18.0, 35.6] },
            '결정': { keywords: ['추가타 확률', '지속 피해'], values: [18.0, 356.0], counts: [150, 15], efficiencies: [18.0, 35.6] },
            '뇌명': { keywords: ['강타 피해', '지속 피해'], values: [20.0, 356.0], counts: [150, 15], efficiencies: [20.0, 35.6] },
            '독사+': { keywords: ['연타 피해', '지속 피해'], values: [20.0, 356.0], counts: [150, 15], efficiencies: [20.0, 35.6] },
            '공포': { keywords: ['치명타 피해', '지속 피해'], values: [18.0, 356.0], counts: [150, 15], efficiencies: [18.0, 35.6] },
            '집행자': { keywords: ['회복량', '주는 피해', '지속 피해'], values: [20.0, 10.0, 533.0], counts: [150, 150, 15], efficiencies: [20.0, 10.0, 53.3] },
            '야수+': { keywords: ['주는 피해', '지속 피해'], values: [20.0, 356.0], counts: [150, 15], efficiencies: [20.0, 35.6] },
            '밤+': { keywords: ['공격력', '지속 피해'], values: [20.0, 356.0], counts: [150, 15], efficiencies: [20.0, 35.6] },
            '투사+': { keywords: ['주는 피해', '광역 피해'], values: [33.0, -10.0], counts: [150, 150], efficiencies: [33.0, -10.0] },
            '은둔자+': { keywords: ['공격력', '쿨타임'], values: [33.0, -9.0], counts: [150, 150], efficiencies: [33.0, -9.0] },
            '망각+': { keywords: ['공격력', '쿨타임'], values: [19.0, 9.0], counts: [150, 150], efficiencies: [19.0, 9.0] },
            '서리바람+': { keywords: ['공격력', '캐스팅 속도', '차지 속도'], values: [20.0, 25.0, 25.0], counts: [150, 150, 150], efficiencies: [20.0, 25.0, 25.0] },
            '옛 마법사': { keywords: ['쿨타임', '주는 피해'], values: [29.0, -10.0], counts: [150, 150], efficiencies: [29.0, -10.0] },
            '물결치는 날': { keywords: ['룬 피해', '빠른 공격'], values: [152.0, 10.0], counts: [100, 100], efficiencies: [101.3, 6.7] },
            '파괴자+': { keywords: ['공격력', '무방비 피해'], values: [18.0, 48.0], counts: [150, 1], efficiencies: [18.0, 0.3] },
            '검무+': { keywords: ['공격력', '치명타 확률'], values: [2.0, 1.0], counts: [145, 145], efficiencies: [1.9, 1.0] },
            '무수한 궤적': { keywords: ['공격력', '빠른 공격', '평타 추가타'], values: [10.0, 30.0, 30.0], counts: [150, 150, 150], efficiencies: [10.0, 30.0, 30.0] },
            '마지막 자비': { keywords: ['공격력', '공격력'], values: [20.0, 20.0], counts: [150, 75], efficiencies: [20.0, 10.0] },
            '끝없는 순환': { keywords: ['룬 피해', '룬 회복'], values: [21.0, 0.5], counts: [90, 90], efficiencies: [12.6, 0.3] },
            '종언+': { keywords: ['공격력', '공격력'], values: [2.0, 24.0], counts: [0, 150], efficiencies: [0.0, 24.0] },
            '영웅': { keywords: ['공격력', '연타 피해', '강타 피해', '콤보 피해', '스킬 피해', '치명타 피해', '광역 피해'], values: [4.3, 4.3, 4.3, 4.3, 4.3, 4.3, 4.3], counts: [150, 150, 150, 150, 150, 150, 150], efficiencies: [4.3, 4.3, 4.3, 4.3, 4.3, 4.3, 4.3] },
            '여명+': { keywords: ['공격력'], values: [3.5], counts: [145], efficiencies: [3.4] },
            '황혼': { keywords: ['주는 피해'], values: [1.4], counts: [140], efficiencies: [1.3] },
            '바위 감시자': { keywords: ['공격력'], values: [22.0], counts: [145], efficiencies: [21.3] },
            '쇄도+': { keywords: ['캐스팅 속도', '차지 속도', '빠른 스킬'], values: [20.0, 20.0, 20.0], counts: [75, 75, 75], efficiencies: [10.0, 10.0, 10.0] },
            '무도가+': { keywords: ['공격력', '궁극기 게이지'], values: [12.0, 20.0], counts: [150, 150], efficiencies: [12.0, 20.0] },
            '해결사+': { keywords: ['빠른 공격', '평타 추가타'], values: [30.0, 30.0], counts: [150, 150], efficiencies: [30.0, 30.0] },
            '들불': { keywords: ['치명타 확률'], values: [14.0], counts: [150], efficiencies: [14.0] },
            '설산': { keywords: ['추가타 확률'], values: [16.0], counts: [150], efficiencies: [16.0] },
            '절개+': { keywords: ['공격력'], values: [20.0], counts: [150], efficiencies: [20.0] },
            '환영+': { keywords: ['공격력', '방어구 파괴'], values: [18.0, 10.0], counts: [150, 150], efficiencies: [18.0, 10.0] },
            '황금 들판': { keywords: ['공격력'], values: [20.0], counts: [150], efficiencies: [20.0] },
            '모래 폭풍': { keywords: ['빠른 스킬', '빠른 공격', '빠른 스킬', '빠른 공격'], values: [10.0, 10.0, 24.0, 24.0], counts: [150, 150, 1, 1], efficiencies: [10.0, 10.0, 0.2, 0.2] },
            '황폐+': { keywords: ['주는 피해', '추가타 확률'], values: [12.0, 7.0], counts: [135, 135], efficiencies: [10.8, 6.3] },
            '신성한 칙령': { keywords: ['공격력', '회복량'], values: [15.0, 9.0], counts: [150, 150], efficiencies: [15.0, 9.0] },
            '준비된 자': { keywords: ['주는 피해'], values: [20.0], counts: [150], efficiencies: [20.0] },
            '저무는 달': { keywords: ['공격력', '방어력'], values: [2.0, 2.0], counts: [5, 5], efficiencies: [0.1, 0.1] },
            '땅울림': { keywords: ['공격력', '공격력', '공격력'], values: [8.0, 30.0, -2.0], counts: [150, 45, 45], efficiencies: [8.0, 9.0, -0.6] },
            '신전 기사': { keywords: ['공격력', '치명타 확률'], values: [23.0, -8.0], counts: [150, 150], efficiencies: [23.0, -8.0] },
            '근위병+': { keywords: ['공격력', '쿨타임'], values: [23.0, -7.0], counts: [150, 150], efficiencies: [23.0, -7.0] },
            '침묵하는 산': { keywords: ['공격력'], values: [22.0], counts: [100], efficiencies: [14.7] },
            '필사+': { keywords: ['공격력', '공격력'], values: [10.0, 20.0], counts: [150, 10], efficiencies: [10.0, 1.3] },
            '파멸+': { keywords: ['공격력'], values: [25.0], counts: [130], efficiencies: [21.7] },
            '집정관': { keywords: ['공격력', '빠른 스킬', '캐스팅 속도', '차지 속도'], values: [23.0, -8.0, -8.0, -8.0], counts: [150, 150, 150, 150], efficiencies: [23.0, -8.0, -8.0, -8.0] },
            '새벽별': { keywords: ['쿨타임'], values: [3.0], counts: [120], efficiencies: [2.4] },
            '눈 먼 예언자': { keywords: ['각성 쿨타임'], values: [38], counts: [150], efficiencies: [38] },
            '압도적인 힘': { keywords: ['강타 피해', '공격력', '치명타 확률', '강타 피해', '공격력', '치명타 확률'], values: [6.0, 6.0, 4.0, 6.0, 6.0, 4.0], counts: [150, 150, 150, 33, 33, 33], efficiencies: [6.0, 6.0, 4.0, 1.3, 1.3, 0.9] },
            '섬세한 손놀림': { keywords: ['연타 피해', '공격력', '추가타 확률', '연타 피해', '공격력', '추가타 확률'], values: [6.0, 6.0, 4.0, 6.0, 6.0, 4.0], counts: [150, 150, 150, 33, 33, 33], efficiencies: [6.0, 6.0, 4.0, 1.3, 1.3, 0.9] },
            '성역+': { keywords: ['공격력', '보호막'], values: [17.0, 13.9], counts: [120, 10], efficiencies: [13.6, 0.9] },
            '불안정한 힘': { keywords: ['주는 피해'], values: [22.0], counts: [90], efficiencies: [13.2] },
            '고대 수호자': { keywords: ['공격력', '이동 속도'], values: [23.0, -8.0], counts: [150, 150], efficiencies: [23.0, -8.0] },
            '갈퀴발톱+': { keywords: ['브레이크 스킬 피해', '브레이크 피해', '무방비 피해'], values: [24.0, 24.0, 24.0], counts: [150, 150, 1], efficiencies: [24.0, 24.0, 0.2] },
            '태양': { keywords: ['룬 피해'], values: [89.0], counts: [43], efficiencies: [25.4] },
            '싹쓸바람': { keywords: ['룬 피해'], values: [38.0], counts: [89], efficiencies: [22.6] },
            '혼돈': { keywords: ['룬 피해'], values: [102.0], counts: [25], efficiencies: [17.0] },
            '붕괴하는 별': { keywords: ['룬 피해', '공격력'], values: [30.0, 10.0], counts: [50, 150], efficiencies: [10.0, 10.0] },
            '돌격대장+': { keywords: ['방어구 파괴', '공격력'], values: [10.0, 20.0], counts: [150, 150], efficiencies: [10.0, 20.0] },
            '지휘관': { keywords: ['공격력', '공격력', '공격력', '공격력', '공격력'], values: [4.5, 4.5, 4.5, 4.5, 4.5], counts: [150, 150, 1, 120, 90], efficiencies: [4.5, 4.5, 0.0, 3.6, 2.7] },
            '응징+': { keywords: ['공격력', '룬 회복'], values: [12.0, 24.5], counts: [150, 0], efficiencies: [12.0, 0.0] },
            '집념+': { keywords: ['캐스팅 속도', '차지 속도', '주는 피해'], values: [25.0, 25.0, 10.0], counts: [150, 150, 150], efficiencies: [25.0, 25.0, 10.0] },
            '분쇄+': { keywords: ['공격력', '주는 피해'], values: [6.0, 28.0], counts: [150, 1], efficiencies: [6.0, 0.2] },
            '쌍둥이 별': { keywords: ['누적 횟수', '캐스팅 속도', '차지 속도', '빠른 스킬'], values: [1, 7.0, 7.0, 7.0], counts: [150, 150, 150, 150], efficiencies: [1, 7.0, 7.0, 7.0] },
            '푸른 거목': { keywords: ['스킬 피해'], values: [2.2], counts: [100], efficiencies: [1.5] },
            '어두운 징조': { keywords: ['공격력', '치명타 확률', '주는 피해'], values: [0.6, 0.6, 0.6], counts: [8, 8, 8], efficiencies: [0.0, 0.0, 0.0] },
            '요정 무리': { keywords: ['쿨타임'], values: [2.1], counts: [21], efficiencies: [2.1] },
            '수정 꽃잎': { keywords: ['룬 피해', '공격력'], values: [45.0, 12.0], counts: [50, 150], efficiencies: [15.0, 12.0] },
            '나무 사슴': { keywords: ['룬 피해', '공격력'], values: [56.0, 12.0], counts: [38, 150], efficiencies: [14.0, 12.0] },
            '에메랄드 숲': { keywords: ['축적 횟수', '주는 피해'], values: [1, 10.0], counts: [150, 150], efficiencies: [1, 10.0] },
            '불사': { keywords: ['주는 피해', '룬 회복', '받는 피해'], values: [18.0, 100.0, 80.0], counts: [150, 1, 1], efficiencies: [18.0, 0.7, 0.5] },
            '싸움꾼': { keywords: ['주는 피해', '받는 피해'], values: [12.0, 8.0], counts: [150, 150], efficiencies: [12.0, 8.0] },
            '약탈자': { keywords: ['룬 회복', '추가타 확률'], values: [3.0, 10.0], counts: [150, 150], efficiencies: [3.0, 10.0] },
            '원소 조화': { keywords: ['룬 피해'], values: [42.0], counts: [90], efficiencies: [25.2] },
            '다가오는 죽음': { keywords: ['룬 피해'], values: [185.75], counts: [15], efficiencies: [18.6] },
            '잊힌 성소': { keywords: ['룬 피해'], values: [15.0], counts: [250], efficiencies: [25.0] },
            '만 갈래 물길': { keywords: ['공격력', '공격력'], values: [15.0, 20.0], counts: [150, 150], efficiencies: [15.0, 20.0] },
            '흰 까마귀': { keywords: ['빠른 공격', '이동 속도', '빠른 스킬', '캐스팅 속도', '차지 속도', '쿨타임', '주는 피해', '공격력'], values: [10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 7.0, 7.0], counts: [150, 150, 150, 150, 150, 150, 150, 150], efficiencies: [10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 7.0, 7.0] },
            '메아리치는 진노': { keywords: ['룬 피해', '지속 피해', '룬 피해', '지속 피해', '공격력', '공격력', '공격력'], values: [110.0, 35.0, 110.0, 35.0, 5.0, 3.0, 3.0], counts: [19, 19, 19, 19, 150, 150, 150], efficiencies: [13.8, 4.4, 13.8, 4.4, 5.0, 3.0, 3.0] },
            '무한': { keywords: ['쿨타임', '공격력', '빠른 공격'], values: [9.0, 20.0, 12.0], counts: [75, 150, 150], efficiencies: [4.5, 20.0, 12.0] },
            '닫힌 운명': { keywords: ['룬 피해', '룬 피해', '룬 피해', '방어구 파괴'], values: [68.0, 136.0, 272.0, 10.0], counts: [10, 10, 10, 150], efficiencies: [4.5, 9.1, 18.1, 10.0] },
            '검게 물든 후광': { keywords: ['받는 피해', '주는 피해', '주는 피해', '주는 피해'], values: [-15.0, 15.0, 6.0, 6.0], counts: [150, 150, 150, 150], efficiencies: [-15.0, 15.0, 6.0, 6.0] },
            '그림자로 엮은 회랑': { keywords: ['룬 피해', '룬 피해', '룬 피해', '룬 피해'], values: [25.0, 25.0, 25.0, 25.0], counts: [75, 50, 38, 30], efficiencies: [12.5, 8.3, 6.3, 5.0] },
            '바스러지는 빛': { keywords: ['공격력'], values: [5.5], counts: [148], efficiencies: [5.4] },
            '세상을 삼키는 악의': { keywords: ['주는 피해', '무방비 피해', '주는 피해', '주는 피해'], values: [16.0, 16.0, 3.0, 3.0], counts: [150, 1, 150, 150], efficiencies: [16.0, 0.1, 3.0, 3.0] },
            '이름 없는 혼돈': { keywords: ['공격력'], values: [25.0], counts: [150], efficiencies: [25.0] },
            '영원': { keywords: ['결함 제거', '공격력'], values: [0, 10.0], counts: [150, 150], efficiencies: [0, 10.0] },
            '쏟아지는 별': { keywords: ['룬 피해', '룬 피해', '룬 피해'], values: [315.0, 45.0, 315.0], counts: [10, 10, 8], efficiencies: [21.0, 3.0, 15.8] },
            '무자비한 포식자': { keywords: ['스킬 피해', '쿨타임', '주는 피해'], values: [55.0, 100.0, 21.0], counts: [1, 1, 150], efficiencies: [0.4, 0.7, 21.0] },
            '순수한 힘': { keywords: ['주는 피해', '궁극기 게이지'], values: [27.0, 20.0], counts: [133, 150], efficiencies: [24.0, 20.0] },
            '부서진 하늘': { keywords: ['연타 피해', '룬 피해', '연타 피해', '쿨타임'], values: [60.0, 29.0, 8.0, 8.0], counts: [33, 67, 150, 150], efficiencies: [13.3, 12.9, 8.0, 8.0] },
            '인도하는 빛': { keywords: ['공격력', '공격력'], values: [8.0, 20.0], counts: [8, 150], efficiencies: [0.4, 20.0] },
            '대마법사': { keywords: ['공격력', '캐스팅 속도', '차지 속도', '캐스팅 속도', '차지 속도', '차지 스킬 피해'], values: [45.0, 25.0, 25.0, 14.0, 14.0, 14.0], counts: [33, 33, 33, 150, 150, 150], efficiencies: [10.0, 5.6, 5.6, 14.0, 14.0, 14.0] },
            '흩날리는 검': { keywords: ['공격력', '빠른 공격', '평타 추가타', '빠른 공격', '평타 추가타'], values: [35.0, 20.0, 20.0, 24.0, 24.0], counts: [58, 58, 58, 150, 150], efficiencies: [13.6, 7.8, 7.8, 24.0, 24.0] },
            '산맥 군주': { keywords: ['강타 피해', '룬 피해', '강타 피해', '빠른 스킬'], values: [60.0, 155.0, 8.0, 8.0], counts: [33, 11, 150, 150], efficiencies: [13.3, 11.5, 8.0, 8.0] },
            '아득한 빛': { keywords: ['치명타 확률', '치명타 피해', '치명타 확률', '치명타 피해', '주는 피해'], values: [20.0, 50.0, 5.0, 10.0, 5.0], counts: [33, 33, 150, 150, 150], efficiencies: [4.4, 11.1, 5.0, 10.0, 5.0] },
            '갈라진 땅': { keywords: ['추가타 확률', '추가 공격', '추가타 확률'], values: [30.0, 18.0, 12.0], counts: [58, 58, 150], efficiencies: [11.7, 7.0, 12.0] },
            '천자루의 검': { keywords: ['공격력'], values: [24.0], counts: [150], efficiencies: [24.0] },
            '횃불': { keywords: ['치명타 확률'], values: [10.0], counts: [150], efficiencies: [10.0] },
            '마나 격류': { keywords: ['공격력'], values: [14.0], counts: [143], efficiencies: [13.3] },
            '바위 거인': { keywords: ['공격력'], values: [20.0], counts: [143], efficiencies: [19.0] },
            '평원 방랑자': { keywords: ['주는 피해', '이동 속도'], values: [12.0, 10.0], counts: [143, 143], efficiencies: [11.4, 9.5] },
            '파멸의 낙인': { keywords: ['룬 피해'], values: [9.0], counts: [150], efficiencies: [9.0] },
            '공명하는 수정': { keywords: ['주는 피해'], values: [2.0], counts: [150], efficiencies: [2.0] },
            '현란함': { keywords: ['치명타 확률', '치명타 피해'], values: [10.0, 30.0], counts: [150, 150], efficiencies: [10.0, 30.0] }
        };
        
        const allDescriptions = {
            // 무기 전설
            '불길': '치명타 확률이 18% 증가한다.\n공격 적중 시, (공격력×356%)의 지속 피해: 화상을 준다.(재사용 대기 시간: 10초)',
            '결정': '추가타 확률이 18% 증가한다.\n공격 적중 시, (공격력×356%)의 지속 피해: 빙결을 준다.(재사용 대기 시간: 10초)',
            '뇌명': '강타 피해가 20% 증가한다.\n공격 적중 시, (공격력×356%)의 지속 피해: 감전을 준다.(재사용 대기 시간: 10초)',
            '독사+': '연타 피해가 20% 증가한다.\n공격 적중 시, (공격력×356%)의 지속 피해: 중독을 준다.(재사용 대기 시간: 10초) ',
            '공포': '치명타 피해가 18% 증가한다.\n공격 적중 시, (공격력×356%)의 지속 피해: 암흑을 준다.(재사용 대기 시간: 10초)',
            '집행자': '치유량이 20%, 적에게 주는 피해가 10% 증가한다.\n공격 적중 시, (공격력×533%)의 지속 피해: 신성을 준다.(재사용 대기 시간: 10초)',
            '야수+': '적에게 주는 피해가 20% 증가한다.\n공격 적중 시, (공격력×356%)의 지속 피해: 출혈을 준다.(재사용 대기 시간: 10초)',
            '밤+': '공격력이 20% 증가한다.\n공격 적중 시, (공격력×356%)의 지속 피해: 정신을 준다.(재사용 대기 시간: 10초)',
            '투사+': '적에게 주는 피해가 33% 증가한다.결함: 멀티히트 피해가 10% 감소한다.',
            '은둔자+': '공격력이 33% 증가한다.결함: 재사용 대기 시간 회복 속도가 9% 감소한다.',
            '망각+': '공격력이 19% 증가한다.기본 공격 적중 시, 모든 스킬의 재사용 대기 시간이 9% 감소한다.',
            '서리바람+': '공격력이 20% 증가하고, 캐스팅 및 차지 속도가 25% 증가한다.',
            '옛 마법사': '재사용 대기 시간 회복 속도가 29% 증가한다.결함: 적에게 주는 피해가 10% 감소한다.',
            '물결치는 날': '스킬 사용 시, 다음 기본 공격 적중 시 대상에게 (공격력×152%)의 피해를 추가로 입히고, 다음 1회의 기본 공격 속도가 10% 증가한다.',
            '파괴자+': '공격력이 18% 증가하고, 무방비 피해가 48% 증가한다.',
            '검무+': '누적: 공격이 적중할 때마다 10초 동안 공격력이 2%, 치명타 확률이 1% 증가한다.해당 효과는 최대 10회까지 중첩되며 지속 시간은 스택마다 개별로 가진다.',
            '무수한 궤적': '공격력이 10%, 기본 공격 속도가 30% 증가하며, 기본 공격 추가타 확률이 30% 증가한다.',
            '마지막 자비': '공격력이 20% 증가한다.남은 체력이 50% 이하인 적을 공격했을 경우, 10초 동안 공격력이 추가로 20% 증가한다.',
            '끝없는 순환': '축적: 아군을 20회 회복시킨 이후, 다음 공격 적중 시 대상의 위치에 마법진을 펼쳐 9m 범위 내의 적들에게 0.5초마다 (공격력×21%)의 암흑 피해를 4.5초 동안 입힌다.축적: 적을 20회 공격한 이후, 다음 아군 회복 시 대상의 위치에 마법진을 펼쳐 9m 범위 내의 아군의 체력을 0.5초마다 (공격력×0.5%)씩 4.5초 동안 회복한다.축적 효과는 각각 0.5초에 한 번만 획득 할 수 있다.',
            '종언+': '누적: 자신과 전투 중인 적이 처치되었을 경우, 공격력이 20초 동안 2% 증가한다. 해당 효과는 최대 10회까지 중첩되며 지속 시간은 스택마다 개별로 가진다.공격력이 24% 증가한다.',
            '영웅': '공격력, 연타 피해, 강타 피해, 콤보 피해, 스킬 피해, 치명타 피해, 멀티 히트 피해가 각각 4.3% 증가한다.',
            
            // 방어구 전설
            '여명+': '누적: 스킬을 사용할 때마다 10초 동안 공격력이 3.5% 증가한다. 해당 효과는 최대 6회까지 중첩되며 지속 시간은 스택마다 개별로 가진다.',
            '황혼': '누적: 공격이 적중할 때마다 8초 동안 적에게 주는 피해가 1.4% 증가한다. 해당 효과는 최대 16회까지 중첩되며 지속 시간은 스택마다 개별로 가진다.',
            '바위 감시자': '축적: 강타 7회 적중 시, 6초 동안 공격력이 22% 증가한다.',
            '쇄도+': '스킬 사용 시, 25% 확률로 5초 동안 캐스팅 및 차지 속도와 스킬 사용 속도가 20% 증가한다.',
            '무도가+': '공격력이 12% 증가하며, 궁극기 게이지 획득량이 20% 증가한다.',
            '해결사+': '공격 속도가 30% 증가하며, 기본 공격의 추가타 확률이 30% 증가한다.',
            '들불': '지속 피해: 화상을 보유한 적 공격 시, 5초 동안 치명타 확률이 14% 증가한다.(재사용 대기 시간: 3초)',
            '설산': '지속 피해: 빙결을 보유한 적 공격 시, 5초 동안 추가타 확률이 16% 증가한다.(재사용 대기 시간: 3초)',
            '절개+': '지속 피해: 출혈을 보유한 적 공격 시, 5초 동안 공격력이 20% 증가한다.(재사용 대기 시간: 3초)',
            '환영+': '공격력이 18% 증가한다.지속 피해: 정신을 보유한 적 공격 시, 약화 효과: 방어구 파괴를 부여해 10초 동안 받는 피해를 10% 증가시킨다.(재사용 대기 시간: 3초)방어구 파괴는 중복 적용되지 않는다.',
            '황금 들판': '체력이 75% 이상일 경우, 공격력이 20% 증가한다.',
            '모래 폭풍': '스킬 사용 속도 및 공격 속도가 10% 증가한다.무방비 공격 적중 시, 10초 동안 스킬 사용 속도 및 공격 속도가 24% 추가로 증가한다.',
            '황폐+': '보유한 자원이 50% 미만일 경우, 적에게 주는 피해가 12%, 추가타 확률이 7% 증가한다.',
            '신성한 칙령': '아군의 체력을 회복시키면 5초 동안 공격력이 15% 증가하며 회복량이 9% 증가한다.',
            '준비된 자': '퀵슬롯 아이템을 사용했을 경우 15초 동안 적에게 주는 피해가 20% 증가한다. 퀵슬롯의 포션 개수가 2개 증가하며, 붕대 개수가 2개 증가한다.',
            '저무는 달': '누적: 공격력과 방어력이 6% 증가한다. 전투 시작 시, 전투 종료까지 30초마다 공격력과 방어력이 추가로 2%씩 증가하며, 해당 효과는 최대 10회까지 중첩된다.',
            '땅울림': '공격력이 8% 증가한다. 전투 시작 시, 공격력이 30% 증가한다. 증가한 공격력은 매 3초마다 2%씩 감소한다.',
            '신전 기사': '공격력이 23% 증가한다.결함: 치명타 확률이 8% 감소한다.',
            '근위병+': '공격력이 23% 증가한다.결함: 재사용 대기 시간 회복 속도가 7% 감소한다.',
            '침묵하는 산': '5초 동안 이동하지 않을 경우, 공격력이 22% 증가한다.',
            '필사+': '공격력이 10% 증가한다. 체력이 50% 이하로 감소하면 20초 동안 공격력이 20% 추가로 증가한다.(재사용 대기 시간: 15초)',
            '파멸+': '궁극기 사용 시, 20초 동안 공격력이 25% 증가한다.',
            '집정관': '공격력이 23% 증가한다.결함: 스킬 사용 속도와 캐스팅 및 차지 속도가 8% 감소한다.',
            '새벽별': '누적: 스킬을 사용할 때마다 8초 동안 스킬 재사용 대기 시간 회복 속도가 3% 빨라진다.해당 효과는 최대 6회까지 중첩되며 지속 시간은 스택마다 개별로 가진다.',
            '눈 먼 예언자': '각성의 재사용 대기 시간이 38초 감소한다.',
            '압도적인 힘': '강타 피해가 6%, 공격력이 6%, 치명타 확률이 4% 증가한다. 엠블럼의 각성 효과가 활성화될 때, 20초간 이 룬으로 증가한 능력치가 두배가 된다.',
            '섬세한 손놀림': '연타 피해가 6%, 공격력이 6%, 추가타 확률이 4% 증가한다. 엠블럼의 각성 효과가 활성화될 때, 20초간 이 룬으로 증가한 능력치가 두배가 된다.',
            '성역+': '보호막 계열 효과가 유지되는 동안 공격력이 17% 증가한다. 포션을 사용하거나 30초가 지날 때마다 (공격력×13.9%)의 피해를 흡수하는 보호막이 생성된다.',
            '불안정한 힘': '전투 시작 시, 적에게 주는 피해가 22% 증가한다. 브레이크 당할 경우 효과가 사라지며, 30초 후에 재활성화된다.',
            '고대 수호자': '공격력이 23% 증가한다.결함: 이동 속도가 8% 감소한다.',
            '갈퀴발톱+': '브레이크 스킬로 주는 피해가 24% 증가한다.추가로 적에게 주는 브레이크 피해가 24% 증가하며, 무방비 피해가 24% 증가한다.',
            '태양': '3.5초마다 자신 주위 3m 범위 내의 적에게 (공격력×89%)의 피해를 준다.',
            '싹쓸바람': '공격 적중 시, 대상 주위 5m 범위 내의 적들을 중앙으로 3초간 끌어당기며 매 0.5초마다 (공격력×38%)의 피해를 준다.(재사용 대기 시간: 10초)',
            '혼돈': '자신의 공격에 적중당한 대상이 자신으로부터 지속 피해: 화상, 지속 피해: 빙결, 지속 피해: 감전, 지속 피해: 출혈, 지속 피해: 중독, 지속 피해: 암흑, 지속 피해: 정신, 지속 피해: 신성 효과를 받을 때마다 중첩을 쌓는다. 중첩이 3회 쌓일 경우, 중첩을 전부 소모하여 (공격력×102%)의 피해를 준다. 이 효과는 각 대상마다 4초에 한 번만 발동한다.',
            '붕괴하는 별': '자신의 공격이 적에게 적중 할 때마다 중첩을 쌓는다. 중첩이 3회 쌓일 경우, 중첩을 전부 소모하여 (공격력×30%)의 피해를 주고, 자신의 공격력을 10초 동안 10% 증가시킨다. 이 효과는 각 대상마다 3초에 한 번만 발동한다.',
            '돌격대장+': '적을 도발할 경우, 약화 효과: 방어구 파괴를 부여해 10초 동안 받는 피해를 10% 증가시키며, 자신의 공격력을 15초 동안 20% 증가시킨다.방어구 파괴는 중복 적용되지 않는다.',
            '지휘관': '강타, 연타, 무방비, 치명타, 추가타 공격 시, 8초 동안 공격력이 4.5% 증가하며, 해당 효과는 최대 5회까지 중첩된다. 각 공격력 증가 효과는 별도의 지속 시간을 가진다.',
            '응징+': '공격력이 12% 증가한다. 자신과 전투 중인 적이 처치되었을 경우, 자신의 체력을 (공격력×24.5%)만큼 회복한다.',
            '집념+': '캐스팅 및 차지 속도가 25%, 적에게 주는 피해가 10% 증가한다.',
            '분쇄+': '공격력이 6% 증가한다. 무방비 공격 적중 시, 10초 동안 적에게 주는 피해가 28% 증가한다.',
            '쌍둥이 별': '누적 효과가 발생할 때, 추가로 한 번 더 발생한다.캐스팅 및 차지 속도, 스킬 사용 속도가 7% 증가한다.',
            '푸른 거목': '축적: 스킬을 5회 사용 시, 전투 종료 시까지 스킬 피해량이 2.2% 증가한다. 이 효과는 최대 10회까지 중첩된다.',
            '어두운 징조': '누적: 궁극기 사용 시, 전투가 끝날 때까지 공격력이 0.6%, 치명타 확률이 0.6%, 적에게 주는 피해가 0.6% 증가한다. 이 효과는 최대 30회까지 중첩된다.',
            '요정 무리': '축적: 스킬을 7회 사용 시, 모든 스킬의 재사용 대기 시간이 2.1초 감소한다.(재사용 대기 시간: 3초)',
            '수정 꽃잎': '축적: 치명타 공격을 6회 적중시킬 경우, 다음 공격 적중 시 (공격력×45%)의 피해를 입히고, 자신의 공격력이 10초 동안 12% 증가한다.(재사용 대기 시간: 3초)',
            '나무 사슴': '축적: 추가타 공격을 6회 적중시킬 경우, 다음 공격 적중 시 (공격력×56%)의 피해를 입히고, 자신의 공격력이 10초 동안 12% 증가한다.(재사용 대기 시간: 4초)',
            '에메랄드 숲': '축적: 효과에 필요한 횟수를 누적시킬 때, 1회 추가로 누적시킨다.적에게 주는 피해가 10% 증가한다.',
            '불사': '적에게 주는 피해가 18% 증가한다. 행동 불능에 이르는 공격을 1회 막아주고 체력을 대량회복한다. 이 후 3초 동안 받는 피해가 80% 감소한다. 동일한 행동 불능에 저항하는 효과와 재사용 대기 시간을 공유한다.(재사용 대기 시간: 180초)',
            '싸움꾼': '자신 주변 6m 범위 내에 있는 적의 수가 많을수록, 적에게 입히는 피해가 최소 12%에서 최대 16%까지 증가한다. 적에게 받는 피해는 최소 8%에서 최대 12%까지 감소한다. 적이 3명일 때 최대 효과를 가진다.',
            '약탈자': '추가타 적중 시, 체력이 (공격력×2.4%) 회복된다.(재사용 대기 시간: 1초)추가타 확률이 10% 증가한다.',
            '원소 조화': '공격 적중 시, 전방 10m 범위 내의 적에게 3가지 속성의 투사체를 발사하여 각각 (공격력×42%)의 화염, 냉기, 번개 속성 피해를 입힌다.(재사용 대기 시간: 5초)',
            '다가오는 죽음': '적을 향해 느리게 날아가는 암흑 구체를 발사한다. 암흑 구체가 날아간 거리에 비례하여 최소 (공격력×117.5%) 피해를 입히고, 최대 18m 거리에서 (공격력×254%)의 피해를 입힌다.(재사용 대기 시간: 10초)',
            '잊힌 성소': '축적: 스킬 혹은 기본 공격을 60회 사용 시, 화염, 번개 혹은 얼음의 힘으로 스스로를 감싸 주위 2.5m 범위에 5초 동안 0.1초마다 1.5m 범위를 (공격력×15%)의 피해로 공격하는 원소 화살을 난사한다.',
            
            // 무기 신화
            '만 갈래 물길': '공격력이 15% 증가한다. 클래스 레벨 50을 달성할 때마다 추가로 공격력이 1%씩 증가하며 해당 효과는 최대 20회까지 중첩된다.(모든 클래스로 사용 가능하며, 캐릭터가 달성한 클래스 레벨 정보를 기준으로 효과 적용)',
            '흰 까마귀': '공격, 이동, 스킬 사용 속도, 캐스팅 및 차지 속도, 재사용 대기 시간 회복 속도가 10% 증가한다.장비를 +10 강화 시, 적에게 주는 피해가 7% 증가한다.장비를 +15 강화 시, 공격력 7%가 증가한다.',
            '메아리치는 진노': '연타 적중 시, 전방 넓은 범위의 적들에게 (공격력×110%)의 피해와 (공격력×35%)의 지속 피해: 빙결을 준다.강타 적중 시, 전방 넓은 범위의 적들에게 (공격력×110%)의 피해와 (공격력×35%)의 지속 피해: 화상을 준다.또한, 공격력이 5% 증가한다.장비를 +10, +15 강화 시 각각 공격력이 3% 추가로 증가한다.(재사용 대기 시간: 각 8초)',
            '무한': '기본 공격 사용 시, 모든 스킬의 재사용 대기 시간이 9% 감소한다.공격력이 20% 증가하며, 스킬 사용 시 5초 동안 공격 속도가 12% 증가한다.',
            
            // 방어구 신화
            '닫힌 운명': '공격 적중시, 결계를 생성하여 타겟과 그 주변에 (공격력×68%)의 피해를 입히고, 약화 효과: 방어구 파괴를 부여해 10초 동안 받는 피해를 10% 증가시킨다. 결계는 1, 2, 4겹으로 늘어나며 최대치까지 늘어난 이후에는 다시 1겹으로 돌아온다.(재사용 대기 시간: 5초)방어구 파괴는 중복 적용되지 않는다.',
            '검게 물든 후광': '받는 피해가 15%, 적에게 주는 피해가 15% 증가한다.아군을 회복시키거나 물약을 사용하면 15초 동안 받는 피해 증가 효과가 무효화된다.장비를 +10, +15 강화 시 각각 적에게 주는 피해가 6% 추가로 증가한다.',
            '그림자로 엮은 회랑': '전투 중 각각 2초, 3초, 4초마다 마력 사슬을 발사해 전방의 적들에게 (공격력×25%)의 피해를 준다.장비를 +15 강화 시, 5초마다 발사되는 마력 사슬이 추가된다.',
            '바스러지는 빛': '스킬을 사용할 때마다 8초 동안 공격력이 5.5% 증가한다. 해당 효과는 최대 5회까지 중첩되며 지속 시간은 스택마다 개별로 가진다.장비를 +15 강화 시, 50% 확률로 추가 중첩이 발생한다.',
            '세상을 삼키는 악의': '원소 지속 피해를 보유한 적에게 주는 피해가 16% 증가하고, 적에게 주는 무방비 피해가 16% 증가한다.장비를 +10, +15 강화 시 각각 적에게 주는 피해가 3% 추가로 증가한다.',
            '이름 없는 혼돈': '전투 중, 5초마다 5초 동안 공격력이 10%~30% 증가한다.장비를 +15 강화 시, 공격력 증가 최대치가 40%로 변경된다.',
            '영원': '모든 결함 효과를 제거한다.공격력이 10% 증가한다.',
            '쏟아지는 별': '전투 중 15초마다 자신 주위 15m 범위 내의 무작위 적을 섬광으로 타격하여 대상에게 (공격력×315%)의 피해를 입히고 대상 주위 2m 범위 내의 대상에게 (공격력×45%)의 피해를 입힌다.궁극기를 사용했을 경우, 자신 주위 15m 범위 내의 모든 적들을 섬광으로 타격한다.',
            
            // 앰블럼 전설
            '무자비한 포식자': '무방비 공격 시 각성하여 20초 동안 적에게 주는 스킬 피해가 55% 증가하며, 모든 스킬의 재사용 대기 시간이 초기화 된다.(재사용 대기 시간: 90초)상시 효과: 적에게 주는 피해가 21% 증가한다.',
            '순수한 힘': '궁극기 사용 시, 30초 동안 적에게 주는 피해가 27% 증가한다.궁극기 게이지 획득량이 20% 증가한다.',
            '부서진 하늘': '공격 시 50% 확률로 각성하여 20초 동안 연타 피해가 60% 증가한다. 또한, 지속 시간 동안 공격 적중 시 (공격력×29%)의 추가 피해를 입히며 이 효과는 0.5초마다 한 번만 적용된다.(재사용 대기 시간: 90초)상시 효과: 연타 피해가 8%, 재사용 대기 시간 회복 속도가 8% 증가한다.',
            '인도하는 빛': '궁극기 사용 시, 자신과 주위 15m 내의 아군에게 15초 동안 8%의 공격력 증가 효과를 부여한다.아군 회복 시, 15초 동안 자신의 공격력이 20% 증가한다.',
            '대마법사': '공격 시 50% 확률로 각성하여 20초 동안 공격력이 45%, 스킬 캐스팅 및 사용 속도가 25% 증가한다.(재사용 대기 시간: 90초)상시 효과: 스킬 사용 속도, 캐스팅 및 차지 속도가 14%, 차지 스킬의 피해량이 14% 증가한다.',
            '흩날리는 검': '공격 시 50% 확률로 각성하여 35초 동안 공격력이 35%, 기본 공격 속도가 20%, 기본 공격의 추가타 확률이 20% 증가한다.(재사용 대기 시간: 90초)상시 효과: 기본 공격 속도가 24%, 기본 공격 추가타 확률이 24% 증가한다.',
            '산맥 군주': '공격 시 50% 확률로 각성하여 20초 동안 강타 피해가 60% 증가한다. 또한 지속 시간 동안 공격 적중 시 (공격력×155%)의 추가 피해를 입히며 이 효과는 3초마다 한 번만 적용된다.(재사용 대기 시간: 90초)상시 효과: 강타 피해가 8%, 스킬 사용 속도가 8% 증가한다.',
            '아득한 빛': '공격 시 50% 확률로 각성하여 20초 동안 치명타 확률이 20%, 치명타 피해량이 50% 증가한다.(재사용 대기 시간: 90초)상시 효과: 치명타 확률이 5%, 치명타 피해량이 10%, 적에게 주는 피해가 5% 증가한다.',
            '갈라진 땅': '공격 시 50% 확률로 각성하여 35초 동안 추가타 확률이 30% 증가하며, 추가타 적중 시 다음 공격은 선행 타격의 18% 만큼의 피해를 주는 추가 공격이 발생한다.(재사용 대기 시간: 90초)상시 효과: 추가타 확률이 12% 증가한다.',
            
            // 6성 전설
            '천자루의 검': '검을 사용하는 클래스로 클래스 레벨 40을 달성할 때마다 공격력이 4%씩 증가하며 해당 효과는 최대 6회까지 중첩된다.',
            '횃불': '지속 피해: 화상을 보유한 적 공격 시, 5초 동안 치명타 확률이 10% 증가한다.(재사용 대기 시간: 3초)',
            '마나 격류': '스킬을 사용할 때마다 5초 동안 공격력이 3.5% 증가하며, 해당 효과는 최대 4회까지 중첩된다.',
            '바위 거인': '강타 적중 시, 공격력이 3% 증가하며 해당 효과는 최대 3회까지 중첩된다.3중첩 도달 시, 중첩을 모두 소모하여 5초 동안 공격력이 20% 증가한다.',
            '평원 방랑자': '이동 스킬 사용시, 10초 동안 적에게 주는 피해가 12% 증가하고 이동속도가 30% 증가한다.',
            '파멸의 낙인': '공격 적중 시, 타겟에게 약화 효과: 파멸의 낙인을 부여해 1초마다 (공격력×9%)의 암흑 피해를 8초 동안 준다.파멸의 낙인은 하나의 대상에게만 부여된다.파멸의 낙인이 만료 될 때마다 다음 파멸의 낙인의 피해량이 10% 증가하며, 해당 효과는 최대 10회까지 증첩된다.공명의 수정의 각인을 보유한 경우, 초기 중첩 5회가 부여된다.',
            '공명하는 수정': '전투 중 1초마다 강화 효과: 공명을 얻어 적에게 주는 피해가 2% 증가한다.해당 효과는 최대 12회 까지 중첩되며, 12회 중첩될 경우 중첩을 모두 잃을 때까지 중첩 수가 점점 감소한다.약화 효과: 파멸의 낙인을 보유한 적이 있을 경우 중첩 당 피해가 0.6% 추가 증가한다.',
            '현란함': '치명타 확률이 10% 증가하며, 적에게 주는 치명타 피해가 30% 증가한다.'
        };
        
        // Set 폴백 (구형 브라우저 지원)
        function createSet() {
            if (typeof Set !== 'undefined') {
                return new Set();
            } else {
                // Set이 지원되지 않는 경우 배열로 대체
                var arr = [];
                arr.has = function(value) { return this.indexOf(value) !== -1; };
                arr.add = function(value) { if (!this.has(value)) this.push(value); };
                arr.delete = function(value) { var index = this.indexOf(value); if (index !== -1) this.splice(index, 1); };
                arr.clear = function() { this.length = 0; };
                Object.defineProperty(arr, 'size', { get: function() { return this.length; } });
                return arr;
            }
        }

        var activeFilters = { type: createSet(), grade: createSet(), keyword: createSet(), feature: createSet() };
        var sortState = { columnIndex: 0, direction: 'asc', dataType: 'str' };

        // 디버깅용 환경 정보 출력
        function logEnvironmentInfo() {
            console.log('=== 환경 정보 ===');
            console.log('User Agent:', navigator.userAgent);
            console.log('화면 크기:', window.innerWidth, 'x', window.innerHeight);
            console.log('Document Ready State:', document.readyState);
            console.log('JavaScript 지원:', typeof Array.from !== 'undefined');
            console.log('CSS Grid 지원:', typeof CSS !== 'undefined' && CSS.supports('display', 'grid'));
        }

        var isInitialized = false;  // 전역 스코프로 이동

        // 초성 추출 함수
        function getInitialConsonant(str) {
            const initialConsonants = ['ㄱ', 'ㄲ', 'ㄴ', 'ㄷ', 'ㄸ', 'ㄹ', 'ㅁ', 'ㅂ', 'ㅃ', 'ㅅ', 'ㅆ', 'ㅇ', 'ㅈ', 'ㅉ', 'ㅊ', 'ㅋ', 'ㅌ', 'ㅍ', 'ㅎ'];
            let result = '';
            for (let i = 0; i < str.length; i++) {
                const code = str.charCodeAt(i);
                if (code >= 0xAC00 && code <= 0xD7A3) {
                    const initialCode = Math.floor((code - 0xAC00) / 28 / 21);
                    result += initialConsonants[initialCode];
                } else {
                    result += str[i];
                }
            }
            return result;
        }

        // 자동완성 기능 추가
        function setupAutocomplete() {
            const searchInput = document.getElementById('name-search');
            const container = document.createElement('div');
            container.className = 'autocomplete-container';
            searchInput.parentNode.insertBefore(container, searchInput);
            container.appendChild(searchInput);
            
            const dropDown = document.createElement('div');
            dropDown.className = 'autocomplete-items';
            dropDown.style.display = 'none';
            container.appendChild(dropDown);

            searchInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const initialValue = getInitialConsonant(value);
                dropDown.innerHTML = '';
                
                if (!value) {
                    dropDown.style.display = 'none';
                    return;
                }

                const matches = runeData.filter(rune => {
                    const name = rune.name.toLowerCase();
                    const initial = getInitialConsonant(name);
                    return name.includes(value) || initial.includes(initialValue);
                }).slice(0, 5); // 최대 5개까지만 표시

                if (matches.length > 0) {
                    dropDown.style.display = 'block';
                    matches.forEach(rune => {
                        const div = document.createElement('div');
                        div.textContent = rune.name;
                        div.addEventListener('click', function() {
                            searchInput.value = rune.name;
                            dropDown.style.display = 'none';
                            applyFilters();
                        });
                        dropDown.appendChild(div);
                    });
                } else {
                    dropDown.style.display = 'none';
                }
            });

            // 클릭 이벤트로 드롭다운 닫기
            document.addEventListener('click', function(e) {
                if (!container.contains(e.target)) {
                    dropDown.style.display = 'none';
                }
            });
        }

        // 더 안전한 초기화
        function initializePage() {
            try {
                if (isInitialized) {
                    console.log('이미 초기화되어 있음, 중복 초기화 방지');
                    return;
                }
                isInitialized = true;
                
                logEnvironmentInfo();
                console.log('페이지 초기화 시작');
                
                // 기본 데이터 확인
                console.log('runeData 길이:', runeData.length);
                console.log('keywordCategories 키 개수:', Object.keys(keywordCategories).length);
                console.log('featureCategories 길이:', featureCategories.length);
                
                generateTable();
                console.log('테이블 생성 완료');
                
                generateFilterButtons();
                console.log('필터 버튼 생성 완료');
                
                sortTable(0, 'str'); // Default sort by name
                console.log('정렬 완료');

                setupAutocomplete();
                console.log('자동완성 설정 완료');
                
                console.log('페이지 초기화 완료');
            } catch (error) {
                console.error('페이지 초기화 오류:', error);
                console.error('오류 스택:', error.stack);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (!isInitialized) {
                initializePage();
            }
        });

        window.addEventListener('load', function() {
            if (!isInitialized) {
                setTimeout(initializePage, 100);
            }
        });


        function generateTable() {
            try {
                console.log('테이블 생성 시작');
                
                const tbody = document.querySelector('tbody');
                if (!tbody) {
                    console.error('tbody를 찾을 수 없습니다');
                    return;
                }
                
                tbody.innerHTML = '';
                
                for (var runeIndex = 0; runeIndex < runeData.length; runeIndex++) {
                    var rune = runeData[runeIndex];
                    var mainRow = document.createElement('tr');
                    mainRow.setAttribute('data-rune-name', rune.name);
                    var description = allDescriptions[rune.name] || '설명 없음';

                    // 체크박스 셀 추가
                    var checkboxCell = document.createElement('td');
                    var checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'rune-checkbox';
                    checkbox.setAttribute('data-rune-type', rune.type);
                    checkbox.setAttribute('data-rune-name', rune.name);
                    checkbox.onclick = handleRuneSelection;
                    checkboxCell.appendChild(checkbox);
                    mainRow.appendChild(checkboxCell);

                    // 이름 셀
                    var nameCell = document.createElement('td');
                    nameCell.textContent = rune.name;

                    // 룬 등급에 따라 배경색과 글씨색 적용
                    if (rune.grade === '신화') {
                        nameCell.style.backgroundColor = 'rgba(213, 166, 0, 0.7)';
                        nameCell.style.color = 'black';
                        nameCell.style.fontWeight = 'bold';
                    } else if (rune.grade === '전설') {
                        nameCell.style.backgroundColor = 'rgba(181, 73, 15, 0.7)';
                        nameCell.style.color = 'white';
                        nameCell.style.fontWeight = 'bold';
                    } else if (rune.grade === '6성 전설') {
                        nameCell.style.backgroundColor = 'rgba(138, 43, 226, 0.7)';
                        nameCell.style.color = 'white';
                        nameCell.style.fontWeight = 'bold';
                    }
                    mainRow.appendChild(nameCell);

                    // 키워드 셀
                    var keywordCell = document.createElement('td');
                    keywordCell.textContent = rune.keyword;
                    mainRow.appendChild(keywordCell);

                    // 설명 셀
                    var descCell = document.createElement('td');
                    // 마침표마다 줄바꿈 추가
                    var formattedDescription = description
                        .replace(/\)\./g, ').\n')
                        .replace(/다\./g, '다.\n')
                        .replace(/\n\n+/g, '\n');
                    
                    // 줄바꿈을 <br>로 먼저 변환
                    formattedDescription = formattedDescription.replace(/\n/g, '<br>');
                    
                    // 결함이 있는 룬들의 설명을 하드코딩으로 처리
                    if (rune.name === '투사+') {
                        formattedDescription = '적에게 주는 피해가 <span style="color: #22c55e; font-weight: bold;">33%</span> 증가한다.<br>결함: 멀티히트 피해가 <span style="color: #ef4444; font-weight: bold;">10%</span> 감소한다.';
                    } else if (rune.name === '은둔자+') {
                        formattedDescription = '공격력이 <span style="color: #22c55e; font-weight: bold;">33%</span> 증가한다.<br>결함: 재사용 대기 시간 회복 속도가 <span style="color: #ef4444; font-weight: bold;">9%</span> 감소한다.';
                    } else if (rune.name === '옛 마법사') {
                        formattedDescription = '재사용 대기 시간 회복 속도가 <span style="color: #22c55e; font-weight: bold;">29%</span> 증가한다.<br>결함: 적에게 주는 피해가 <span style="color: #ef4444; font-weight: bold;">10%</span> 감소한다.';
                    } else if (rune.name === '신전 기사') {
                        formattedDescription = '공격력이 <span style="color: #22c55e; font-weight: bold;">23%</span> 증가한다.<br>결함: 치명타 확률이 <span style="color: #ef4444; font-weight: bold;">8%</span> 감소한다.';
                    } else if (rune.name === '근위병+') {
                        formattedDescription = '공격력이 <span style="color: #22c55e; font-weight: bold;">23%</span> 증가한다.<br>결함: 재사용 대기 시간 회복 속도가 <span style="color: #ef4444; font-weight: bold;">7%</span> 감소한다.';
                    } else if (rune.name === '집정관') {
                        formattedDescription = '공격력이 <span style="color: #22c55e; font-weight: bold;">23%</span> 증가한다.<br>결함: 스킬 사용 속도와 캐스팅 및 차지 속도가 <span style="color: #ef4444; font-weight: bold;">8%</span> 감소한다.';
                    } else if (rune.name === '고대 수호자') {
                        formattedDescription = '공격력이 <span style="color: #22c55e; font-weight: bold;">23%</span> 증가한다.<br>결함: 이동 속도가 <span style="color: #ef4444; font-weight: bold;">8%</span> 감소한다.';
                    } else {
                        // 결함이 없는 룬들은 일반 처리
                        // (공격력×숫자%) 형태를 초록색으로 표시
                        formattedDescription = formattedDescription
                            .replace(/(\(공격력×\d+(?:\.\d+)?%\))/g, '<span style="color: #22c55e; font-weight: bold;">$1</span>');
                        
                        // 괄호 안의 내용을 초록색으로 표시 (이미 처리된 것 제외)
                        formattedDescription = formattedDescription
                            .replace(/(\([^)<]+\))/g, function(match) {
                                if (match.includes('span')) return match;
                                return '<span style="color: #22c55e; font-weight: bold;">' + match + '</span>';
                            });
                        
                        // 나머지 숫자%를 초록색으로 표시 (이미 처리된 것 제외)
                        formattedDescription = formattedDescription
                            .replace(/(\d+(?:\.\d+)?%)/g, function(match) {
                                return '<span style="color: #22c55e; font-weight: bold;">' + match + '</span>';
                            });
                    }
                    
                    descCell.innerHTML = formattedDescription;
                    mainRow.appendChild(descCell);
                    
                    tbody.appendChild(mainRow);
                }
                
                console.log('테이블 생성 완료. 총 룬 개수:', runeData.length);
                
            } catch (error) {
                console.error('테이블 생성 오류:', error);
            }
        }

        // 룬 선택 처리
        var selectedRunes = {
            무기: [],
            방어구: [],
            앰블럼: []
        };

        const maxSelections = {
            무기: 1,
            방어구: 5,
            앰블럼: 1
        };

        function handleRuneSelection(event) {
            const checkbox = event.target;
            const type = checkbox.getAttribute('data-rune-type');
            const name = checkbox.getAttribute('data-rune-name');

            if (checkbox.checked) {
                // 최대 선택 개수 체크
                if (selectedRunes[type].length >= maxSelections[type]) {
                    checkbox.checked = false;
                    alert(`${type} 룬은 최대 ${maxSelections[type]}개까지만 선택할 수 있습니다.`);
                    return;
                }
                selectedRunes[type].push(name);
            } else {
                selectedRunes[type] = selectedRunes[type].filter(n => n !== name);
            }

            updateSelectedCounts();
            updateCheckboxStates();
            calculateEffects();
        }

        function updateSelectedCounts() {
            const weaponCount = selectedRunes['무기'].length;
            const armorCount = selectedRunes['방어구'].length;
            const emblemCount = selectedRunes['앰블럼'].length;
            
            const weaponSpan = document.getElementById('weapon-count');
            const armorSpan = document.getElementById('armor-count');
            const emblemSpan = document.getElementById('emblem-count');
            
            // 무기 카운트 업데이트 (1개 완료 시 초록색)
            weaponSpan.textContent = weaponCount;
            if (weaponCount >= maxSelections['무기']) {
                weaponSpan.classList.add('completed');
            } else {
                weaponSpan.classList.remove('completed');
            }
            
            // 방어구 카운트 업데이트 (5개 완료 시 초록색)
            armorSpan.textContent = armorCount;
            if (armorCount >= maxSelections['방어구']) {
                armorSpan.classList.add('completed');
            } else {
                armorSpan.classList.remove('completed');
            }
            
            // 앰블럼 카운트 업데이트 (1개 완료 시 초록색)
            emblemSpan.textContent = emblemCount;
            if (emblemCount >= maxSelections['앰블럼']) {
                emblemSpan.classList.add('completed');
            } else {
                emblemSpan.classList.remove('completed');
            }
        }

        function updateCheckboxStates() {
            const checkboxes = document.querySelectorAll('.rune-checkbox');
            checkboxes.forEach(checkbox => {
                const type = checkbox.getAttribute('data-rune-type');
                if (!checkbox.checked && selectedRunes[type].length >= maxSelections[type]) {
                    checkbox.disabled = true;
                } else {
                    checkbox.disabled = false;
                }
            });
        }

        function calculateEffects() {
            const effectSums = {};
            const effectSources = {};
            const specialEffectSums = {}; // 특수 계산된 효과들
            
            // 세트 효과 체크
            const has눈먼예언자 = selectedRunes['방어구'].includes('눈 먼 예언자');
            const has쌍둥이별 = selectedRunes['방어구'].includes('쌍둥이 별');
            const has에메랄드숲 = selectedRunes['방어구'].includes('에메랄드 숲');
            const has파멸의낙인 = selectedRunes['방어구'].includes('파멸의 낙인');
            const has공명하는수정 = selectedRunes['방어구'].includes('공명하는 수정');
            const has영원 = selectedRunes['방어구'].includes('영원');
            
            // 세트 효과 반영하여 특수 평균값 계산
            const runeSpecialAverages = calculate150sAverage(has쌍둥이별, has에메랄드숲, has파멸의낙인, has공명하는수정);
            
            // 각성 앰블럼 룬이 선택되었는지 확인
            const 각성앰블럼룬들 = ['무자비한 포식자', '부서진 하늘', '대마법사', '흩날리는 검', '산맥 군주', '아득한 빛', '갈라진 땅'];
            const selected각성앰블럼 = selectedRunes['앰블럼'].find(name => 각성앰블럼룬들.includes(name));
            
            // 각성 룬별 지속시간 (초)
            const 각성지속시간 = {
                '무자비한 포식자': 20,
                '부서진 하늘': 20,
                '대마법사': 20,
                '흩날리는 검': 35,
                '산맥 군주': 20,
                '아득한 빛': 20,
                '갈라진 땅': 35
            };
            
            // 각성 룬의 룬 피해 재사용대기시간 (X초마다)
            const 각성룬피해쿨타임 = {
                '부서진 하늘': 0.5,  // 0.5초마다
                '산맥 군주': 3        // 3초마다
            };
            
            // 각성 가동 시간 계산 함수 (150초 시뮬레이션)
            // 반환값: 150초 동안의 평균 가동 시간(초)
            // 로직: 각성 발동과 동시에 재사용 대기 시간 시작 (지속시간과 재사용대기 겹침)
            function calculate각성가동시간(지속시간초, 재사용대기초, has눈먼예언자) {
                // 눈먼예언자: 재사용 대기 시간 38초 감소
                const 실제재사용 = has눈먼예언자 ? Math.max(1, 재사용대기초 - 38) : 재사용대기초;
                
                // 한 사이클 = 재사용대기 (지속시간은 재사용대기 안에 포함됨)
                const 사이클시간 = 실제재사용;
                
                // 150초 동안 발동 가능 횟수 (0초에 시작 포함)
                const 발동횟수 = Math.floor(150 / 사이클시간) + 1;
                
                // 각 발동의 실제 가동 시간 계산
                let 총가동시간 = 0;
                for (let i = 0; i < 발동횟수; i++) {
                    const 발동시각 = i * 사이클시간;
                    if (발동시각 >= 150) break;
                    
                    // 이번 발동의 가동 시간 (150초를 넘지 않도록)
                    const 이번가동 = Math.min(지속시간초, 150 - 발동시각);
                    총가동시간 += 이번가동;
                }
                
                return 총가동시간;
            }
            
            // 가동률 계산 (0~1 사이 값)
            function calculate각성가동률(지속시간초, 재사용대기초, has눈먼예언자) {
                return calculate각성가동시간(지속시간초, 재사용대기초, has눈먼예언자) / 150;
            }
            
            // 선택된 모든 룬의 효과 수집
            Object.keys(selectedRunes).forEach(type => {
                selectedRunes[type].forEach(runeName => {
                    const rune = runeData.find(r => r.name === runeName);
                    if (!rune) return;

                    // 특수 계산이 필요한 룬들의 키워드별 처리
                    const effData = runeEfficiencyData[runeName];
                    if (effData && effData.keywords) {
                        effData.keywords.forEach((keyword, index) => {
                            let efficiency = effData.efficiencies[index] || 0;
                            let displaySuffix = '';
                            
                            // 각성 룬 가동률 배율 계산
                            if (rune.keyword === '각성') {
                                const count = effData.counts[index];
                                const 원본값 = effData.values[index];
                                
                                if (rune.type === '앰블럼' && 각성지속시간[runeName]) {
                                    // 앰블럼 각성 룬인 경우
                                    // counts가 150이 아닌 경우만 각성 효과 (원본값으로 재계산)
                                    if (count !== 150) {
                                        const 가동률 = calculate각성가동률(각성지속시간[runeName], 90, has눈먼예언자);
                                        efficiency = 원본값 * 가동률;
                                        if (has눈먼예언자) {
                                displaySuffix = ' (각성+)';
                                        }
                                    }
                                } else if (rune.type === '방어구') {
                                    // 방어구 각성 룬인 경우 (압도적인 힘, 섬세한 손놀림)
                                    if (count === 150) {
                                        // 기본 옵션은 항상 적용 (efficiency 그대로)
                                        // 앰블럼 각성이 선택되었을 때만 추가 효과
                                        if (selected각성앰블럼) {
                                            const 앰블럼가동률 = calculate각성가동률(각성지속시간[selected각성앰블럼], 90, has눈먼예언자);
                                            // 기본값 + (기본값 × 앰블럼 각성 가동률)
                                            efficiency = efficiency + (원본값 * 앰블럼가동률);
                                            if (has눈먼예언자) {
                                                displaySuffix = ' (각성+)';
                                            }
                                        }
                                    } else if (count === 33) {
                                        // counts=33은 중복 데이터이므로 무시
                                        efficiency = 0;
                                    }
                                }
                            }
                            
                            // 특수 계산 룬인 경우 - 키워드별로 정확히 매칭
                            if (runeName === '검무+' && keyword === '공격력') {
                                const adjustedValue = runeSpecialAverages['검무+_공격력'];
                                if (!specialEffectSums['공격력 증가']) specialEffectSums['공격력 증가'] = 0;
                                specialEffectSums['공격력 증가'] += adjustedValue;
                                if (!effectSources['공격력 증가']) effectSources['공격력 증가'] = [];
                                effectSources['공격력 증가'].push({ name: runeName + (has쌍둥이별 ? ' (누적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            } else if (runeName === '검무+' && keyword === '치명타 확률') {
                                const adjustedValue = runeSpecialAverages['검무+_치명타확률'];
                                if (!specialEffectSums['치명타 확률 증가']) specialEffectSums['치명타 확률 증가'] = 0;
                                specialEffectSums['치명타 확률 증가'] += adjustedValue;
                                if (!effectSources['치명타 확률 증가']) effectSources['치명타 확률 증가'] = [];
                                effectSources['치명타 확률 증가'].push({ name: runeName + (has쌍둥이별 ? ' (누적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            } else if (runeName === '공명하는 수정' && keyword === '주는 피해') {
                                if (!specialEffectSums['적에게 주는 피해 증가']) specialEffectSums['적에게 주는 피해 증가'] = 0;
                                specialEffectSums['적에게 주는 피해 증가'] += runeSpecialAverages['공명하는 수정'];
                                if (!effectSources['적에게 주는 피해 증가']) effectSources['적에게 주는 피해 증가'] = [];
                                const 시너지표시 = has파멸의낙인 ? ' (시너지: 파멸의 낙인)' : '';
                                effectSources['적에게 주는 피해 증가'].push({ name: runeName + 시너지표시, value: runeSpecialAverages['공명하는 수정'].toFixed(1) + '%', isSpecial: true });
                            } else if (runeName === '황혼' && keyword === '주는 피해') {
                                const adjustedValue = runeSpecialAverages['황혼'];
                                if (!specialEffectSums['적에게 주는 피해 증가']) specialEffectSums['적에게 주는 피해 증가'] = 0;
                                specialEffectSums['적에게 주는 피해 증가'] += adjustedValue;
                                if (!effectSources['적에게 주는 피해 증가']) effectSources['적에게 주는 피해 증가'] = [];
                                effectSources['적에게 주는 피해 증가'].push({ name: runeName + (has쌍둥이별 ? ' (누적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            } else if (runeName === '파멸의 낙인' && keyword === '룬 피해') {
                                if (!specialEffectSums['룬 피해']) specialEffectSums['룬 피해'] = 0;
                                specialEffectSums['룬 피해'] += runeSpecialAverages['파멸의 낙인'];
                                if (!effectSources['룬 피해']) effectSources['룬 피해'] = [];
                                const 시너지표시 = has공명하는수정 ? ' (시너지: 공명하는 수정)' : '';
                                effectSources['룬 피해'].push({ name: runeName + 시너지표시, value: runeSpecialAverages['파멸의 낙인'].toFixed(1) + '%', isSpecial: true });
                            } 
                            // 각성 룬 피해 (X초마다 발동) - 산맥 군주, 부서진 하늘
                            else if ((runeName === '산맥 군주' || runeName === '부서진 하늘') && keyword === '룬 피해') {
                                // 룬 피해 DPS = 원본값 / X초 × 각성가동률
                                const 지속시간 = 각성지속시간[runeName];
                                const 가동률 = calculate각성가동률(지속시간, 90, has눈먼예언자);
                                const X초 = 각성룬피해쿨타임[runeName];
                                const 원본값 = effData.values[index]; // 155% (산맥 군주) 또는 29% (부서진 하늘)
                                
                                // DPS 계산: (원본값 / X초) × 가동률
                                const DPS = (원본값 / X초) * 가동률;
                                
                                if (!specialEffectSums['룬 피해']) specialEffectSums['룬 피해'] = 0;
                                specialEffectSums['룬 피해'] += DPS;
                                if (!effectSources['룬 피해']) effectSources['룬 피해'] = [];
                                
                                const displayName = has눈먼예언자 ? runeName + ' (각성+)' : runeName;
                                    effectSources['룬 피해'].push({ 
                                    name: displayName, 
                                    value: DPS.toFixed(1) + '%', 
                                        isSpecial: true 
                                    });
                            }
                            // 여명+ - 공격력 (누적+ 효과)
                            else if (runeName === '여명+' && keyword === '공격력') {
                                const adjustedValue = runeSpecialAverages['여명+'];
                                if (!specialEffectSums['공격력 증가']) specialEffectSums['공격력 증가'] = 0;
                                specialEffectSums['공격력 증가'] += adjustedValue;
                                if (!effectSources['공격력 증가']) effectSources['공격력 증가'] = [];
                                effectSources['공격력 증가'].push({ name: runeName + (has쌍둥이별 ? ' (누적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            } 
                            // 저무는 달 - 공격력/방어력 (기본 + 누적 평균)
                            else if (runeName === '저무는 달' && (keyword === '공격력' || keyword === '방어력')) {
                                const adjustedValue = runeSpecialAverages['저무는달_총합'];
                                const effectName = keyword + ' 증가';
                                if (!specialEffectSums[effectName]) specialEffectSums[effectName] = 0;
                                specialEffectSums[effectName] += adjustedValue;
                                if (!effectSources[effectName]) effectSources[effectName] = [];
                                effectSources[effectName].push({ name: runeName + (has쌍둥이별 ? ' (누적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 바스러지는 빛, 땅울림, 마나 격류, 바위 거인 - 공격력
                            else if (['바스러지는 빛', '땅울림', '마나 격류', '바위 거인'].includes(runeName) && keyword === '공격력') {
                                if (!specialEffectSums['공격력 증가']) specialEffectSums['공격력 증가'] = 0;
                                specialEffectSums['공격력 증가'] += runeSpecialAverages[runeName];
                                if (!effectSources['공격력 증가']) effectSources['공격력 증가'] = [];
                                effectSources['공격력 증가'].push({ name: runeName, value: runeSpecialAverages[runeName].toFixed(1) + '%', isSpecial: true });
                            } 
                            // 푸른 거목 - 스킬 피해 (축적+ 효과)
                            else if (runeName === '푸른 거목' && keyword === '스킬 피해') {
                                const adjustedValue = runeSpecialAverages['푸른 거목'];
                                if (!specialEffectSums['스킬 피해량 증가']) specialEffectSums['스킬 피해량 증가'] = 0;
                                specialEffectSums['스킬 피해량 증가'] += adjustedValue;
                                if (!effectSources['스킬 피해량 증가']) effectSources['스킬 피해량 증가'] = [];
                                effectSources['스킬 피해량 증가'].push({ name: runeName + (has에메랄드숲 ? ' (축적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 새벽별 - 쿨타임 (누적+ 효과)
                            else if (runeName === '새벽별' && keyword === '쿨타임') {
                                const adjustedValue = runeSpecialAverages['새벽별'];
                                if (!specialEffectSums['재사용 대기 시간 회복 속도 증가']) specialEffectSums['재사용 대기 시간 회복 속도 증가'] = 0;
                                specialEffectSums['재사용 대기 시간 회복 속도 증가'] += adjustedValue;
                                if (!effectSources['재사용 대기 시간 회복 속도 증가']) effectSources['재사용 대기 시간 회복 속도 증가'] = [];
                                effectSources['재사용 대기 시간 회복 속도 증가'].push({ name: runeName + (has쌍둥이별 ? ' (누적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 바위 감시자 - 공격력 (축적+ 효과)
                            else if (runeName === '바위 감시자' && keyword === '공격력') {
                                const adjustedValue = runeSpecialAverages['바위 감시자'];
                                if (!specialEffectSums['공격력 증가']) specialEffectSums['공격력 증가'] = 0;
                                specialEffectSums['공격력 증가'] += adjustedValue;
                                if (!effectSources['공격력 증가']) effectSources['공격력 증가'] = [];
                                effectSources['공격력 증가'].push({ name: runeName + (has에메랄드숲 ? ' (축적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 요정 무리 - 쿨타임 (축적+ 효과)
                            else if (runeName === '요정 무리' && keyword === '쿨타임') {
                                const adjustedValue = runeSpecialAverages['요정 무리'];
                                if (!specialEffectSums['재사용 대기 시간 회복 속도 증가']) specialEffectSums['재사용 대기 시간 회복 속도 증가'] = 0;
                                specialEffectSums['재사용 대기 시간 회복 속도 증가'] += adjustedValue;
                                if (!effectSources['재사용 대기 시간 회복 속도 증가']) effectSources['재사용 대기 시간 회복 속도 증가'] = [];
                                effectSources['재사용 대기 시간 회복 속도 증가'].push({ name: runeName + (has에메랄드숲 ? ' (축적+)' : ''), value: adjustedValue.toFixed(1) + '초', isSpecial: true });
                            }
                            // 수정 꽃잎 - 룬피해 + 공격력 (축적+ 효과)
                            else if (runeName === '수정 꽃잎' && keyword === '룬 피해') {
                                const adjustedValue = runeSpecialAverages['수정꽃잎_룬피해'];
                                if (!specialEffectSums['룬 피해']) specialEffectSums['룬 피해'] = 0;
                                specialEffectSums['룬 피해'] += adjustedValue;
                                if (!effectSources['룬 피해']) effectSources['룬 피해'] = [];
                                effectSources['룬 피해'].push({ name: runeName + (has에메랄드숲 ? ' (축적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            else if (runeName === '수정 꽃잎' && keyword === '공격력') {
                                const adjustedValue = runeSpecialAverages['수정꽃잎_공격력'];
                                if (!specialEffectSums['공격력 증가']) specialEffectSums['공격력 증가'] = 0;
                                specialEffectSums['공격력 증가'] += adjustedValue;
                                if (!effectSources['공격력 증가']) effectSources['공격력 증가'] = [];
                                effectSources['공격력 증가'].push({ name: runeName + (has에메랄드숲 ? ' (축적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 나무 사슴 - 룬피해 + 공격력 (축적+ 효과)
                            else if (runeName === '나무 사슴' && keyword === '룬 피해') {
                                const adjustedValue = runeSpecialAverages['나무사슴_룬피해'];
                                if (!specialEffectSums['룬 피해']) specialEffectSums['룬 피해'] = 0;
                                specialEffectSums['룬 피해'] += adjustedValue;
                                if (!effectSources['룬 피해']) effectSources['룬 피해'] = [];
                                effectSources['룬 피해'].push({ name: runeName + (has에메랄드숲 ? ' (축적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            else if (runeName === '나무 사슴' && keyword === '공격력') {
                                const adjustedValue = runeSpecialAverages['나무사슴_공격력'];
                                if (!specialEffectSums['공격력 증가']) specialEffectSums['공격력 증가'] = 0;
                                specialEffectSums['공격력 증가'] += adjustedValue;
                                if (!effectSources['공격력 증가']) effectSources['공격력 증가'] = [];
                                effectSources['공격력 증가'].push({ name: runeName + (has에메랄드숲 ? ' (축적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 잊힌 성소 - 룬피해 (축적+ 효과)
                            else if (runeName === '잊힌 성소' && keyword === '룬 피해') {
                                const adjustedValue = runeSpecialAverages['잊힌 성소'];
                                if (!specialEffectSums['룬 피해']) specialEffectSums['룬 피해'] = 0;
                                specialEffectSums['룬 피해'] += adjustedValue;
                                if (!effectSources['룬 피해']) effectSources['룬 피해'] = [];
                                effectSources['룬 피해'].push({ name: runeName + (has에메랄드숲 ? ' (축적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 끝없는 순환 - 룬피해 + 룬회복 (축적+ 효과)
                            else if (runeName === '끝없는 순환' && keyword === '룬 피해') {
                                const adjustedValue = runeSpecialAverages['끝없는순환_공격'];
                                if (!specialEffectSums['룬 피해']) specialEffectSums['룬 피해'] = 0;
                                specialEffectSums['룬 피해'] += adjustedValue;
                                if (!effectSources['룬 피해']) effectSources['룬 피해'] = [];
                                effectSources['룬 피해'].push({ name: runeName + (has에메랄드숲 ? ' (축적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            else if (runeName === '끝없는 순환' && keyword === '룬 회복') {
                                const adjustedValue = runeSpecialAverages['끝없는순환_회복'];
                                if (!specialEffectSums['룬 회복']) specialEffectSums['룬 회복'] = 0;
                                specialEffectSums['룬 회복'] += adjustedValue;
                                if (!effectSources['룬 회복']) effectSources['룬 회복'] = [];
                                effectSources['룬 회복'].push({ name: runeName + (has에메랄드숲 ? ' (축적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 종언+ - 공격력 (누적 + 기본)
                            else if (runeName === '종언+' && keyword === '공격력') {
                                const 누적값 = runeSpecialAverages['종언+_누적'] || 0;
                                const 기본값 = runeSpecialAverages['종언+_기본'];
                                const adjustedValue = 누적값 + 기본값;
                                if (!specialEffectSums['공격력 증가']) specialEffectSums['공격력 증가'] = 0;
                                specialEffectSums['공격력 증가'] += adjustedValue;
                                if (!effectSources['공격력 증가']) effectSources['공격력 증가'] = [];
                                // 누적값이 0이어도 쌍둥이별 선택 시 표시 (실제 적용은 0)
                                effectSources['공격력 증가'].push({ name: runeName + (has쌍둥이별 && 누적값 > 0 ? ' (누적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 어두운 징조 - 공격력/치명타 확률/주는 피해 (누적)
                            else if (runeName === '어두운 징조' && keyword === '공격력') {
                                const adjustedValue = runeSpecialAverages['어두운징조_공격력'];
                                if (!specialEffectSums['공격력 증가']) specialEffectSums['공격력 증가'] = 0;
                                specialEffectSums['공격력 증가'] += adjustedValue;
                                if (!effectSources['공격력 증가']) effectSources['공격력 증가'] = [];
                                effectSources['공격력 증가'].push({ name: runeName + (has쌍둥이별 ? ' (누적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            else if (runeName === '어두운 징조' && keyword === '치명타 확률') {
                                const adjustedValue = runeSpecialAverages['어두운징조_치명타확률'];
                                if (!specialEffectSums['치명타 확률 증가']) specialEffectSums['치명타 확률 증가'] = 0;
                                specialEffectSums['치명타 확률 증가'] += adjustedValue;
                                if (!effectSources['치명타 확률 증가']) effectSources['치명타 확률 증가'] = [];
                                effectSources['치명타 확률 증가'].push({ name: runeName + (has쌍둥이별 ? ' (누적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            else if (runeName === '어두운 징조' && keyword === '주는 피해') {
                                const adjustedValue = runeSpecialAverages['어두운징조_주는피해'];
                                if (!specialEffectSums['적에게 주는 피해 증가']) specialEffectSums['적에게 주는 피해 증가'] = 0;
                                specialEffectSums['적에게 주는 피해 증가'] += adjustedValue;
                                if (!effectSources['적에게 주는 피해 증가']) effectSources['적에게 주는 피해 증가'] = [];
                                effectSources['적에게 주는 피해 증가'].push({ name: runeName + (has쌍둥이별 ? ' (누적+)' : ''), value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 필사+ - 기본 + 추가 공격력 (조건부)
                            else if (runeName === '필사+' && keyword === '공격력') {
                                const 기본값 = runeSpecialAverages['필사+_기본'];
                                const 추가값 = runeSpecialAverages['필사+_추가'];
                                const adjustedValue = 기본값 + 추가값;
                                if (!specialEffectSums['공격력 증가']) specialEffectSums['공격력 증가'] = 0;
                                specialEffectSums['공격력 증가'] += adjustedValue;
                                if (!effectSources['공격력 증가']) effectSources['공격력 증가'] = [];
                                effectSources['공격력 증가'].push({ name: runeName, value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 성역+ - 공격력 + 보호막 (조건부)
                            else if (runeName === '성역+' && keyword === '공격력') {
                                const adjustedValue = runeSpecialAverages['성역+_공격력'];
                                if (!specialEffectSums['공격력 증가']) specialEffectSums['공격력 증가'] = 0;
                                specialEffectSums['공격력 증가'] += adjustedValue;
                                if (!effectSources['공격력 증가']) effectSources['공격력 증가'] = [];
                                effectSources['공격력 증가'].push({ name: runeName, value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            else if (runeName === '성역+' && keyword === '보호막') {
                                const adjustedValue = runeSpecialAverages['성역+_보호막'];
                                if (!specialEffectSums['보호막']) specialEffectSums['보호막'] = 0;
                                specialEffectSums['보호막'] += adjustedValue;
                                if (!effectSources['보호막']) effectSources['보호막'] = [];
                                effectSources['보호막'].push({ name: runeName, value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 만 갈래 물길 - 공격력 (조건부)
                            else if (runeName === '만 갈래 물길' && keyword === '공격력') {
                                const 기본값 = runeSpecialAverages['만갈래물길_기본'];
                                const 추가값 = runeSpecialAverages['만갈래물길_추가'];
                                const adjustedValue = 기본값 + 추가값;
                                if (!specialEffectSums['공격력 증가']) specialEffectSums['공격력 증가'] = 0;
                                specialEffectSums['공격력 증가'] += adjustedValue;
                                if (!effectSources['공격력 증가']) effectSources['공격력 증가'] = [];
                                effectSources['공격력 증가'].push({ name: runeName, value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 무한 - 쿨타임 (조건부)
                            else if (runeName === '무한' && keyword === '쿨타임') {
                                const adjustedValue = runeSpecialAverages['무한_쿨타임'];
                                if (!specialEffectSums['재사용 대기 시간 회복 속도 증가']) specialEffectSums['재사용 대기 시간 회복 속도 증가'] = 0;
                                specialEffectSums['재사용 대기 시간 회복 속도 증가'] += adjustedValue;
                                if (!effectSources['재사용 대기 시간 회복 속도 증가']) effectSources['재사용 대기 시간 회복 속도 증가'] = [];
                                effectSources['재사용 대기 시간 회복 속도 증가'].push({ name: runeName, value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 이름 없는 혼돈 - 공격력 (조건부)
                            else if (runeName === '이름 없는 혼돈' && keyword === '공격력') {
                                const adjustedValue = runeSpecialAverages['이름없는혼돈'];
                                if (!specialEffectSums['공격력 증가']) specialEffectSums['공격력 증가'] = 0;
                                specialEffectSums['공격력 증가'] += adjustedValue;
                                if (!effectSources['공격력 증가']) effectSources['공격력 증가'] = [];
                                effectSources['공격력 증가'].push({ name: runeName, value: adjustedValue.toFixed(1) + '%', isSpecial: true });
                            }
                            // 영원 룬 - 결함 제거 + 공격력 (처리)
                            else if (runeName === '영원' && keyword === '결함 제거') {
                                // 결함 제거 효과 표시
                                if (!specialEffectSums['결함 제거']) specialEffectSums['결함 제거'] = 0;
                                if (!effectSources['결함 제거']) effectSources['결함 제거'] = [];
                                const 결함룬목록 = [...selectedRunes['무기'], ...selectedRunes['방어구']]
                                    .filter(name => {
                                        const r = runeData.find(rd => rd.name === name);
                                        return r && r.keyword && r.keyword.includes('결함');
                                    });
                                const 결함표시 = 결함룬목록.length > 0 ? 
                                    ' (제거된 결함: ' + 결함룬목록.join(', ') + ')' : '';
                                effectSources['결함 제거'].push({ 
                                    name: runeName + 결함표시, 
                                    value: '모든 결함 효과 제거', 
                                    isSpecial: true 
                                });
                            }
                            else if (runeName === '영원' && keyword === '공격력') {
                                if (!specialEffectSums['공격력 증가']) specialEffectSums['공격력 증가'] = 0;
                                specialEffectSums['공격력 증가'] += 10.0;
                                if (!effectSources['공격력 증가']) effectSources['공격력 증가'] = [];
                                effectSources['공격력 증가'].push({ name: runeName, value: '10.0%', isSpecial: true });
                            }
                            else if (efficiency !== 0 || keyword === '결함 제거') {
                                // 결함 효과 체크: 영원 룬이 있고 결함 룬의 패널티 효과면 무시
                                const is결함패널티 = rune.keyword && rune.keyword.includes('결함') && efficiency < 0;
                                if (has영원 && is결함패널티) {
                                    // 결함 패널티 무시하지만 표시는 함 (영원 효과 표시)
                                    const effectName = keyword + (keyword.includes('증가') || keyword.includes('피해') || keyword.includes('확률') ? '' : ' 증가');
                                    if (!specialEffectSums[effectName]) specialEffectSums[effectName] = 0;
                                    // 합계에는 0 추가 (패널티 제거)
                                    if (!effectSources[effectName]) effectSources[effectName] = [];
                                    effectSources[effectName].push({ 
                                        name: runeName + ' (결함 제거됨)', 
                                        value: '0% (원래: ' + efficiency.toFixed(1) + '%)', 
                                        isSpecial: true 
                                    });
                                    return;
                                }
                                
                                // 일반 효과 처리 (특수 계산이 아닌 경우)
                                if (efficiency !== 0) {
                                    const effectName = keyword + (keyword.includes('증가') || keyword.includes('피해') || keyword.includes('확률') ? '' : ' 증가');
                                    if (!specialEffectSums[effectName]) specialEffectSums[effectName] = 0;
                                    specialEffectSums[effectName] += efficiency;
                                    if (!effectSources[effectName]) effectSources[effectName] = [];
                                    const displayName = runeName + displaySuffix;
                                    const valueStr = (efficiency >= 0 ? '' : '') + efficiency.toFixed(1) + '%';
                                    effectSources[effectName].push({ name: displayName, value: valueStr, isSpecial: true });
                                }
                            }
                        });
                        return; // 이미 처리했으므로 다음 룬으로
                    }

                    rune.effects.forEach(effect => {
                        if (!effect.value) return;
                        const effectName = effect.effect;
                        const valueMatch = effect.value.match(/(\d+(?:\.\d+)?)/);
                        const value = valueMatch ? parseFloat(valueMatch[1]) : 0;
                        
                        if (!effectSums[effectName]) {
                            effectSums[effectName] = 0;
                            effectSources[effectName] = effectSources[effectName] || [];
                        }
                        effectSums[effectName] += value;
                        effectSources[effectName].push({
                            name: runeName,
                            value: effect.value,
                            isSpecial: false
                        });
                    });
                });
            });

            // 결과 표시
            const resultDiv = document.getElementById('effect-sums');
            resultDiv.innerHTML = '';
            
            // 특수 계산 효과 먼저 표시
            // specialEffectSums의 모든 키와 effectSources의 특수 효과 키를 합침
            const allSpecialEffects = new Set([
                ...Object.keys(specialEffectSums),
                ...Object.keys(effectSources).filter(key => effectSources[key]?.some(s => s.isSpecial))
            ]);
            
            allSpecialEffects.forEach(effect => {
                const sources = effectSources[effect]?.filter(s => s.isSpecial) || [];
                if (sources.length === 0) return;
                
                const total = (specialEffectSums[effect] || 0).toFixed(1) + '%';
                const parts = sources.map(s => s.value).join(' + ');
                const runes = sources.map(s => `[${s.name}]`).join(' + ');
                
                const effectDiv = document.createElement('div');
                effectDiv.className = 'effect-sum';
                // 음수 효과는 빨간색, 양수는 파란색, 0은 회색
                const effectValue = specialEffectSums[effect] || 0;
                const borderColor = effectValue > 0 ? '#2196F3' : 
                                   effectValue < 0 ? '#f44336' : '#9E9E9E';
                effectDiv.style.borderLeft = `4px solid ${borderColor}`;
                effectDiv.innerHTML = `
                    <div><strong>${effect}:</strong> ${total} = ${parts}</div>
                    <div class="rune-list" style="color: ${borderColor};">${runes}</div>
                `;
                resultDiv.appendChild(effectDiv);
            });
            
            // 일반 효과 표시
            Object.keys(effectSums).forEach(effect => {
                if (effectSums[effect] > 0) {
                    const sources = effectSources[effect].filter(s => !s.isSpecial);
                    if (sources.length === 0) return; // 특수 계산만 있는 경우 스킵
                    
                    const total = effectSums[effect].toFixed(1) + '%';
                    const parts = sources.map(s => s.value).join(' + ');
                    const runes = sources.map(s => `[${s.name}]`).join(' + ');
                    
                    const effectDiv = document.createElement('div');
                    effectDiv.className = 'effect-sum';
                    effectDiv.innerHTML = `
                        <div><strong>${effect}:</strong> ${total} = ${parts}</div>
                        <div class="rune-list">${runes}</div>
                    `;
                    resultDiv.appendChild(effectDiv);
                }
            });

            document.getElementById('calculation-result').style.display = 
                (Object.keys(effectSums).length > 0 || Object.keys(specialEffectSums).length > 0) ? 'block' : 'none';
            
            // 대미지 배율 계산 실행
            calculateDamageMultiplier(effectSums);
        }
        
        function calculateDamageMultiplier(runeEffects) {
            // 세트 효과 체크
            const has눈먼예언자 = selectedRunes['방어구'].includes('눈 먼 예언자');
            const has쌍둥이별 = selectedRunes['방어구'].includes('쌍둥이 별');
            const has에메랄드숲 = selectedRunes['방어구'].includes('에메랄드 숲');
            const has파멸의낙인 = selectedRunes['방어구'].includes('파멸의 낙인');
            const has공명하는수정 = selectedRunes['방어구'].includes('공명하는 수정');
            const has영원 = selectedRunes['방어구'].includes('영원');
            
            // 세트 효과 반영하여 특수 평균값 계산
            const runeSpecialAverages = calculate150sAverage(has쌍둥이별, has에메랄드숲, has파멸의낙인, has공명하는수정);
            
            // 각성 앰블럼 룬이 선택되었는지 확인
            const 각성앰블럼룬들 = ['무자비한 포식자', '부서진 하늘', '대마법사', '흩날리는 검', '산맥 군주', '아득한 빛', '갈라진 땅'];
            const selected각성앰블럼 = selectedRunes['앰블럼'].find(name => 각성앰블럼룬들.includes(name));
            
            // 각성 룬별 지속시간 (초)
            const 각성지속시간 = {
                '무자비한 포식자': 20,
                '부서진 하늘': 20,
                '대마법사': 20,
                '흩날리는 검': 35,
                '산맥 군주': 20,
                '아득한 빛': 20,
                '갈라진 땅': 35
            };
            
            // 각성 룬의 룬 피해 재사용대기시간 (X초마다)
            const 각성룬피해쿨타임 = {
                '부서진 하늘': 0.5,  // 0.5초마다
                '산맥 군주': 3        // 3초마다
            };
            
            // 각성 가동 시간 계산 함수 (150초 시뮬레이션)
            // 반환값: 150초 동안의 평균 가동 시간(초)
            // 로직: 각성 발동과 동시에 재사용 대기 시간 시작 (지속시간과 재사용대기 겹침)
            function calculate각성가동시간(지속시간초, 재사용대기초, has눈먼예언자) {
                // 눈먼예언자: 재사용 대기 시간 38초 감소
                const 실제재사용 = has눈먼예언자 ? Math.max(1, 재사용대기초 - 38) : 재사용대기초;
                
                // 한 사이클 = 재사용대기 (지속시간은 재사용대기 안에 포함됨)
                const 사이클시간 = 실제재사용;
                
                // 150초 동안 발동 가능 횟수 (0초에 시작 포함)
                const 발동횟수 = Math.floor(150 / 사이클시간) + 1;
                
                // 각 발동의 실제 가동 시간 계산
                let 총가동시간 = 0;
                for (let i = 0; i < 발동횟수; i++) {
                    const 발동시각 = i * 사이클시간;
                    if (발동시각 >= 150) break;
                    
                    // 이번 발동의 가동 시간 (150초를 넘지 않도록)
                    const 이번가동 = Math.min(지속시간초, 150 - 발동시각);
                    총가동시간 += 이번가동;
                }
                
                return 총가동시간;
            }
            
            // 가동률 계산 (0~1 사이 값)
            function calculate각성가동률(지속시간초, 재사용대기초, has눈먼예언자) {
                return calculate각성가동시간(지속시간초, 재사용대기초, has눈먼예언자) / 150;
            }
            
            // 스탯 값 가져오기
            const stats = {
                강타강화: parseFloat(document.getElementById('stat-강타강화')?.value || 0),
                연타강화: parseFloat(document.getElementById('stat-연타강화')?.value || 0),
                콤보강화: parseFloat(document.getElementById('stat-콤보강화')?.value || 0),
                광역강화: parseFloat(document.getElementById('stat-광역강화')?.value || 0),
                스킬위력: parseFloat(document.getElementById('stat-스킬위력')?.value || 0),
                치명타: parseFloat(document.getElementById('stat-치명타')?.value || 0),
                추가타: parseFloat(document.getElementById('stat-추가타')?.value || 0)
            };
            
            // 스킬 대미지율 가져오기 (%)
            const skillDmg = {
                공격력: parseFloat(document.getElementById('skill-공격력')?.value || 0) / 100,
                연타피해: parseFloat(document.getElementById('skill-연타피해')?.value || 0) / 100,
                강타피해: parseFloat(document.getElementById('skill-강타피해')?.value || 0) / 100,
                광역피해: parseFloat(document.getElementById('skill-광역피해')?.value || 0) / 100,
                콤보피해: parseFloat(document.getElementById('skill-콤보피해')?.value || 0) / 100,
                추가피해: parseFloat(document.getElementById('skill-추가피해')?.value || 0) / 100,
                치명타피해: parseFloat(document.getElementById('skill-치명타피해')?.value || 0) / 100,
                치명타확률: parseFloat(document.getElementById('skill-치명타확률')?.value || 0) / 100,
                추가타확률: parseFloat(document.getElementById('skill-추가타확률')?.value || 0) / 100
            };
            
            // 시너지 대미지 가져오기 (%)
            const synergy = {
                주는피해: parseFloat(document.getElementById('synergy-주는피해')?.value || 0) / 100,
                받는피해: parseFloat(document.getElementById('synergy-받는피해')?.value || 0) / 100
            };
            
            // 강화류 사용 유무
            const use강타 = document.getElementById('use-강타')?.checked ? 1 : 0;
            const use연타 = document.getElementById('use-연타')?.checked ? 1 : 0;
            const use광역 = document.getElementById('use-광역')?.checked ? 1 : 0;
            const use콤보 = document.getElementById('use-콤보')?.checked ? 1 : 0;
            
            // 룬 효과 값 (%) - 가동률이 적용된 실제 효과
            let runeAtk = 0;
            let rune강타 = 0;
            let rune연타 = 0;
            let rune광역 = 0;
            let rune콤보 = 0;
            let rune스킬피해 = 0;
            let rune주는피해 = 0;
            let rune치명타확률 = 0;
            let rune치명타피해 = 0;
            let rune추가타확률 = 0;
            let rune방어구파괴 = 0;
            
            // 선택된 룬들의 효율 데이터에서 가동률이 적용된 값 사용
            Object.keys(selectedRunes).forEach(type => {
                selectedRunes[type].forEach(runeName => {
                    const effData = runeEfficiencyData[runeName];
                    const rune = runeData.find(r => r.name === runeName);
                    
                    // 각성 룬 처리 (눈 먼 예언자 효과 반영)
                    if (rune && rune.keyword === '각성') {
                            if (effData && effData.keywords) {
                                effData.keywords.forEach((keyword, index) => {
                                    let efficiency = effData.efficiencies[index] || 0;
                                const count = effData.counts[index];
                                const 원본값 = effData.values[index];
                                
                                // 앰블럼 각성 룬인 경우
                                if (rune.type === '앰블럼' && 각성지속시간[runeName]) {
                                    // counts가 150이 아닌 경우만 각성 효과 (원본값으로 재계산)
                                    if (count !== 150) {
                                        const 가동률 = calculate각성가동률(각성지속시간[runeName], 90, has눈먼예언자);
                                        efficiency = 원본값 * 가동률;
                                    }
                                }
                                // 방어구 각성 룬인 경우 (압도적인 힘, 섬세한 손놀림)
                                else if (rune.type === '방어구') {
                                    if (count === 150) {
                                        // 기본 옵션은 항상 적용
                                        // 앰블럼 각성이 선택되었을 때만 추가 효과
                                        if (selected각성앰블럼) {
                                            const 앰블럼가동률 = calculate각성가동률(각성지속시간[selected각성앰블럼], 90, has눈먼예언자);
                                            efficiency = efficiency + (원본값 * 앰블럼가동률);
                                        }
                                    } else if (count === 33) {
                                        // counts=33은 중복 데이터이므로 무시
                                        efficiency = 0;
                                    }
                                }
                                
                                if (keyword === '공격력') {
                                    runeAtk += efficiency / 100;
                                } else if (keyword === '강타 피해') {
                                    rune강타 += efficiency / 100;
                                } else if (keyword === '연타 피해') {
                                    rune연타 += efficiency / 100;
                                } else if (keyword === '치명타 확률') {
                                    rune치명타확률 += efficiency / 100;
                                } else if (keyword === '치명타 피해') {
                                    rune치명타피해 += efficiency / 100;
                                } else if (keyword === '추가타 확률') {
                                    rune추가타확률 += efficiency / 100;
                                    } else if (keyword === '주는 피해') {
                                        rune주는피해 += efficiency / 100;
                                    }
                                });
                        }
                        return;
                    }
                    
                    // 검무+ 특수 처리 (누적+ 효과)
                    if (runeName === '검무+') {
                        runeAtk += runeSpecialAverages['검무+_공격력'] / 100;
                        rune치명타확률 += runeSpecialAverages['검무+_치명타확률'] / 100;
                        return;
                    }
                    
                    // 공명하는 수정 특수 처리
                    if (runeName === '공명하는 수정') {
                        rune주는피해 += runeSpecialAverages['공명하는 수정'] / 100;
                        return;
                    }
                    
                    // 황혼 특수 처리 (누적+ 효과)
                    if (runeName === '황혼') {
                        rune주는피해 += runeSpecialAverages['황혼'] / 100;
                        return;
                    }
                    
                    // 파멸의 낙인은 룬 피해에 포함 (아래에서 처리)
                    if (runeName === '파멸의 낙인') {
                        return; // 룬 피해 섹션에서 처리
                    }
                    
                    // 축적 룬들 - 에메랄드 숲 효과 반영
                    if (runeName === '바위 감시자') {
                        runeAtk += runeSpecialAverages['바위 감시자'] / 100;
                        return;
                    }
                    
                    if (runeName === '수정 꽃잎') {
                        runeAtk += runeSpecialAverages['수정꽃잎_공격력'] / 100;
                        // 룬 피해는 아래에서 처리
                        return;
                    }
                    
                    if (runeName === '나무 사슴') {
                        runeAtk += runeSpecialAverages['나무사슴_공격력'] / 100;
                        // 룬 피해는 아래에서 처리
                        return;
                    }
                    
                    // 푸른 거목 - 스킬 피해 (축적+ 효과)
                    if (runeName === '푸른 거목') {
                        rune스킬피해 += runeSpecialAverages['푸른 거목'] / 100;
                        return;
                    }
                    
                    // 잊힌 성소, 끝없는 순환 - 룬 피해만 (아래에서 처리)
                    if (runeName === '잊힌 성소' || runeName === '끝없는 순환') {
                        return; // 룬 피해 섹션에서 처리
                    }
                    
                    // 새벽별, 요정 무리 - 쿨타임 (대미지 계산에 직접 영향 없음)
                    if (runeName === '새벽별' || runeName === '요정 무리') {
                        return; // 쿨타임은 대미지 계산에 포함되지 않음
                    }
                    
                    // 여명+ - 공격력 (누적+ 효과)
                    if (runeName === '여명+') {
                        runeAtk += runeSpecialAverages['여명+'] / 100;
                        return;
                    }
                    
                    // 저무는 달 - 공격력 (기본 + 누적 평균)
                    if (runeName === '저무는 달') {
                        runeAtk += runeSpecialAverages['저무는달_총합'] / 100;
                        return;
                    }
                    
                    // 종언+ - 공격력 (누적 + 기본)
                    if (runeName === '종언+') {
                        const 누적값 = runeSpecialAverages['종언+_누적'] || 0;
                        const 기본값 = runeSpecialAverages['종언+_기본'];
                        runeAtk += (누적값 + 기본값) / 100;
                        return;
                    }
                    
                    // 어두운 징조 - 공격력, 치명타 확률, 주는 피해 (누적)
                    if (runeName === '어두운 징조') {
                        runeAtk += runeSpecialAverages['어두운징조_공격력'] / 100;
                        rune치명타확률 += runeSpecialAverages['어두운징조_치명타확률'] / 100;
                        rune주는피해 += runeSpecialAverages['어두운징조_주는피해'] / 100;
                        return;
                    }
                    
                    // 필사+ - 기본 + 추가 공격력 (조건부)
                    if (runeName === '필사+') {
                        const 기본값 = runeSpecialAverages['필사+_기본'];
                        const 추가값 = runeSpecialAverages['필사+_추가'];
                        runeAtk += (기본값 + 추가값) / 100;
                        return;
                    }
                    
                    // 성역+ - 공격력 (조건부)
                    if (runeName === '성역+') {
                        runeAtk += runeSpecialAverages['성역+_공격력'] / 100;
                        return;
                    }
                    
                    // 만 갈래 물길 - 공격력 (조건부)
                    if (runeName === '만 갈래 물길') {
                        const 기본값 = runeSpecialAverages['만갈래물길_기본'];
                        const 추가값 = runeSpecialAverages['만갈래물길_추가'];
                        runeAtk += (기본값 + 추가값) / 100;
                        return;
                    }
                    
                    // 이름 없는 혼돈 - 공격력 (조건부)
                    if (runeName === '이름 없는 혼돈') {
                        runeAtk += runeSpecialAverages['이름없는혼돈'] / 100;
                        return;
                    }
                    
                    // 영원 룬 - 공격력 10% (결함 제거는 위에서 처리)
                    if (runeName === '영원') {
                        runeAtk += 10.0 / 100;
                        return;
                    }
                    
                    // 바스러지는 빛, 땅울림, 마나 격류, 바위 거인 - 공격력
                    if (runeSpecialAverages[runeName]) {
                        runeAtk += runeSpecialAverages[runeName] / 100;
                        return;
                    }
                    
                    // effData는 이미 위에서 선언됨
                    if (effData && effData.keywords) {
                        effData.keywords.forEach((keyword, index) => {
                            const efficiency = effData.efficiencies[index] || 0;
                            
                            // 키워드에 따라 적절한 변수에 누적
                            if (keyword === '공격력') {
                                runeAtk += efficiency / 100;
                            } else if (keyword === '강타 피해') {
                                rune강타 += efficiency / 100;
                            } else if (keyword === '연타 피해') {
                                rune연타 += efficiency / 100;
                            } else if (keyword === '광역 피해') {
                                rune광역 += efficiency / 100;
                            } else if (keyword === '콤보 피해') {
                                rune콤보 += efficiency / 100;
                            } else if (keyword === '스킬 피해') {
                                rune스킬피해 += efficiency / 100;
                            } else if (keyword === '주는 피해') {
                                rune주는피해 += efficiency / 100;
                            } else if (keyword === '치명타 확률') {
                                rune치명타확률 += efficiency / 100;
                            } else if (keyword === '치명타 피해') {
                                rune치명타피해 += efficiency / 100;
                            } else if (keyword === '추가타 확률') {
                                rune추가타확률 += efficiency / 100;
                            } else if (keyword === '방어구 파괴') {
                                rune방어구파괴 += efficiency / 100;
                            }
                        });
                    }
                });
            });
            
            // 1. 공격력
            const attack = runeAtk + skillDmg.공격력 + 1;
            
            // 2. 강화류 (체크박스에 따라 사용 유무 결정)
            const 강타 = ((1 + stats.강타강화 / 8500) * (1 + rune강타 + skillDmg.강타피해) - 1) * use강타;
            const 연타 = ((1 + stats.연타강화 / 8500) * (1 + rune연타 + skillDmg.연타피해) - 1) * use연타;
            const 광역 = ((1 + stats.광역강화 / 8500) * (1 + rune광역 + skillDmg.광역피해) - 1) * use광역;
            const 콤보 = ((1 + stats.콤보강화 / 17500) * (1 + rune콤보 + skillDmg.콤보피해) - 1) * 4 * use콤보;
            const enhancement = 강타 + 연타 + 광역 + 콤보 + 1;
            
            // 3. 피해증가 (주는 피해와 받는 피해를 곱연산)
            const 주는피해 = (1 + stats.스킬위력 / 8500) * (1 + rune스킬피해) + rune주는피해 + skillDmg.추가피해 + synergy.주는피해;
            const 받는피해 = rune방어구파괴 + synergy.받는피해 + 1;
            const damageIncrease = 주는피해 * 받는피해;
            
            // 4. 치명타
            const 치명확률 = (0.5 - 1 / (2 + stats.치명타 / 1000)) + rune치명타확률 + skillDmg.치명타확률;
            const critical = 치명확률 * (1.4 + stats.치명타 / 5000) * (1 + rune치명타피해 + skillDmg.치명타피해);
            
            // 5. 추가타
            const additional = stats.추가타 / 13000 + rune추가타확률 + skillDmg.추가타확률 + 1;
            
            // 6. 룬 피해 계수 계산
            let runeDamageTotal = 0;
            let runeDOTTotal = 0;
            
            // 선택된 룬들의 효율 데이터에서 룬 피해 추출
            Object.keys(selectedRunes).forEach(type => {
                selectedRunes[type].forEach(runeName => {
                    // 파멸의 낙인 특수 처리 - 6-1 룬 피해 계수에 포함
                    if (runeName === '파멸의 낙인') {
                        runeDamageTotal += runeSpecialAverages['파멸의 낙인'];
                        return;
                    }
                    
                    // 축적 룬 피해들
                    if (runeName === '수정 꽃잎') {
                        runeDamageTotal += runeSpecialAverages['수정꽃잎_룬피해'];
                        return;
                    }
                    if (runeName === '나무 사슴') {
                        runeDamageTotal += runeSpecialAverages['나무사슴_룬피해'];
                        return;
                    }
                    if (runeName === '잊힌 성소') {
                        runeDamageTotal += runeSpecialAverages['잊힌 성소'];
                        return;
                    }
                    if (runeName === '끝없는 순환') {
                        runeDamageTotal += runeSpecialAverages['끝없는순환_공격'];
                        return;
                    }
                    
                    const effData = runeEfficiencyData[runeName];
                    if (effData && effData.keywords) {
                        effData.keywords.forEach((keyword, index) => {
                            if (keyword === '룬 피해') {
                                // 각성 룬 피해 (X초마다 발동) - 산맥 군주, 부서진 하늘
                                if (runeName === '산맥 군주' || runeName === '부서진 하늘') {
                                    const 지속시간 = 각성지속시간[runeName];
                                    const 가동률 = calculate각성가동률(지속시간, 90, has눈먼예언자);
                                    const X초 = 각성룬피해쿨타임[runeName];
                                    const 원본값 = effData.values[index];
                                    const DPS = (원본값 / X초) * 가동률;
                                    runeDamageTotal += DPS;
                                } else {
                                    // 일반 룬 피해
                                    runeDamageTotal += (effData.efficiencies[index] || 0);
                                }
                            } else if (keyword === '지속 피해') {
                                // 지속 피해 계수
                                runeDOTTotal += (effData.efficiencies[index] || 0);
                            }
                        });
                    }
                });
            });
            
            const runeDamage = 1 + (runeDamageTotal / 100);
            const runeDOT = 1 + (runeDOTTotal / 100);
            
            // 7. 최종 대미지 배율
            const directDamage = attack * enhancement * damageIncrease * critical * additional * runeDamage;
            const indirectDamage = attack * damageIncrease * runeDOT;
            
            // UI 업데이트
            document.getElementById('calc-attack').textContent = attack.toFixed(2);
            document.getElementById('calc-enhancement').textContent = enhancement.toFixed(2);
            document.getElementById('calc-damage-increase').textContent = damageIncrease.toFixed(2);
            document.getElementById('calc-critical').textContent = critical.toFixed(2);
            document.getElementById('calc-additional').textContent = additional.toFixed(2);
            document.getElementById('calc-rune-damage').textContent = runeDamage.toFixed(2);
            document.getElementById('calc-rune-dot').textContent = runeDOT.toFixed(2);
            document.getElementById('final-direct').textContent = directDamage.toFixed(2) + '배';
            document.getElementById('final-indirect').textContent = indirectDamage.toFixed(2) + '배';
        }

        function generateFilterButtons() {
            try {
                console.log('필터 버튼 생성 시작');
                
                const typeContainer = document.getElementById('type-filters');
                if (!typeContainer) {
                    console.error('type-filters 컨테이너를 찾을 수 없습니다');
                    return;
                }
                
                var typeItems = ['무기', '방어구', '앰블럼'];
                for (var i = 0; i < typeItems.length; i++) {
                    var item = typeItems[i];
                    var button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.textContent = item;
                    button.setAttribute('data-filter-type', 'type');
                    button.setAttribute('data-filter-value', item);
                    button.onclick = function() {
                        toggleFilter(this.getAttribute('data-filter-type'), this.getAttribute('data-filter-value'), this);
                    };
                    typeContainer.appendChild(button);
                }
                console.log('종류 필터 버튼 생성 완료');

                const gradeContainer = document.getElementById('grade-filters');
                if (!gradeContainer) {
                    console.error('grade-filters 컨테이너를 찾을 수 없습니다');
                    return;
                }
                
                var gradeItems = ['전설', '신화', '6성 전설'];
                for (var j = 0; j < gradeItems.length; j++) {
                    var item = gradeItems[j];
                    var button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.textContent = item;
                    button.setAttribute('data-filter-type', 'grade');
                    button.setAttribute('data-filter-value', item);
                    button.onclick = function() {
                        toggleFilter(this.getAttribute('data-filter-type'), this.getAttribute('data-filter-value'), this);
                    };
                    gradeContainer.appendChild(button);
                }
                console.log('등급 필터 버튼 생성 완료');
                
                const keywordContainer = document.getElementById('keyword-filters');
                if (!keywordContainer) {
                    console.error('keyword-filters 컨테이너를 찾을 수 없습니다');
                    return;
                }
                
                var keywords = Object.keys(keywordCategories);
                for (var k = 0; k < keywords.length; k++) {
                    var keyword = keywords[k];
                    var button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.textContent = keyword;
                    button.setAttribute('data-filter-type', 'keyword');
                    button.setAttribute('data-filter-value', keyword);
                    button.onclick = function() {
                        toggleFilter(this.getAttribute('data-filter-type'), this.getAttribute('data-filter-value'), this);
                    };
                    keywordContainer.appendChild(button);
                }
                console.log('키워드 필터 버튼 생성 완료');
                
                const featureContainer = document.getElementById('feature-filters');
                if (!featureContainer) {
                    console.error('feature-filters 컨테이너를 찾을 수 없습니다');
                    return;
                }
                
                for (var m = 0; m < featureCategories.length; m++) {
                    var feature = featureCategories[m];
                    var button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.textContent = feature;
                    button.setAttribute('data-filter-type', 'feature');
                    button.setAttribute('data-filter-value', feature);
                    button.onclick = function() {
                        toggleFilter(this.getAttribute('data-filter-type'), this.getAttribute('data-filter-value'), this);
                    };
                    featureContainer.appendChild(button);
                }
                console.log('특징 필터 버튼 생성 완료');
                
            } catch (error) {
                console.error('필터 버튼 생성 오류:', error);
            }
        }

        function toggleFilter(category, value, element) {
            const filterSet = activeFilters[category];
            if (filterSet.has(value)) {
                filterSet.delete(value);
                element.classList.remove('active');
            } else {
                filterSet.add(value);
                element.classList.add('active');
            }
            applyFilters();
            sortTable(sortState.columnIndex, sortState.dataType, true);
        }

        function applyFilters() {
            console.log('Active filters:', activeFilters);
            
            const runeGroups = getRuneGroups();
            runeGroups.forEach(group => {
                const runeNameFromRow = group.mainRow.getAttribute('data-rune-name');
                const rune = runeData.find(r => r.name === runeNameFromRow);
                if (!rune) return;

                console.log('\nChecking rune:', rune.name);

                const typeMatch = activeFilters.type.size === 0 || activeFilters.type.has(rune.type);
                const gradeMatch = activeFilters.grade.size === 0 || activeFilters.grade.has(rune.grade);
                
                // 키워드 필터 체크 (runeEfficiencyData 기반)
                const keywordMatch = activeFilters.keyword.size === 0 || Array.from(activeFilters.keyword).every(category => {
                    const effData = runeEfficiencyData[rune.name];
                    if (!effData || !effData.keywords) return false;
                    
                    const categoryKeywords = keywordCategories[category];
                    return effData.keywords.some(keyword => categoryKeywords.includes(keyword));
                });
                
                // 특징 필터 체크
                const featureMatch = activeFilters.feature.size === 0 || Array.from(activeFilters.feature).every(selectedFeature => {
                    if (selectedFeature === '기타') {
                        // 특징이 비어있거나 특수 특징이 아닌 경우
                        return !rune.keyword || rune.keyword === '';
                    }
                    // 특징이 정확히 일치하는지 확인 (누적+, 각성+, 축적+, 결함+ 포함)
                    if (rune.keyword.includes('+')) {
                        return rune.keyword.startsWith(selectedFeature);
                    }
                    return rune.keyword === selectedFeature;
                });

                // 이름 검색 조건
                const nameSearch = document.getElementById('name-search').value.toLowerCase();
                const initialValue = getInitialConsonant(nameSearch);
                const nameMatch = !nameSearch || 
                    rune.name.toLowerCase().includes(nameSearch) || 
                    getInitialConsonant(rune.name.toLowerCase()).includes(initialValue);

                const shouldShow = typeMatch && gradeMatch && keywordMatch && featureMatch && nameMatch;
                console.log('Final visibility:', shouldShow);

                group.rows.forEach(row => {
                    row.style.display = shouldShow ? '' : 'none';
                });
            });
        }

        function getRuneGroups() {
            const rows = Array.from(document.querySelector('tbody').rows);
            const runeGroups = [];
            let currentGroup = null;

            rows.forEach(row => {
                const runeName = row.getAttribute('data-rune-name');
                if (!runeName) return; // data-rune-name이 없는 행은 무시

                // 새로운 룬 그룹의 시작을 확인 (또는 첫 번째 행)
                if (!currentGroup || currentGroup.mainRow.getAttribute('data-rune-name') !== runeName) {
                    if (currentGroup) runeGroups.push(currentGroup);
                    currentGroup = { mainRow: row, rows: [row] };
                } else {
                    currentGroup.rows.push(row);
                }
            });
            if (currentGroup) runeGroups.push(currentGroup);
            return runeGroups;
        }


        function clearAllFilters(event) {
            try {
                console.log('필터 초기화 시작');
                
                if (event) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                
                // 이름 검색 초기화
                document.getElementById('name-search').value = '';
                
                // 필터 초기화
                for (var key in activeFilters) {
                    if (activeFilters.hasOwnProperty(key)) {
                        activeFilters[key].clear();
                    }
                }
                
                // 버튼 스타일 초기화
                var activeButtons = document.querySelectorAll('.filter-btn.active');
                for (var i = 0; i < activeButtons.length; i++) {
                    activeButtons[i].classList.remove('active');
                }

                // 체크박스 초기화
                var checkboxes = document.querySelectorAll('.rune-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                    checkbox.disabled = false;
                });

                // 선택된 룬 초기화
                selectedRunes = {
                    무기: [],
                    방어구: [],
                    앰블럼: []
                };

                // 선택 개수 표시 초기화
                updateSelectedCounts();

                // 계산 결과 숨기기
                document.getElementById('calculation-result').style.display = 'none';
                
                applyFilters();
                sortTable(0, 'str', true);
                
                console.log('필터 초기화 완료');
                
            } catch (error) {
                console.error('필터 초기화 오류:', error);
            }
        }
        
        function parseNumericValue(text) {
            if (typeof text !== 'string' || text === '-') return -Infinity;
            var maxMatch = text.match(/최대 ([\d.]+)/);
            if (maxMatch) return parseFloat(maxMatch[1]);
            var numMatch = text.match(/([\d.]+)/);
            return numMatch ? parseFloat(numMatch[1]) : -Infinity;
        }
        
        function getGroupSortValue(group, columnIndex) {
            const runeName = group.mainRow.getAttribute('data-rune-name');
            const rune = runeData.find(r => r.name === runeName);
            if (!rune) return null;
            
            // 이름 열의 경우 룬 이름 직접 참조
            if (columnIndex === 1) {
                return rune.name;
            }

            // 특징 열의 경우 룬 키워드 직접 참조
            if (columnIndex === 2) {
                return rune.keyword || '';
            }
            
            // 설명 열
            if (columnIndex === 3) {
                return group.mainRow.cells[columnIndex].innerText;
            }
            
            return group.mainRow.cells[columnIndex].innerText;
        }

        function sortTable(columnIndex, dataType, keepDirection = false) {
            if (!keepDirection) {
                if (sortState.columnIndex === columnIndex) {
                    sortState.direction = sortState.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    sortState.columnIndex = columnIndex;
                    sortState.direction = 'asc';
                }
            }
            sortState.dataType = dataType;
            const direction = sortState.direction === 'asc' ? 1 : -1;

            const runeGroups = getRuneGroups();
            runeGroups.sort((groupA, groupB) => {
                const valA = getGroupSortValue(groupA, sortState.columnIndex);
                const valB = getGroupSortValue(groupB, sortState.columnIndex);

                if (sortState.dataType === 'num') {
                    if (valA === -Infinity && valB !== -Infinity) return 1 * direction;
                    if (valB === -Infinity && valA !== -Infinity) return -1 * direction;
                    return (valB - valA) * direction;  // 내림차순으로 변경
                }
                return (valA || '').localeCompare(valB || '', 'ko') * direction;
            });
            
            const tbody = document.querySelector('tbody');
            tbody.innerHTML = '';
            runeGroups.forEach(group => {
                group.rows.forEach(row => {
                    row.style.display = group.mainRow.style.display; 
                    tbody.appendChild(row);
                });
            });
            
            updateSortIndicators();
        }
        
        function updateSortIndicators() {
            document.querySelectorAll('th .sort-indicator').forEach(span => span.textContent = '');
            const indicator = document.querySelector(`th:nth-child(${sortState.columnIndex + 1}) .sort-indicator`);
            if(indicator) indicator.textContent = sortState.direction === 'asc' ? '▲' : '▼';
        }

        // 이름 검색 이벤트 리스너 추가
        document.addEventListener('DOMContentLoaded', function() {
            const nameSearch = document.getElementById('name-search');
            if (nameSearch) {
                nameSearch.addEventListener('input', function() {
                    applyFilters();
                });
            }
            
            // 스탯 입력 시 대미지 계산 업데이트
            const statInputs = [
                'stat-강타강화', 'stat-연타강화', 'stat-콤보강화', 'stat-광역강화',
                'stat-스킬위력', 'stat-치명타', 'stat-추가타',
                'skill-공격력', 'skill-연타피해', 'skill-강타피해', 'skill-광역피해',
                'skill-콤보피해', 'skill-추가피해', 'skill-치명타피해', 
                'skill-치명타확률', 'skill-추가타확률',
                'synergy-주는피해', 'synergy-받는피해'
            ];
            
            function recalculateDamage() {
                // 선택된 룬이 있다면 효과 재계산
                const effectSums = {};
                Object.keys(selectedRunes).forEach(type => {
                    selectedRunes[type].forEach(runeName => {
                        const rune = runeData.find(r => r.name === runeName);
                        if (!rune) return;
                        rune.effects.forEach(effect => {
                            if (!effect.value) return;
                            const effectName = effect.effect;
                            const valueMatch = effect.value.match(/(\d+(?:\.\d+)?)/);
                            const value = valueMatch ? parseFloat(valueMatch[1]) : 0;
                            if (!effectSums[effectName]) {
                                effectSums[effectName] = 0;
                            }
                            effectSums[effectName] += value;
                        });
                    });
                });
                calculateDamageMultiplier(effectSums);
            }
            
            statInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', recalculateDamage);
                }
            });
            
            // 강화류 체크박스 이벤트 리스너
            const enhancementCheckboxes = ['use-강타', 'use-연타', 'use-광역', 'use-콤보'];
            enhancementCheckboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.addEventListener('change', recalculateDamage);
                }
            });
            
            // 초기 계산 실행
            calculateDamageMultiplier({});
        });

        function getNumericValue(text) {
            if (!text) return -Infinity;
            
            // "최대 X%" 형식 체크
            const maxMatch = text.match(/최대\s*(\d+(?:\.\d+)?)/);
            if (maxMatch) {
                return parseFloat(maxMatch[1]);
            }
            
            // "X% (최대 Y%)" 형식 체크
            const maxInParenMatch = text.match(/\d+(?:\.\d+)?%\s*\(최대\s*(\d+(?:\.\d+)?)/);
            if (maxInParenMatch) {
                return parseFloat(maxInParenMatch[1]);
            }

            // 일반 숫자 추출
            const matches = text.match(/(\d+(?:\.\d+)?)/g);
            if (!matches) return -Infinity;
            
            // 여러 숫자 중 가장 큰 값 반환
            return Math.max(...matches.map(m => parseFloat(m)));
        }
        
        // ============================================
        // 세팅 저장/불러오기 기능
        // ============================================
        
        // 로컬스토리지 키
        const STORAGE_KEY = 'mabi_rune_save_list';
        
        // 선택된 항목 추적
        let selectedLoadItem = null;
        let selectedUpdateItem = null;
        let selectedDeleteItem = null;
        let selectedCompareItem1 = null;
        let selectedCompareItem2 = null;
        
        // 현재 세팅 데이터 수집
        function getCurrentSet() {
            // 선택된 룬 정보
            const selectedRunesData = {
                '무기': selectedRunes['무기'].slice(),
                '방어구': selectedRunes['방어구'].slice(),
                '앰블럼': selectedRunes['앰블럼'].slice()
            };
            
            // 스테이터스
            const stats = {
                강타강화: parseFloat(document.getElementById('stat-강타강화')?.value) || 0,
                연타강화: parseFloat(document.getElementById('stat-연타강화')?.value) || 0,
                콤보강화: parseFloat(document.getElementById('stat-콤보강화')?.value) || 0,
                광역강화: parseFloat(document.getElementById('stat-광역강화')?.value) || 0,
                스킬위력: parseFloat(document.getElementById('stat-스킬위력')?.value) || 0,
                치명타: parseFloat(document.getElementById('stat-치명타')?.value) || 0,
                추가타: parseFloat(document.getElementById('stat-추가타')?.value) || 0
            };
            
            // 캐릭터 스킬 관련
            const skills = {
                공격력: parseFloat(document.getElementById('skill-공격력')?.value) || 0,
                연타피해: parseFloat(document.getElementById('skill-연타피해')?.value) || 0,
                강타피해: parseFloat(document.getElementById('skill-강타피해')?.value) || 0,
                광역피해: parseFloat(document.getElementById('skill-광역피해')?.value) || 0,
                콤보피해: parseFloat(document.getElementById('skill-콤보피해')?.value) || 0,
                추가피해: parseFloat(document.getElementById('skill-추가피해')?.value) || 0,
                치명타피해: parseFloat(document.getElementById('skill-치명타피해')?.value) || 0,
                치명타확률: parseFloat(document.getElementById('skill-치명타확률')?.value) || 0,
                추가타확률: parseFloat(document.getElementById('skill-추가타확률')?.value) || 0
            };
            
            // 강화류 사용 유무
            const enhancements = {
                강타: document.getElementById('use-강타')?.checked || false,
                연타: document.getElementById('use-연타')?.checked || false,
                광역: document.getElementById('use-광역')?.checked || false,
                콤보: document.getElementById('use-콤보')?.checked || false
            };
            
            // 시너지 대미지
            const synergy = parseFloat(document.getElementById('synergy-주는피해')?.value) || 0;
            
            // 대미지 배율 계산 결과
            const damageCalculation = {
                attack: document.getElementById('calc-attack')?.textContent || '1.00',
                enhancement: document.getElementById('calc-enhancement')?.textContent || '1.00',
                damageIncrease: document.getElementById('calc-damage-increase')?.textContent || '1.00',
                critical: document.getElementById('calc-critical')?.textContent || '1.00',
                additional: document.getElementById('calc-additional')?.textContent || '1.00',
                runeDamage: document.getElementById('calc-rune-damage')?.textContent || '1.00',
                runeDot: document.getElementById('calc-rune-dot')?.textContent || '1.00',
                finalDirect: document.getElementById('final-direct')?.textContent || '1.00배',
                finalIndirect: document.getElementById('final-indirect')?.textContent || '1.00배'
            };
            
            return {
                runes: selectedRunesData,
                stats: stats,
                skills: skills,
                enhancements: enhancements,
                synergy: synergy,
                damageCalculation: damageCalculation,
                timestamp: new Date().toISOString()
            };
        }
        
        // 세팅 데이터 로드
        function loadSet(setData) {
            if (!setData) return;
            
            // 먼저 모든 체크박스 해제
            document.querySelectorAll('.rune-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // selectedRunes 초기화
            selectedRunes = { '무기': [], '방어구': [], '앰블럼': [] };
            
            // 룬 선택 복원
            if (setData.runes) {
                Object.keys(setData.runes).forEach(type => {
                    setData.runes[type].forEach(runeName => {
                        const checkbox = document.querySelector(`input[type="checkbox"][data-rune-name="${runeName}"]`);
                        if (checkbox) {
                            checkbox.checked = true;
                            selectedRunes[type].push(runeName);
                        }
                    });
                });
            }
            
            // 체크박스 상태 업데이트 (선택 개수 초과 시 다른 체크박스 비활성화)
            updateCheckboxStates();
            
            // 스테이터스 복원
            if (setData.stats) {
                if (document.getElementById('stat-강타강화'))
                    document.getElementById('stat-강타강화').value = setData.stats.강타강화 || 0;
                if (document.getElementById('stat-연타강화'))
                    document.getElementById('stat-연타강화').value = setData.stats.연타강화 || 0;
                if (document.getElementById('stat-콤보강화'))
                    document.getElementById('stat-콤보강화').value = setData.stats.콤보강화 || 0;
                if (document.getElementById('stat-광역강화'))
                    document.getElementById('stat-광역강화').value = setData.stats.광역강화 || 0;
                if (document.getElementById('stat-스킬위력'))
                    document.getElementById('stat-스킬위력').value = setData.stats.스킬위력 || 0;
                if (document.getElementById('stat-치명타'))
                    document.getElementById('stat-치명타').value = setData.stats.치명타 || 0;
                if (document.getElementById('stat-추가타'))
                    document.getElementById('stat-추가타').value = setData.stats.추가타 || 0;
            }
            
            // 스킬 복원
            if (setData.skills) {
                if (document.getElementById('skill-공격력'))
                    document.getElementById('skill-공격력').value = setData.skills.공격력 || 0;
                if (document.getElementById('skill-연타피해'))
                    document.getElementById('skill-연타피해').value = setData.skills.연타피해 || 0;
                if (document.getElementById('skill-강타피해'))
                    document.getElementById('skill-강타피해').value = setData.skills.강타피해 || 0;
                if (document.getElementById('skill-광역피해'))
                    document.getElementById('skill-광역피해').value = setData.skills.광역피해 || 0;
                if (document.getElementById('skill-콤보피해'))
                    document.getElementById('skill-콤보피해').value = setData.skills.콤보피해 || 0;
                if (document.getElementById('skill-추가피해'))
                    document.getElementById('skill-추가피해').value = setData.skills.추가피해 || 0;
                if (document.getElementById('skill-치명타피해'))
                    document.getElementById('skill-치명타피해').value = setData.skills.치명타피해 || 0;
                if (document.getElementById('skill-치명타확률'))
                    document.getElementById('skill-치명타확률').value = setData.skills.치명타확률 || 0;
                if (document.getElementById('skill-추가타확률'))
                    document.getElementById('skill-추가타확률').value = setData.skills.추가타확률 || 0;
            }
            
            // 강화류 복원
            if (setData.enhancements) {
                if (document.getElementById('use-강타')) 
                    document.getElementById('use-강타').checked = setData.enhancements.강타 || false;
                if (document.getElementById('use-연타')) 
                    document.getElementById('use-연타').checked = setData.enhancements.연타 || false;
                if (document.getElementById('use-광역')) 
                    document.getElementById('use-광역').checked = setData.enhancements.광역 || false;
                if (document.getElementById('use-콤보')) 
                    document.getElementById('use-콤보').checked = setData.enhancements.콤보 || false;
            }
            
            // 시너지 복원
            if (setData.synergy !== undefined && document.getElementById('synergy-주는피해')) {
                document.getElementById('synergy-주는피해').value = setData.synergy;
            }
            
            // UI 업데이트
            updateSelectedCounts();
            calculateEffects();
            recalculateDamage();
        }
        
        // 로컬스토리지에서 저장 목록 가져오기
        function getSaveList() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : {};
        }
        
        // 로컬스토리지에 저장 목록 저장
        function setSaveList(saveList) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(saveList));
        }
        
        // 버튼 활성화/비활성화 업데이트
        function updateButtonStates() {
            const saveList = getSaveList();
            const count = Object.keys(saveList).length;
            
            document.getElementById('btn-load').disabled = count < 1;
            document.getElementById('btn-update').disabled = count < 1;
            document.getElementById('btn-delete').disabled = count < 1;
            document.getElementById('btn-compare').disabled = count < 2;
            document.getElementById('btn-export').disabled = count < 1;
        }
        
        // 모달 열기/닫기
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // 선택 초기화
            if (modalId === 'loadModal') selectedLoadItem = null;
            if (modalId === 'updateModal') selectedUpdateItem = null;
            if (modalId === 'deleteModal') selectedDeleteItem = null;
            if (modalId === 'exportModal') selectedExportItem = null;
            if (modalId === 'compareModal') {
                selectedCompareItem1 = null;
                selectedCompareItem2 = null;
                document.getElementById('compareResult').innerHTML = '';
            }
            if (modalId === 'saveModal') {
                document.getElementById('saveNameInput').value = '';
            }
        }
        
        // 모달 외부 클릭 시 닫기
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
        
        // 저장 모달 열기
        function openSaveModal() {
            openModal('saveModal');
            document.getElementById('saveNameInput').focus();
        }
        
        // 현재 세팅 저장
        function saveCurrentSet() {
            const saveName = document.getElementById('saveNameInput').value.trim();
            
            if (!saveName) {
                alert('세팅 이름을 입력해주세요.');
                return;
            }
            
            const saveList = getSaveList();
            
            if (saveList[saveName]) {
                if (!confirm(`'${saveName}' 이름의 세팅이 이미 존재합니다. 덮어쓰시겠습니까?`)) {
                    return;
                }
            }
            
            const currentSet = getCurrentSet();
            saveList[saveName] = currentSet;
            setSaveList(saveList);
            
            alert(`'${saveName}' 세팅이 저장되었습니다.`);
            closeModal('saveModal');
            updateButtonStates();
        }
        
        // 불러오기 모달 열기
        function openLoadModal() {
            const saveList = getSaveList();
            const count = Object.keys(saveList).length;
            
            if (count < 1) return;
            
            const listHtml = Object.keys(saveList).map(name => {
                const data = saveList[name];
                const date = new Date(data.timestamp).toLocaleString('ko-KR');
                return `
                    <div class="save-item" data-name="${name}">
                        <div class="save-item-name">${name}</div>
                        <div class="save-item-date">${date}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('loadList').innerHTML = listHtml;
            selectedLoadItem = null;
            openModal('loadModal');
        }
        
        // 불러오기 항목 선택
        function selectLoadItem(name) {
            selectedLoadItem = name;
            document.querySelectorAll('#loadList .save-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`#loadList .save-item[data-name="${name}"]`).classList.add('selected');
        }
        
        // 선택된 세팅 불러오기
        function loadSelectedSet() {
            if (!selectedLoadItem) {
                alert('불러올 세팅을 선택해주세요.');
                return;
            }
            
            const saveList = getSaveList();
            const setData = saveList[selectedLoadItem];
            
            if (!setData) {
                alert('세팅을 찾을 수 없습니다.');
                return;
            }
            
            // 확인 메시지 표시
            if (!confirm(`'${selectedLoadItem}' 세팅을 불러오시겠습니까?`)) {
                return;
            }
            
            // 모달 먼저 닫고
            closeModal('loadModal');
            
            // 세팅 불러오기
            loadSet(setData);
            alert(`'${selectedLoadItem}' 세팅을 불러왔습니다.`);
        }
        
        // 변경 모달 열기
        function openUpdateModal() {
            const saveList = getSaveList();
            const count = Object.keys(saveList).length;
            
            if (count < 1) return;
            
            const listHtml = Object.keys(saveList).map(name => {
                const data = saveList[name];
                const date = new Date(data.timestamp).toLocaleString('ko-KR');
                return `
                    <div class="save-item" data-name="${name}">
                        <div class="save-item-name">${name}</div>
                        <div class="save-item-date">${date}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('updateList').innerHTML = listHtml;
            selectedUpdateItem = null;
            openModal('updateModal');
        }
        
        // 변경 항목 선택
        function selectUpdateItem(name) {
            selectedUpdateItem = name;
            document.querySelectorAll('#updateList .save-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`#updateList .save-item[data-name="${name}"]`).classList.add('selected');
        }
        
        // 선택된 세팅 변경
        function updateSelectedSet() {
            if (!selectedUpdateItem) {
                alert('변경할 세팅을 선택해주세요.');
                return;
            }
            
            if (!confirm(`'${selectedUpdateItem}' 세팅을 현재 값으로 덮어쓰시겠습니까?`)) {
                return;
            }
            
            const saveList = getSaveList();
            const currentSet = getCurrentSet();
            saveList[selectedUpdateItem] = currentSet;
            setSaveList(saveList);
            
            alert(`'${selectedUpdateItem}' 세팅이 변경되었습니다.`);
            closeModal('updateModal');
        }
        
        // 삭제 모달 열기
        function openDeleteModal() {
            const saveList = getSaveList();
            const count = Object.keys(saveList).length;
            
            if (count < 1) return;
            
            const listHtml = Object.keys(saveList).map(name => {
                const data = saveList[name];
                const date = new Date(data.timestamp).toLocaleString('ko-KR');
                return `
                    <div class="save-item" data-name="${name}">
                        <div class="save-item-name">${name}</div>
                        <div class="save-item-date">${date}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('deleteList').innerHTML = listHtml;
            selectedDeleteItem = null;
            openModal('deleteModal');
        }
        
        // 삭제 항목 선택
        function selectDeleteItem(name) {
            selectedDeleteItem = name;
            document.querySelectorAll('#deleteList .save-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`#deleteList .save-item[data-name="${name}"]`).classList.add('selected');
        }
        
        // 선택된 세팅 삭제
        function deleteSelectedSet() {
            if (!selectedDeleteItem) {
                alert('삭제할 세팅을 선택해주세요.');
                return;
            }
            
            if (!confirm(`'${selectedDeleteItem}' 세팅을 삭제하시겠습니까?`)) {
                return;
            }
            
            const saveList = getSaveList();
            delete saveList[selectedDeleteItem];
            setSaveList(saveList);
            
            alert(`'${selectedDeleteItem}' 세팅이 삭제되었습니다.`);
            closeModal('deleteModal');
            updateButtonStates();
        }
        
        // ============================================
        // 세팅 내보내기/가져오기 기능
        // ============================================
        
        let selectedExportItem = null;
        
        // 내보내기 모달 열기
        function openExportModal() {
            const saveList = getSaveList();
            const count = Object.keys(saveList).length;
            
            if (count < 1) {
                alert('내보낼 세팅이 없습니다.');
                return;
            }
            
            const listHtml = Object.keys(saveList).map(name => {
                const data = saveList[name];
                const date = new Date(data.timestamp).toLocaleString('ko-KR');
                return `
                    <div class="save-item" data-name="${name}">
                        <div class="save-item-name">${name}</div>
                        <div class="save-item-date">${date}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('exportList').innerHTML = listHtml;
            selectedExportItem = null;
            openModal('exportModal');
        }
        
        // 내보내기 항목 선택
        function selectExportItem(name) {
            selectedExportItem = name;
            document.querySelectorAll('#exportList .save-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`#exportList .save-item[data-name="${name}"]`).classList.add('selected');
        }
        
        // 선택된 세팅 내보내기 (JSON 다운로드)
        function exportSelectedSet() {
            if (!selectedExportItem) {
                alert('내보낼 세팅을 선택해주세요.');
                return;
            }
            
            const saveList = getSaveList();
            const setData = saveList[selectedExportItem];
            
            if (!setData) {
                alert('세팅을 찾을 수 없습니다.');
                return;
            }
            
            // 파일명 생성: 세팅이름_연도월일시간분.json
            const now = new Date();
            const dateStr = now.getFullYear().toString().slice(-2) + 
                            String(now.getMonth() + 1).padStart(2, '0') + 
                            String(now.getDate()).padStart(2, '0') + 
                            String(now.getHours()).padStart(2, '0') + 
                            String(now.getMinutes()).padStart(2, '0');
            const fileName = `${selectedExportItem}_${dateStr}.json`;
            
            // JSON 파일로 다운로드
            const jsonStr = JSON.stringify(setData, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert(`'${selectedExportItem}' 세팅을 ${fileName} 파일로 내보냈습니다.`);
            closeModal('exportModal');
        }
        
        // 드롭 영역 이벤트 설정
        function setupDropZone() {
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');
            
            // 클릭 시 파일 선택 창 열기
            dropZone.addEventListener('click', () => {
                fileInput.click();
            });
            
            // 파일 선택 시 처리
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFileImport(file);
                }
                fileInput.value = ''; // 초기화
            });
            
            // 드래그 이벤트 처리
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            
            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                
                const file = e.dataTransfer.files[0];
                if (file && file.name.endsWith('.json')) {
                    handleFileImport(file);
                } else {
                    alert('JSON 파일만 가져올 수 있습니다.');
                }
            });
        }
        
        // 파일 가져오기 처리
        function handleFileImport(file) {
            const reader = new FileReader();
            
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // 데이터 유효성 검사
                    if (!importedData.runes || !importedData.stats || !importedData.skills) {
                        alert('유효하지 않은 세팅 파일입니다.');
                        return;
                    }
                    
                    // 파일명에서 세팅 이름 추출 (확장자와 날짜 제거)
                    let settingName = file.name.replace('.json', '');
                    // _날짜 부분 제거 (예: _2510211930)
                    settingName = settingName.replace(/_\d{10}$/, '');
                    
                    // 중복 확인 및 이름 변경
                    const saveList = getSaveList();
                    let finalName = settingName;
                    let counter = 1;
                    
                    while (saveList[finalName]) {
                        finalName = `${settingName} (${counter})`;
                        counter++;
                    }
                    
                    // localStorage에 저장
                    saveList[finalName] = importedData;
                    setSaveList(saveList);
                    
                    alert(`'${finalName}' 세팅을 성공적으로 가져왔습니다!\n불러오기 메뉴에서 확인할 수 있습니다.`);
                    
                    // 버튼 상태 업데이트
                    updateButtonStates();
                    
                } catch (error) {
                    console.error('파일 가져오기 오류:', error);
                    alert('파일을 읽는 중 오류가 발생했습니다.\nJSON 파일 형식을 확인해주세요.');
                }
            };
            
            reader.readAsText(file);
        }
        
        // 비교 모달 열기
        function openCompareModal() {
            const saveList = getSaveList();
            const count = Object.keys(saveList).length;
            
            if (count < 2) return;
            
            const listHtml1 = Object.keys(saveList).map(name => {
                const data = saveList[name];
                const date = new Date(data.timestamp).toLocaleString('ko-KR');
                return `
                    <div class="save-item" data-name="${name}">
                        <div class="save-item-name">${name}</div>
                        <div class="save-item-date">${date}</div>
                    </div>
                `;
            }).join('');
            
            const listHtml2 = Object.keys(saveList).map(name => {
                const data = saveList[name];
                const date = new Date(data.timestamp).toLocaleString('ko-KR');
                return `
                    <div class="save-item" data-name="${name}">
                        <div class="save-item-name">${name}</div>
                        <div class="save-item-date">${date}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('compareList1').innerHTML = listHtml1;
            document.getElementById('compareList2').innerHTML = listHtml2;
            document.getElementById('compareResult').innerHTML = '';
            selectedCompareItem1 = null;
            selectedCompareItem2 = null;
            openModal('compareModal');
        }
        
        // 비교 항목 1 선택
        function selectCompareItem1(name) {
            selectedCompareItem1 = name;
            document.querySelectorAll('#compareList1 .save-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`#compareList1 .save-item[data-name="${name}"]`).classList.add('selected');
        }
        
        // 비교 항목 2 선택
        function selectCompareItem2(name) {
            selectedCompareItem2 = name;
            document.querySelectorAll('#compareList2 .save-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`#compareList2 .save-item[data-name="${name}"]`).classList.add('selected');
        }
        
        // 선택된 세팅 비교
        function compareSelectedSets() {
            if (!selectedCompareItem1 || !selectedCompareItem2) {
                alert('비교할 두 개의 세팅을 모두 선택해주세요.');
                return;
            }
            
            if (selectedCompareItem1 === selectedCompareItem2) {
                alert('서로 다른 세팅을 선택해주세요.');
                return;
            }
            
            const saveList = getSaveList();
            const set1 = saveList[selectedCompareItem1];
            const set2 = saveList[selectedCompareItem2];
            
            if (!set1 || !set2) {
                alert('세팅을 찾을 수 없습니다.');
                return;
            }
            
            // 대미지 배율 비교
            const damage1Direct = parseFloat(set1.damageCalculation.finalDirect.replace('배', '')) || 0;
            const damage1Indirect = parseFloat(set1.damageCalculation.finalIndirect.replace('배', '')) || 0;
            const damage2Direct = parseFloat(set2.damageCalculation.finalDirect.replace('배', '')) || 0;
            const damage2Indirect = parseFloat(set2.damageCalculation.finalIndirect.replace('배', '')) || 0;
            
            const diffDirect = damage2Direct - damage1Direct;
            const diffIndirect = damage2Indirect - damage1Indirect;
            const diffDirectPercent = damage1Direct !== 0 ? ((diffDirect / damage1Direct) * 100).toFixed(2) : 0;
            const diffIndirectPercent = damage1Indirect !== 0 ? ((diffIndirect / damage1Indirect) * 100).toFixed(2) : 0;
            
            const resultHtml = `
                <div class="compare-result">
                    <div class="compare-item">
                        <h4>${selectedCompareItem1}</h4>
                        <div class="compare-stats">
                            <div class="compare-stat">
                                <span>직접 피해:</span>
                                <strong>${set1.damageCalculation.finalDirect}</strong>
                            </div>
                            <div class="compare-stat">
                                <span>간접 피해:</span>
                                <strong>${set1.damageCalculation.finalIndirect}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="compare-item">
                        <h4>${selectedCompareItem2}</h4>
                        <div class="compare-stats">
                            <div class="compare-stat">
                                <span>직접 피해:</span>
                                <strong>${set2.damageCalculation.finalDirect}</strong>
                            </div>
                            <div class="compare-stat">
                                <span>간접 피해:</span>
                                <strong>${set2.damageCalculation.finalIndirect}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="compare-difference ${diffDirect > 0 ? 'positive' : diffDirect < 0 ? 'negative' : ''}">
                        <strong>직접 피해 차이:</strong> ${diffDirect > 0 ? '+' : ''}${diffDirect.toFixed(2)}배 (${diffDirectPercent > 0 ? '+' : ''}${diffDirectPercent}%)
                    </div>
                    
                    <div class="compare-difference ${diffIndirect > 0 ? 'positive' : diffIndirect < 0 ? 'negative' : ''}">
                        <strong>간접 피해 차이:</strong> ${diffIndirect > 0 ? '+' : ''}${diffIndirect.toFixed(2)}배 (${diffIndirectPercent > 0 ? '+' : ''}${diffIndirectPercent}%)
                    </div>
                </div>
            `;
            
            document.getElementById('compareResult').innerHTML = resultHtml;
            
            // 비교 결과로 스크롤 이동 (부드러운 애니메이션)
            setTimeout(() => {
                const compareResultElement = document.getElementById('compareResult');
                if (compareResultElement) {
                    compareResultElement.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'nearest' 
                    });
                }
            }, 100);
        }
        
        // 페이지 로드 시 이벤트 리스너 등록
        document.addEventListener('DOMContentLoaded', function() {
            // 버튼 상태 업데이트
            updateButtonStates();
            
            // 세팅 섹션 버튼 이벤트 리스너
            document.getElementById('btn-save').addEventListener('click', openSaveModal);
            document.getElementById('btn-load').addEventListener('click', openLoadModal);
            document.getElementById('btn-update').addEventListener('click', openUpdateModal);
            document.getElementById('btn-delete').addEventListener('click', openDeleteModal);
            document.getElementById('btn-compare').addEventListener('click', openCompareModal);
            document.getElementById('btn-export').addEventListener('click', openExportModal);
            
            // 저장 모달 버튼
            document.getElementById('saveModalConfirm').addEventListener('click', saveCurrentSet);
            document.getElementById('saveModalCancel').addEventListener('click', function() {
                closeModal('saveModal');
            });
            
            // 불러오기 모달 버튼
            document.getElementById('loadModalConfirm').addEventListener('click', loadSelectedSet);
            document.getElementById('loadModalCancel').addEventListener('click', function() {
                closeModal('loadModal');
            });
            
            // 변경 모달 버튼
            document.getElementById('updateModalConfirm').addEventListener('click', updateSelectedSet);
            document.getElementById('updateModalCancel').addEventListener('click', function() {
                closeModal('updateModal');
            });
            
            // 삭제 모달 버튼
            document.getElementById('deleteModalConfirm').addEventListener('click', deleteSelectedSet);
            document.getElementById('deleteModalCancel').addEventListener('click', function() {
                closeModal('deleteModal');
            });
            
            // 비교 모달 버튼
            document.getElementById('compareModalConfirm').addEventListener('click', compareSelectedSets);
            document.getElementById('compareModalCancel').addEventListener('click', function() {
                closeModal('compareModal');
            });
            
            // 내보내기 모달 버튼
            document.getElementById('exportModalConfirm').addEventListener('click', exportSelectedSet);
            document.getElementById('exportModalCancel').addEventListener('click', function() {
                closeModal('exportModal');
            });
            
            // 저장 모달에서 Enter 키 처리
            document.getElementById('saveNameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveCurrentSet();
                }
            });
            
            // 이벤트 위임: 동적으로 생성되는 리스트 항목 클릭
            document.getElementById('loadList').addEventListener('click', function(e) {
                const item = e.target.closest('.save-item');
                if (item) {
                    const name = item.getAttribute('data-name');
                    selectLoadItem(name);
                }
            });
            
            document.getElementById('updateList').addEventListener('click', function(e) {
                const item = e.target.closest('.save-item');
                if (item) {
                    const name = item.getAttribute('data-name');
                    selectUpdateItem(name);
                }
            });
            
            document.getElementById('deleteList').addEventListener('click', function(e) {
                const item = e.target.closest('.save-item');
                if (item) {
                    const name = item.getAttribute('data-name');
                    selectDeleteItem(name);
                }
            });
            
            document.getElementById('compareList1').addEventListener('click', function(e) {
                const item = e.target.closest('.save-item');
                if (item) {
                    const name = item.getAttribute('data-name');
                    selectCompareItem1(name);
                }
            });
            
            document.getElementById('compareList2').addEventListener('click', function(e) {
                const item = e.target.closest('.save-item');
                if (item) {
                    const name = item.getAttribute('data-name');
                    selectCompareItem2(name);
                }
            });
            
            // 내보내기 리스트 클릭 이벤트
            document.getElementById('exportList').addEventListener('click', function(e) {
                const item = e.target.closest('.save-item');
                if (item) {
                    const name = item.getAttribute('data-name');
                    selectExportItem(name);
                }
            });
            
            // 드롭 영역 설정
            setupDropZone();
        });
    </script>
</body>
</html> 