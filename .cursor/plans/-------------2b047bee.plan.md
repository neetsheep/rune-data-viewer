<!-- 2b047bee-63ac-4c13-8ee7-a765b09cdaa9 ccf24a65-dc2b-4d85-ac94-c3c26dbf86d2 -->
# 룬 데이터 검증 체크리스트 시스템

## 목표

현재 변환된 58개 룬이 기존 데이터와 일치하는지 자동 검증

## 검증 항목

### 1. 데이터 구조 검증

- 효과 개수 일치 (runeDataV2.effects.length == runeEfficiencyData.keywords.length)
- category 이름 일치 (keywords 매핑)
- baseValue 정확도 검증

### 2. 계산 결과 검증

- efficiency 값 비교 (±2% 오차 허용)
- counts 값 비교
- 타임라인 생성 오류 체크

### 3. 특수 케이스 검증

- 시너지 룬 조합 테스트
- 각성 룬 가동률 확인
- 축적/누적 룬 스택 계산

## 구현 방법

### Step 1: 검증 함수 작성 (index.html)

`validateRuneConversion()` 함수를 추가하여 각 룬을 자동 검증:

```javascript
function validateRuneConversion() {
    const results = [];
    const newRunes = runeDataV2.map(r => r.name);
    
    newRunes.forEach(runeName => {
        const newData = runeDataV2.find(r => r.name === runeName);
        const oldData = runeEfficiencyData[runeName];
        
        if (!oldData) {
            results.push({ name: runeName, status: 'SKIP', reason: '기존 데이터 없음' });
            return;
        }
        
        const validation = {
            name: runeName,
            effectCount: newData.effects.length === oldData.keywords.length,
            values: [],
            efficiencies: [],
            errors: []
        };
        
        // 각 효과별 검증
        newData.effects.forEach((effect, idx) => {
            const expectedValue = oldData.values[idx];
            const expectedEff = oldData.efficiencies[idx];
            
            // 계산 시뮬레이션
            const manager = new RuneCalculationManager({ [newData.type]: [runeName] });
            const calcResult = manager.calculateAll();
            const aggregated = manager.aggregate(calcResult);
            
            const actualEff = aggregated[effect.category]?.effectiveValue || 0;
            const diffPercent = Math.abs((actualEff - expectedEff) / expectedEff * 100);
            
            validation.values.push({
                category: effect.category,
                expected: expectedValue,
                actual: effect.baseValue,
                match: effect.baseValue === expectedValue
            });
            
            validation.efficiencies.push({
                category: effect.category,
                expected: expectedEff,
                actual: actualEff,
                diffPercent: diffPercent,
                pass: diffPercent <= 2.0
            });
            
            if (diffPercent > 2.0) {
                validation.errors.push(`${effect.category}: ${diffPercent.toFixed(1)}% 오차`);
            }
        });
        
        validation.status = validation.errors.length === 0 ? 'PASS' : 'FAIL';
        results.push(validation);
    });
    
    return results;
}
```

### Step 2: 리포트 생성 함수

```javascript
function generateValidationReport(results) {
    const passed = results.filter(r => r.status === 'PASS').length;
    const failed = results.filter(r => r.status === 'FAIL').length;
    const skipped = results.filter(r => r.status === 'SKIP').length;
    
    console.log(`\n=== 룬 검증 리포트 ===`);
    console.log(`총 ${results.length}개 룬`);
    console.log(`통과: ${passed}개 ✅`);
    console.log(`실패: ${failed}개 ❌`);
    console.log(`건너뜀: ${skipped}개 ⏭️`);
    
    if (failed > 0) {
        console.log(`\n실패 상세:`);
        results.filter(r => r.status === 'FAIL').forEach(r => {
            console.log(`\n${r.name}:`);
            r.errors.forEach(err => console.log(`  - ${err}`));
        });
    }
    
    return { passed, failed, skipped, details: results };
}
```

### Step 3: UI 버튼 추가

디버깅용 버튼을 UI에 추가하여 클릭 시 검증 실행:

```html
<button id="validate-runes-btn" style="margin: 10px; padding: 5px 10px;">
    룬 데이터 검증
</button>
```



```javascript
document.getElementById('validate-runes-btn').addEventListener('click', () => {
    const results = validateRuneConversion();
    const report = generateValidationReport(results);
    
    // 결과를 화면에도 표시
    alert(`검증 완료!\n통과: ${report.passed}개\n실패: ${report.failed}개\n상세 내용은 콘솔을 확인하세요.`);
});
```

### Step 4: 개별 룬 검증 (수동)

특정 룬만 테스트하려면:

```javascript
function validateSingleRune(runeName) {
    const newData = runeDataV2.find(r => r.name === runeName);
    const oldData = runeEfficiencyData[runeName];
    
    console.log(`\n=== ${runeName} 검증 ===`);
    console.log('기존 데이터:', oldData);
    console.log('새 데이터:', newData);
    
    // 계산 실행
    const manager = new RuneCalculationManager({ [newData.type]: [runeName] });
    const calcResult = manager.calculateAll();
    const aggregated = manager.aggregate(calcResult);
    
    console.log('계산 결과:', aggregated);
    
    // 비교
    oldData.keywords.forEach((keyword, idx) => {
        const expected = oldData.efficiencies[idx];
        const actual = aggregated[keyword]?.effectiveValue || 0;
        const diff = Math.abs(actual - expected);
        const status = diff <= 0.5 ? '✅' : '❌';
        
        console.log(`${keyword}: ${actual.toFixed(1)}% (기대: ${expected}%) ${status}`);
    });
}
```

## 검증 체크리스트

### 우선순위 1: DOT 룬 (8개)

- [ ] 불길: 치명타 18% + DOT 35.6%
- [ ] 결정: 추가타 18% + DOT 35.6%
- [ ] 뇌명: 강타 20% + DOT 35.6%
- [ ] 독사+: 연타 20% + DOT 35.6%
- [ ] 공포: 치명타 피해 18% + DOT 35.6%
- [ ] 집행자: 회복 20% + 주는 피해 10% + DOT 53.3%
- [ ] 야수+: 주는 피해 20% + DOT 35.6%
- [ ] 밤+: 공격력 20% + DOT 35.6%

### 우선순위 2: 누적/축적 룬 (10개)

- [ ] 검무+: 공격력 1.9% + 치명타 1.0% (평균 9.8/10 스택)
- [ ] 수정 꽃잎: 룬 피해 15.0% + 공격력 12%
- [ ] 나무 사슴: 룬 피해 14.0% + 공격력 12%
- [ ] 바위 감시자: 공격력 21.3%
- [ ] 푸른 거목: 스킬 피해 1.5% (평균 6.8/10 스택)
- [ ] 황혼: 주는 피해 1.3% (평균 9.3/10 스택)
- [ ] 어두운 징조: 공격력/치명타/주는 피해 각 0% (궁극기)
- [ ] 지휘관: 공격력 4.5% + 4.5% + 0% + 3.6% + 2.7%
- [ ] 땅울림: 공격력 8% + 9% + (-0.6%)
- [ ] 불안정한 힘: 주는 피해 13.2%

### 우선순위 3: 각성 룬 (9개)

- [ ] 대마법사: 공격력 10% + 캐스팅 5.6% + 차지 5.6% + 상시 3개
- [ ] 무자비한 포식자: 스킬 피해 0.4% + 쿨타임 0.7% + 주는 피해 21%
- [ ] 부서진 하늘: 연타 피해 13.3% + 룬 피해 12.9% + 상시 2개
- [ ] 산맥 군주: 강타 피해 13.3% + 룬 피해 11.5% + 상시 2개
- [ ] 흩날리는 검: 공격력 13.6% + 빠른 공격 7.8% + 평타 추가타 7.8% + 상시 2개
- [ ] 아득한 빛: 치명타 확률 4.4% + 치명타 피해 11.1% + 상시 3개
- [ ] 갈라진 땅: 추가타 확률 11.7% + 추가 공격 7.0% + 상시 1개
- [ ] 순수한 힘: 주는 피해 24% + 궁극기 게이지 20%
- [ ] 인도하는 빛: 공격력 0.4% + 20%

### 우선순위 4: 각성 방어구 + 시너지 (7개)

- [ ] 압도적인 힘: 상시 3개 + 각성 3개 (1.3%, 1.3%, 0.9%)
- [ ] 섬세한 손놀림: 상시 3개 + 각성 3개 (1.3%, 1.3%, 0.9%)
- [ ] 눈 먼 예언자: 각성 쿨타임 38초 감소
- [ ] 쌍둥이 별: 누적 2배 + 상시 3개 (캐스팅/차지/빠른스킬 7%)
- [ ] 에메랄드 숲: 축적 횟수 /2 + 주는 피해 10%
- [ ] 공명하는 수정: 파멸의 낙인 5중첩 시작 (미구현)
- [ ] 영원: 결함 효과 제거 (미구현)

### 우선순위 5: 상시 스탯 룬 (20개)

- [ ] 망각+: 공격력 19% + 쿨타임 9%
- [ ] 서리바람+: 공격력 20% + 캐스팅 25% + 차지 25%
- [ ] 절개+: 공격력 20%
- [ ] 황금 들판: 공격력 20%
- [ ] 준비된 자: 주는 피해 20%
- [ ] 들불: 치명타 확률 14%
- [ ] 설산: 추가타 확률 16%
- [ ] 무도가+: 공격력 12% + 궁극기 게이지 20%
- [ ] 해결사+: 빠른 공격 30% + 평타 추가타 30%
- [ ] 집념+: 캐스팅 25% + 차지 25% + 주는 피해 10%
- [ ] 환영+: 공격력 18% + 방어구 파괴 10%
- [ ] 돌격대장+: 방어구 파괴 10% + 공격력 20%
- [ ] 신성한 칙령: 공격력 15% + 회복량 9%
- [ ] 싸움꾼: 주는 피해 12% + 받는 피해 8%
- [ ] 약탈자: 룬 회복 3% + 추가타 확률 10%
- [ ] 만 갈래 물길: 공격력 15% + 20%
- [ ] 무수한 궤적: 공격력 10% + 빠른 공격 30% + 평타 추가타 30%
- [ ] 무한: 쿨타임 9% + 공격력 20% + 빠른 공격 (조건부)
- [ ] 천자루의 검: 공격력 24%
- [ ] 영웅: 7가지 피해 각 4.3%

### 우선순위 6: 결함 룬 (3개)

- [ ] 투사+: 주는 피해 33% + 광역 피해 -10%
- [ ] 은둔자+: 공격력 33% + 쿨타임 -9%
- [ ] 갈퀴발톱+: 브레이크 피해 24% + 무방비 피해 24%

## 실행 순서

1. `validateRuneConversion()` 함수 추가
2. `generateValidationReport()` 함수 추가
3. UI 버튼 추가 (선택사항)
4. 브라우저 콘솔에서 `validateRuneConversion()` 실행
5. 리포트 확인 후 오류 수정
6. 개별 룬 상세 검증: `validateSingleRune('룬이름')`

## 예상 결과

- 통과: 50개 이상
- 실패: 5개 이하 (미세 조정 필요)
- 주요 오류: 조건부 룬, 특수 계산 룬

## 다음 단계

검증 완료 후 실패한 룬들을 개별 수정하고 나머지 45개 룬 변환 진행

### To-dos

- [ ] 트리거 간격 상수 및 전투 설정 추가
- [ ] runeDataV2 샘플 5개 작성 (불길, 검무+, 수정 꽃잎, 파멸의 낙인, 대마법사)
- [ ] TypeACalculator 클래스 구현
- [ ] TypeBCalculator 클래스 구현
- [ ] RuneCalculationManager 클래스 구현
- [ ] calculateEffects() 함수 교체 및 renderEffectSummary 추가
- [ ] calculateDamageMultiplier() 함수 수정하여 aggregatedEffects 연동
- [ ] 샘플 룬 5개로 테스트 및 검증